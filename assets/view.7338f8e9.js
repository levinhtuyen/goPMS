import{av as ne,aw as I,bh as ee,_ as A,r as v,a as B,F as w,G as j,N as a,M as i,ay as le,I as o,R as d,az as q,aA as G,q as K,Q as p,W as ae,by as ie,K as T,L as P,O as Q,bo as de,aF as D,U as L,aI as E,aG as z}from"./index.7efcbe86.js";import{Q as me}from"./QInnerLoading.5fef3982.js";import{a as re,c as S,Q as ue}from"./QTable.4cc8e1c9.js";import{Q as O}from"./QTooltip.c975c2a0.js";import{Q as fe}from"./QPagination.a48c1bef.js";import{C as Y}from"./ClosePopup.145acd40.js";import{u as W}from"./useI18n.6b7b36de.js";import{b as U,u as ce}from"./axiosClient.a0ee23b9.js";import{Q as H}from"./queryKeys.832af9fa.js";import{u as J}from"./useNotify.967ca7e7.js";import{Q as M}from"./QSelect.8edab530.js";import{Q as oe}from"./QForm.df816fa6.js";import{u as te}from"./use-quasar.f3f15168.js";import{u as se}from"./useValidate.96008b94.js";import{a as _e}from"./useFormat.349e799c.js";import"./QList.e5651779.js";import"./position-engine.4a23d733.js";import"./selection.6afffe69.js";import"./QMenu.b19dfcca.js";import"./QItemLabel.938a9258.js";import"./rtl.4b414a6d.js";const ve=async s=>{const{data:l}=await U.get(`/staff/getStaffList?limit=10&page=${s}`);return l.data},ge=s=>ne([H.STAFF,s],()=>ve(s.value)),be=async s=>{const{data:l}=await U.post("/staff/updateStaffStatus",s);return l},pe=()=>I(be),he=async s=>{const{data:l}=await U.post("/staff/createStaff",s);return l},ye=()=>{const s=ee();return I(he,{onSuccess:l=>{(l==null?void 0:l.code)==1&&s.invalidateQueries(H.STAFF)}})},Ve={props:{openCreateStaffModal:{type:Boolean,default:!1}},emits:["reset"],setup(s,l){const{t:m}=W(),e=te(),f=v(),{mutate:g,isLoading:n}=ye(),x=B(()=>s.openCreateStaffModal),h=v({fullName:"",mobile:"",email:"",roleSn:2,status:1,gender:0}),c=[{key:m("hotel_owner"),value:1},{key:m("front_desk"),value:2}],y=[{key:m("select_gender"),value:0},{key:m("male"),value:1},{key:m("female"),value:2}],{isRequiredRules:t,isEmailRules:_,isLengthFrom1To100Rules:k,isPhoneRules:R,isLengthFrom1To50Rules:C}=se(),{notifyUpdateSuccess:F}=J();return{onSubmit:()=>{var b;(b=f.value)==null||b.validate().then(V=>{if(V)g(h.value,{onSuccess:r=>{(r==null?void 0:r.code)==1?(F(),setTimeout(()=>{l.emit("reset",!1)},400)):(r==null?void 0:r.code)==2&&e.notify({message:m("we_couldnt_save_your_changes_please_try_again"),position:"top",type:"negative",actions:[{color:"white"}]})}});else return!1})},openStaffModalComputed:x,t:m,isRequiredRules:t,isEmailRules:_,isLengthFrom1To100Rules:k,isPhoneRules:R,isLengthFrom1To50Rules:C,formValues:h,roleOptions:c,genderOptions:y,isLoading:n,staffFormRef:f}}},xe={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Se={class:"text-bold q-ma-xs"},we={class:"col-12 col-sm-6 col-md-6 q-px-sm"},qe={class:"text-bold q-ma-xs"},ke={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Re={class:"text-bold q-ma-xs"},Ce={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Fe={class:"text-bold q-ma-xs"},Qe={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Me={class:"text-bold q-ma-xs"},Ue={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Ne={class:"text-bold q-ma-xs"},Te={class:"col-12 col-md-12 row justify-end q-px-lg q-pb-md q-gutter-sm"};function Pe(s,l,m,e,f,g){return w(),j(ae,null,[a(oe,{ref:"staffFormRef"},{default:i(()=>[a(le,{class:"row"},{default:i(()=>[o("div",xe,[o("p",Se,d(e.t("staff_name"))+"*",1),a(q,{modelValue:e.formValues.fullName,"onUpdate:modelValue":l[0]||(l[0]=n=>e.formValues.fullName=n),filled:"",dense:"",placeholder:e.t("input_name"),"lazy-rules":"",rules:[...e.isRequiredRules,...e.isLengthFrom1To50Rules]},null,8,["modelValue","placeholder","rules"])]),o("div",we,[o("p",qe,d(e.t("status")),1),a(G,{modelValue:e.formValues.status,"onUpdate:modelValue":l[1]||(l[1]=n=>e.formValues.status=n),"false-value":0,"true-value":1,color:"negative"},null,8,["modelValue"])]),o("div",ke,[o("p",Re,d(e.t("role"))+"*",1),a(M,{modelValue:e.formValues.roleSn,"onUpdate:modelValue":l[2]||(l[2]=n=>e.formValues.roleSn=n),filled:"",dense:"","map-options":"",label:e.t("select_role"),"option-label":"key","option-value":"value",options:e.roleOptions,"emit-value":"",placeholder:e.t("role"),rules:e.isRequiredRules},null,8,["modelValue","label","options","placeholder","rules"])]),o("div",Ce,[o("p",Fe,d(e.t("email"))+"*",1),a(q,{modelValue:e.formValues.email,"onUpdate:modelValue":l[3]||(l[3]=n=>e.formValues.email=n),filled:"",type:"email",dense:"",placeholder:e.t("input_email"),"lazy-rules":"",rules:[...e.isRequiredRules,...e.isLengthFrom1To100Rules,...e.isEmailRules]},null,8,["modelValue","placeholder","rules"])]),o("div",Qe,[o("p",Me,d(e.t("phone_number")),1),a(q,{modelValue:e.formValues.mobile,"onUpdate:modelValue":l[4]||(l[4]=n=>e.formValues.mobile=n),mask:"############",filled:"",dense:"",placeholder:e.t("input_phone_number"),"lazy-rules":"",rules:e.isPhoneRules},null,8,["modelValue","placeholder","rules"])]),o("div",Ue,[o("p",Ne,d(e.t("gender")),1),a(M,{modelValue:e.formValues.gender,"onUpdate:modelValue":l[5]||(l[5]=n=>e.formValues.gender=n),filled:"",dense:"",clearable:"","map-options":"",label:e.t("select_gender"),"option-label":"key","option-value":"value",options:e.genderOptions,"emit-value":""},null,8,["modelValue","label","options"])])]),_:1})]),_:1},512),o("div",Te,[K(a(p,{label:e.t("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[Y]]),a(p,{label:e.t("save"),class:"q-px-lg",loading:e.isLoading,type:"submit",color:"negative","no-caps":"",onClick:e.onSubmit},null,8,["label","loading","onClick"])])],64)}var De=A(Ve,[["render",Pe],["__file","D:/gopms-web/src/modules/staff/components/create-staff-modal.vue"]]);const Le=async s=>{const{data:l}=await U.post("/staff/updateStaff",s);return l},Ee=()=>{const s=ee();return I(Le,{onSuccess:l=>{(l==null?void 0:l.code)==1&&s.invalidateQueries(H.STAFF)}})},ze={props:{openEditStaffModal:{type:Boolean,default:!1},staffDetail:{type:Object,default:null}},emits:["reset"],setup(s,l){const{t:m}=W(),e=te(),f=v(),{notifyUpdateSuccess:g}=J(),{mutate:n,isLoading:x}=Ee(),h=B(()=>s.openEditStaffModal),c=v({sn:null,fullName:"",mobile:"",email:"",roleSn:2,status:1,gender:0});ie(()=>{var b,V,r,u,X,Z,$;c.value={sn:(b=s.staffDetail.row)==null?void 0:b.sn,fullName:(V=s.staffDetail.row)==null?void 0:V.fullName,mobile:(r=s.staffDetail.row)==null?void 0:r.mobile,email:(u=s.staffDetail.row)==null?void 0:u.email,roleSn:(X=s.staffDetail.row)==null?void 0:X.roleSn,status:(Z=s.staffDetail.row)==null?void 0:Z.status,gender:($=s.staffDetail.row)==null?void 0:$.gender}});const y=[{key:m("hotel_owner"),value:1},{key:m("front_desk"),value:2}],t=[{key:m("select_gender"),value:0},{key:m("male"),value:1},{key:m("female"),value:2}],{isRequiredRules:_,isEmailRules:k,isLengthFrom1To100Rules:R,isPhoneRules:C,isLengthFrom1To50Rules:F}=se();return{onSubmit:()=>{var b;(b=f.value)==null||b.validate().then(V=>{if(V)n(c.value,{onSuccess:r=>{(r==null?void 0:r.code)==1?(g(),setTimeout(()=>{l.emit("reset",!1)},400)):(r==null?void 0:r.code)==2&&e.notify({message:m("we_couldnt_save_your_changes_please_try_again"),position:"top",type:"negative",actions:[{color:"white"}]})}});else return!1})},openStaffModalComputed:h,t:m,isRequiredRules:_,isEmailRules:k,isLengthFrom1To100Rules:R,isPhoneRules:C,isLengthFrom1To50Rules:F,formValues:c,roleOptions:y,genderOptions:t,isLoading:x,staffFormRef:f}}},Oe={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Ie={class:"text-bold q-ma-xs"},Ae={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Be={class:"text-bold q-ma-xs"},je={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Ge={class:"text-bold q-ma-xs"},Ke={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Ye={class:"text-bold q-ma-xs"},We={class:"col-12 col-sm-6 col-md-6 q-px-sm"},He={class:"text-bold q-ma-xs"},Je={class:"col-12 col-sm-6 col-md-6 q-px-sm"},Xe={class:"text-bold q-ma-xs"},Ze={class:"col-12 col-md-12 row justify-end q-px-lg q-pb-md q-gutter-sm"};function $e(s,l,m,e,f,g){return w(),j(ae,null,[a(oe,{ref:"staffFormRef"},{default:i(()=>[a(le,{class:"row"},{default:i(()=>[o("div",Oe,[o("p",Ie,d(e.t("staff_name"))+"*",1),a(q,{modelValue:e.formValues.fullName,"onUpdate:modelValue":l[0]||(l[0]=n=>e.formValues.fullName=n),filled:"",dense:"",placeholder:e.t("input_name"),"lazy-rules":"",rules:[...e.isRequiredRules,...e.isLengthFrom1To50Rules]},null,8,["modelValue","placeholder","rules"])]),o("div",Ae,[o("p",Be,d(e.t("status")),1),a(G,{modelValue:e.formValues.status,"onUpdate:modelValue":l[1]||(l[1]=n=>e.formValues.status=n),"false-value":0,"true-value":1,color:"negative"},null,8,["modelValue"])]),o("div",je,[o("p",Ge,d(e.t("role"))+"*",1),a(M,{ref:"roleField",modelValue:e.formValues.roleSn,"onUpdate:modelValue":l[2]||(l[2]=n=>e.formValues.roleSn=n),filled:"",dense:"","map-options":"",label:e.t("select_role"),"option-label":"key","option-value":"value",options:e.roleOptions,"emit-value":"",rules:e.isRequiredRules},null,8,["modelValue","label","options","rules"])]),o("div",Ke,[o("p",Ye,d(e.t("email"))+"*",1),a(q,{ref:"emailField",modelValue:e.formValues.email,"onUpdate:modelValue":l[3]||(l[3]=n=>e.formValues.email=n),filled:"",type:"email",dense:"",placeholder:e.t("input_email"),"lazy-rules":"",rules:[...e.isRequiredRules,...e.isLengthFrom1To100Rules,...e.isEmailRules]},null,8,["modelValue","placeholder","rules"])]),o("div",We,[o("p",He,d(e.t("phone_number")),1),a(q,{ref:"phoneField",modelValue:e.formValues.mobile,"onUpdate:modelValue":l[4]||(l[4]=n=>e.formValues.mobile=n),mask:"############",filled:"",dense:"",placeholder:e.t("input_phone_number"),"lazy-rules":"",rules:e.isPhoneRules},null,8,["modelValue","placeholder","rules"])]),o("div",Je,[o("p",Xe,d(e.t("gender")),1),a(M,{modelValue:e.formValues.gender,"onUpdate:modelValue":l[5]||(l[5]=n=>e.formValues.gender=n),filled:"",dense:"","map-options":"",label:e.t("select_gender"),clearable:"","option-label":"key","option-value":"value",options:e.genderOptions,"emit-value":""},null,8,["modelValue","label","options"])])]),_:1})]),_:1},512),o("div",Ze,[K(a(p,{label:e.t("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[Y]]),a(p,{label:e.t("save"),class:"q-px-lg",loading:e.isLoading,type:"submit",color:"negative","no-caps":"",onClick:e.onSubmit},null,8,["label","loading","onClick"])])],64)}var el=A(ze,[["render",$e],["__file","D:/gopms-web/src/modules/staff/components/edit-staff-model.vue"]]);const ll={components:{CreateStaffModal:De,EditStaffModal:el},setup(){const{t:s}=W(),l=v(!1),m=v(1),e=v(!1),f=v(!1),g=v(!1),{data:n,isFetching:x}=ge(m),h=pe(),{hasPermission:c}=ce(),y=B(()=>[{name:"no",required:!0,label:s("no"),align:"left"},{name:"fullName",required:!0,label:s("staff_name"),align:"left",field:u=>u.fullName,format:u=>`${u}`},{name:"mobile",align:"left",label:s("phone_number"),field:"mobile"},{name:"email",align:"left",label:s("email"),field:"email"},{name:"role",align:"left",label:s("role"),field:"role"},{name:"status",align:"left",label:s("status"),field:"status"},{name:"operations",label:"",field:"operations"}]),t=v({}),_=v(null),k=u=>{g.value=!0,t.value=u},R=()=>{f.value=!0},C=u=>{t.value=u,t.value.status===1?_.value=s("are_you_sure_you_want_to_deactivate_this_account"):_.value=s("are_you_sure_you_want_to_activate_this_account"),l.value=!0},F=()=>{t.value.status=t.value.status?0:1,l.value=!1,r(t)},N=u=>{f.value=u,g.value=u},{notifySaveSuccess:b,notifySaveFailed:V}=J(),r=async u=>{h.mutate({staffSn:u.value.sn,status:u.value.status},{onSuccess:()=>{b()},onError:()=>{u.value.status=u.value.status?0:1,V()}})};return{t:s,hasPermission:c,openDialogStatus:l,currentPage:m,editRow:k,openModalNewStaff:R,onChangeStatus:C,onConfirmStatusPopup:F,resetStaffModal:N,columns:y,status:e,data:n,isFetching:x,openCreateStaffModal:f,openEditStaffModal:g,staffDetail:t,titleActiveModal:_,formatIndexTable:_e}}},al={class:"row q-mb-md justify-between"},ol={class:"text-h5 text-bold"},tl={class:"q-gutter-sm"},sl={class:"relative-position"},nl={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},il={key:0},dl={class:"limit-text"},ml={class:"limit-text"},rl={class:"q-mt-md row justify-end"},ul={class:"text-h5 q-mt-lg q-mx-lg"},fl={class:"text-h5 q-mt-lg q-mx-lg"},cl={align:"center"},_l={class:"text-bold"},vl={align:"end",class:"q-gutter-sm"};function gl(s,l,m,e,f,g){const n=T("create-staff-modal"),x=T("edit-staff-modal"),h=T("pms-sections");return w(),P(h,null,{header:i(()=>[o("div",al,[o("div",ol,d(e.t("staff_list")),1),o("div",tl,[a(p,{color:"negative",icon:"add",label:e.t("new_staff"),class:Q(e.hasPermission("add-edit-staff")==!1?"hidden":""),"no-caps":"",onClick:l[0]||(l[0]=c=>e.openModalNewStaff())},null,8,["label","class"]),a(p,{color:"negative",label:e.t("permission"),class:Q(e.hasPermission("permission")==!1?"hidden":""),"no-caps":"",onClick:l[1]||(l[1]=c=>s.$router.push({name:"permission"}))},null,8,["label","class"])])])]),default:i(()=>{var c,y;return[o("div",sl,[a(me,{showing:e.isFetching,label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:i(()=>[o("div",nl,[a(de,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),e.isFetching?L("v-if",!0):(w(),j("div",il,[a(ue,{"rows-per-page-options":[0],rows:(c=e.data)==null?void 0:c.staffList,columns:e.columns,"hide-pagination":"","hide-bottom":"","row-key":"no"},{body:i(t=>[a(re,{props:t},{default:i(()=>[a(S,{key:"no",props:t},{default:i(()=>[D(d(e.formatIndexTable(e.currentPage,t.rowIndex)),1)]),_:2},1032,["props"]),a(S,{key:"fullName",props:t},{default:i(()=>[o("div",dl,d(t.row.fullName),1),t.row.fullName.length>42?(w(),P(O,{key:0,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[o("strong",null,d(t.row.fullName),1)]),_:2},1024)):L("v-if",!0)]),_:2},1032,["props"]),a(S,{key:"mobile",props:t},{default:i(()=>[D(d(t.row.mobile),1)]),_:2},1032,["props"]),a(S,{key:"email",props:t},{default:i(()=>[o("div",ml,d(t.row.email),1),t.row.email.length>42?(w(),P(O,{key:0,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[o("strong",null,d(t.row.email),1)]),_:2},1024)):L("v-if",!0)]),_:2},1032,["props"]),a(S,{key:"role",props:t},{default:i(()=>[D(d(t.row.roleSn==1?e.t("hotel_owner"):e.t("front_desk")),1)]),_:2},1032,["props"]),a(S,{key:"status",props:t,class:Q(e.hasPermission("activate-deactivate-staff")==!1?"hidden":"")},{default:i(()=>[a(G,{modelValue:t.row.status,"onUpdate:modelValue":_=>t.row.status=_,"false-value":0,"true-value":1,color:"negative",onClick:_=>e.onChangeStatus(t.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1032,["props","class"]),a(S,{key:"operations",props:t,class:Q(e.hasPermission("add-edit-staff")==!1?"hidden":"")},{default:i(()=>[a(O,{class:"negative",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[o("strong",null,d(e.t("edit")),1)]),_:1}),a(p,{dense:"",round:"",flat:"",color:"grey-9",icon:"edit",onClick:_=>e.editRow(t)},null,8,["onClick"])]),_:2},1032,["props","class"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o("div",rl,[a(fe,{modelValue:e.currentPage,"onUpdate:modelValue":l[2]||(l[2]=t=>e.currentPage=t),color:"negative",max:((y=e.data)==null?void 0:y.meta.lastPage)||1,"max-pages":5,"boundary-numbers":"","direction-links":"",push:""},null,8,["modelValue","max"])])]))]),a(E,{modelValue:e.openCreateStaffModal,"onUpdate:modelValue":l[3]||(l[3]=t=>e.openCreateStaffModal=t)},{default:i(()=>[a(z,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[o("div",ul,d(e.t("new_staff")),1),a(n,{onReset:e.resetStaffModal},null,8,["onReset"])]),_:1})]),_:1},8,["modelValue"]),a(E,{modelValue:e.openEditStaffModal,"onUpdate:modelValue":l[4]||(l[4]=t=>e.openEditStaffModal=t)},{default:i(()=>[a(z,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[o("div",fl,d(e.t("edit_staff")),1),a(x,{"staff-detail":e.staffDetail,onReset:e.resetStaffModal},null,8,["staff-detail","onReset"])]),_:1})]),_:1},8,["modelValue"]),a(E,{modelValue:e.openDialogStatus,"onUpdate:modelValue":l[5]||(l[5]=t=>e.openDialogStatus=t)},{default:i(()=>[a(z,{class:"q-pa-lg"},{default:i(()=>[o("div",cl,[o("p",_l,d(e.titleActiveModal),1)]),o("div",vl,[K(a(p,{label:e.t("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"6px 16px"}},null,8,["label"]),[[Y]]),a(p,{label:e.t("confirm"),color:"negative",style:{width:"100px"},"no-caps":"",onClick:e.onConfirmStatusPopup},null,8,["label","onClick"])])]),_:1})]),_:1},8,["modelValue"])]}),_:1})}var El=A(ll,[["render",gl],["__scopeId","data-v-1e2e5195"],["__file","D:/gopms-web/src/modules/staff/view.vue"]]);export{El as default};
