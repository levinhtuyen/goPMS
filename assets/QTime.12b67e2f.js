var Ie=Object.defineProperty,Pe=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var ie=(u,v,m)=>v in u?Ie(u,v,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[v]=m,y=(u,v)=>{for(var m in v||(v={}))Fe.call(v,m)&&ie(u,m,v[m]);if(ae)for(var m of ae(v))Te.call(v,m)&&ie(u,m,v[m]);return u},oe=(u,v)=>Pe(u,Be(v));import{c as $e,d as je,b5 as Qe,f as Ye,be as ze,r as j,a as c,w as se,n as Le,bf as b,b as s,ag as Ne,q as Ue,Q as Ee,t as We,g as re,bg as Xe,ad as Ge}from"./index.4bd8ab7e.js";import{T as Je}from"./TouchPan.3d5b23e3.js";import{u as Ze,a as Re,b as et,g as tt}from"./QPopupProxy.0d4ba934.js";import{_ as Q,f as ut}from"./date.525ad423.js";function lt(u,v){if(u.hour!==null){if(u.minute===null)return"minute";if(v===!0&&u.second===null)return"second"}return"hour"}function nt(){const u=new Date;return{hour:u.getHours(),minute:u.getMinutes(),second:u.getSeconds(),millisecond:u.getMilliseconds()}}var ct=$e({name:"QTime",props:oe(y(y(y({},je),Qe),Ze),{mask:{default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:u=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(u)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean}),emits:Re,setup(u,{slots:v,emit:m}){const{proxy:{$q:w}}=re(),ce=Ye(u,w),{tabindex:q,headerClass:X,getLocale:ve,getCurrentDate:G}=et(u,w),de=ze(u),fe=Xe(de);let O,S;const J=j(null),p=c(()=>ye()),H=c(()=>ve()),Z=c(()=>qe()),V=Q(u.modelValue,p.value,H.value,u.calendar,Z.value),o=j(lt(V)),l=j(V),d=j(V.hour===null||V.hour<12),me=c(()=>`q-time q-time--${u.landscape===!0?"landscape":"portrait"}`+(ce.value===!0?" q-time--dark q-dark":"")+(u.disable===!0?" disabled":u.readonly===!0?" q-time--readonly":"")+(u.bordered===!0?" q-time--bordered":"")+(u.square===!0?" q-time--square no-border-radius":"")+(u.flat===!0?" q-time--flat no-shadow":"")),Y=c(()=>{const e=l.value;return{hour:e.hour===null?"--":h.value===!0?b(e.hour):String(d.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":b(e.minute),second:e.second===null?"--":b(e.second)}}),h=c(()=>u.format24h!==null?u.format24h:w.lang.date.format24h),he=c(()=>{const e=o.value==="hour",t=e===!0?12:60,n=l.value[o.value];let r=`rotate(${Math.round(n*(360/t))-180}deg) translateX(-50%)`;return e===!0&&h.value===!0&&l.value.hour>=12&&(r+=" scale(.7)"),{transform:r}}),R=c(()=>l.value.hour!==null),_e=c(()=>R.value===!0&&l.value.minute!==null),C=c(()=>u.hourOptions!==void 0?e=>u.hourOptions.includes(e):u.options!==void 0?e=>u.options(e,null,null):null),A=c(()=>u.minuteOptions!==void 0?e=>u.minuteOptions.includes(e):u.options!==void 0?e=>u.options(l.value.hour,e,null):null),K=c(()=>u.secondOptions!==void 0?e=>u.secondOptions.includes(e):u.options!==void 0?e=>u.options(l.value.hour,l.value.minute,e):null),g=c(()=>{if(C.value===null)return null;const e=P(0,11,C.value),t=P(12,11,C.value);return{am:e,pm:t,values:e.values.concat(t.values)}}),M=c(()=>A.value!==null?P(0,59,A.value):null),x=c(()=>K.value!==null?P(0,59,K.value):null),I=c(()=>{switch(o.value){case"hour":return g.value;case"minute":return M.value;case"second":return x.value}}),ge=c(()=>{let e,t,n=0,i=1;const r=I.value!==null?I.value.values:void 0;o.value==="hour"?h.value===!0?(e=0,t=23):(e=0,t=11,d.value===!1&&(n=12)):(e=0,t=55,i=5);const _=[];for(let a=e,f=e;a<=t;a+=i,f++){const k=a+n,Ae=r!==void 0&&r.includes(k)===!1,Ke=o.value==="hour"&&a===0?h.value===!0?"00":"12":a;_.push({val:k,index:f,disable:Ae,label:Ke})}return _}),ke=c(()=>[[Je,be,void 0,{stop:!0,prevent:!0,mouse:!0}]]);se(()=>u.modelValue,e=>{const t=Q(e,p.value,H.value,u.calendar,Z.value);(t.dateHash!==l.value.dateHash||t.timeHash!==l.value.timeHash)&&(l.value=t,t.hour===null?o.value="hour":d.value=t.hour<12)}),se([p,H],()=>{Le(()=>{E()})});function ee(){const e=y(y({},G()),nt());E(e),Object.assign(l.value,e),o.value="hour"}function P(e,t,n){const i=Array.apply(null,{length:t+1}).map((r,_)=>{const a=_+e;return{index:a,val:n(a)===!0}}).filter(r=>r.val===!0).map(r=>r.index);return{min:i[0],max:i[i.length-1],values:i,threshold:t+1}}function te(e,t,n){const i=Math.abs(e-t);return Math.min(i,n-i)}function z(e,{min:t,max:n,values:i,threshold:r}){if(e===t)return t;if(e<t||e>n)return te(e,t,r)<=te(e,n,r)?t:n;const _=i.findIndex(k=>e<=k),a=i[_-1],f=i[_];return e-a<=f-e?a:f}function ye(){return u.calendar!=="persian"&&u.mask!==null?u.mask:`HH:mm${u.withSeconds===!0?":ss":""}`}function qe(){if(typeof u.defaultDate!="string"){const e=G(!0);return e.dateHash=tt(e),e}return Q(u.defaultDate,"YYYY/MM/DD",void 0,u.calendar)}function L(){return W.isDeactivated===!0||W.isUnmounted===!0||I.value!==null&&(I.value.values.length===0||o.value==="hour"&&h.value!==!0&&g.value[d.value===!0?"am":"pm"].values.length===0)}function N(){const e=J.value,{top:t,left:n,width:i}=e.getBoundingClientRect(),r=i/2;return{top:t+r,left:n+r,dist:r*.7}}function be(e){if(L()!==!0){if(e.isFirst===!0){O=N(),S=B(e.evt,O);return}S=B(e.evt,O,S),e.isFinal===!0&&(O=!1,S=null,ue())}}function ue(){o.value==="hour"?o.value="minute":u.withSeconds&&o.value==="minute"&&(o.value="second")}function B(e,t,n){const i=Ge(e),r=Math.abs(i.top-t.top),_=Math.sqrt(Math.pow(Math.abs(i.top-t.top),2)+Math.pow(Math.abs(i.left-t.left),2));let a,f=Math.asin(r/_)*(180/Math.PI);if(i.top<t.top?f=t.left<i.left?90-f:270+f:f=t.left<i.left?f+90:270-f,o.value==="hour"){if(a=f/30,g.value!==null){const k=h.value!==!0?d.value===!0:g.value.am.values.length>0&&g.value.pm.values.length>0?_>=t.dist:g.value.am.values.length>0;a=z(a+(k===!0?0:12),g.value[k===!0?"am":"pm"])}else a=Math.round(a),h.value===!0?_<t.dist?a<12&&(a+=12):a===12&&(a=0):d.value===!0&&a===12?a=0:d.value===!1&&a!==12&&(a+=12);h.value===!0&&(d.value=a<12)}else a=Math.round(f/6)%60,o.value==="minute"&&M.value!==null?a=z(a,M.value):o.value==="second"&&x.value!==null&&(a=z(a,x.value));return n!==a&&pe[o.value](a),a}const U={hour(){o.value="hour"},minute(){o.value="minute"},second(){o.value="second"}};function we(e){e.keyCode===13&&le()}function Ce(e){e.keyCode===13&&ne()}function Me(e){L()!==!0&&(w.platform.is.desktop!==!0&&B(e,N()),ue())}function xe(e){L()!==!0&&B(e,N())}function De(e){if(e.keyCode===13)o.value="hour";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(g.value!==null){const n=h.value===!0?g.value.values:g.value[d.value===!0?"am":"pm"].values;if(n.length===0)return;if(l.value.hour===null)F(n[0]);else{const i=(n.length+n.indexOf(l.value.hour)+t)%n.length;F(n[i])}}else{const n=h.value===!0?24:12,i=h.value!==!0&&d.value===!1?12:0,r=l.value.hour===null?-t:l.value.hour;F(i+(24+r+t)%n)}}}function Oe(e){if(e.keyCode===13)o.value="minute";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(M.value!==null){const n=M.value.values;if(n.length===0)return;if(l.value.minute===null)T(n[0]);else{const i=(n.length+n.indexOf(l.value.minute)+t)%n.length;T(n[i])}}else{const n=l.value.minute===null?-t:l.value.minute;T((60+n+t)%60)}}}function Se(e){if(e.keyCode===13)o.value="second";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(x.value!==null){const n=x.value.values;if(n.length===0)return;if(l.value.seconds===null)$(n[0]);else{const i=(n.length+n.indexOf(l.value.second)+t)%n.length;$(n[i])}}else{const n=l.value.second===null?-t:l.value.second;$((60+n+t)%60)}}}function F(e){l.value.hour!==e&&(l.value.hour=e,D())}function T(e){l.value.minute!==e&&(l.value.minute=e,D())}function $(e){l.value.second!==e&&(l.value.second=e,D())}const pe={hour:F,minute:T,second:$};function le(){d.value===!1&&(d.value=!0,l.value.hour!==null&&(l.value.hour-=12,D()))}function ne(){d.value===!0&&(d.value=!1,l.value.hour!==null&&(l.value.hour+=12,D()))}function D(){if(C.value!==null&&C.value(l.value.hour)!==!0){l.value=Q(),o.value="hour";return}if(A.value!==null&&A.value(l.value.minute)!==!0){l.value.minute=null,l.value.second=null,o.value="minute";return}if(u.withSeconds===!0&&K.value!==null&&K.value(l.value.second)!==!0){l.value.second=null,o.value="second";return}l.value.hour===null||l.value.minute===null||u.withSeconds===!0&&l.value.second===null||E()}function E(e){const t=Object.assign(y({},l.value),e),n=u.calendar==="persian"?b(t.hour)+":"+b(t.minute)+(u.withSeconds===!0?":"+b(t.second):""):ut(new Date(t.year,t.month===null?null:t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond),p.value,H.value,t.year,t.timezoneOffset);t.changed=n!==u.modelValue,m("update:modelValue",n,t)}const W=re();Object.assign(W.proxy,{setNow:ee});function He(){const e=[s("div",{class:"q-time__link "+(o.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:q.value,onClick:U.hour,onKeyup:De},Y.value.hour),s("div",":"),s("div",R.value===!0?{class:"q-time__link "+(o.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:q.value,onKeyup:Oe,onClick:U.minute}:{class:"q-time__link"},Y.value.minute)];u.withSeconds===!0&&e.push(s("div",":"),s("div",_e.value===!0?{class:"q-time__link "+(o.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:q.value,onKeyup:Se,onClick:U.second}:{class:"q-time__link"},Y.value.second));const t=[s("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return h.value===!1&&t.push(s("div",{class:"q-time__header-ampm column items-between no-wrap"},[s("div",{class:"q-time__link "+(d.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:q.value,onClick:le,onKeyup:we},"AM"),s("div",{class:"q-time__link "+(d.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:q.value,onClick:ne,onKeyup:Ce},"PM")])),s("div",{class:"q-time__header flex flex-center no-wrap "+X.value},t)}function Ve(){const e=l.value[o.value];return s("div",{class:"q-time__content col relative-position"},[s(Ne,{name:"q-transition--scale"},()=>s("div",{key:"clock"+o.value,class:"q-time__container-parent absolute-full"},[s("div",{ref:J,class:"q-time__container-child fit overflow-hidden"},[Ue(s("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:Me,onMousedown:xe},[s("div",{class:"q-time__clock-circle fit"},[s("div",{class:"q-time__clock-pointer"+(l.value[o.value]===null?" hidden":u.color!==void 0?` text-${u.color}`:""),style:he.value}),ge.value.map(t=>s("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${t.index}`+(t.val===e?" q-time__clock-position--active "+X.value:t.disable===!0?" q-time__clock-position--disable":"")},[s("span",t.label)]))])]),ke.value)])])),u.nowBtn===!0?s(Ee,{class:"q-time__now-button absolute",icon:w.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:u.color,textColor:u.textColor,tabindex:q.value,onClick:ee}):null])}return()=>{const e=[Ve()],t=We(v.default);return t!==void 0&&e.push(s("div",{class:"q-time__actions"},t)),u.name!==void 0&&u.disable!==!0&&fe(e,"push"),s("div",{class:me.value,tabindex:-1},[He(),s("div",{class:"q-time__main col overflow-auto"},e)])}}});export{ct as Q};
