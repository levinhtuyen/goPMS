var se=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var D=(l,e,r)=>e in l?se(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r,q=(l,e)=>{for(var r in e||(e={}))le.call(e,r)&&D(l,r,e[r]);if(B)for(var r of B(e))ae.call(e,r)&&D(l,r,e[r]);return l},J=(l,e)=>te(l,oe(e));import{aE as ne,aF as T,bj as re,_ as M,J as R,i as ie,r as _,w as G,aC as de,a as ue,F as S,G as C,I as s,R as m,P as o,N as u,M as h,bq as ce,aI as y,U as _e,Q as z,W,T as N,K as me,L as pe,aS as ve,aT as fe}from"./index.4bd8ab7e.js";import{Q as he}from"./QInnerLoading.36fa411b.js";import{Q as K}from"./QSelect.2521a28c.js";import{Q as Y}from"./QForm.8a0c543d.js";import{u as U}from"./useI18n.96209f4d.js";import{b as j,V as we,u as A,L as I}from"./axiosClient.ad61c203.js";import{Q as X}from"./queryKeys.832af9fa.js";import{u as ge}from"./roleQuery.b5a77f7e.js";import{u as H}from"./useNotify.6f32b3a1.js";import"./QMenu.d60d439b.js";import"./position-engine.e365a736.js";import"./selection.cdf30163.js";import"./QItemLabel.0748896a.js";import"./rtl.4b414a6d.js";import"./use-quasar.fa06306f.js";const be=async()=>{const{data:l}=await j.get("/staff/getProfileInfo");return l.data},ye=()=>ne([X.ME],()=>be()),xe=async l=>{const{data:e}=await j.post("/staff/updateProfileInfo",l);return e},Pe=()=>{const l=re();return T(xe,{onSuccess:e=>{const r=X.ME,v=l.getQueryData(r);!v||l.setQueryData(r,()=>q(q({},v),e))}})},qe={class:"row q-pb-md justify-between"},Se={class:"text-h6 text-bold"},Ve={class:"relative-position"},Fe={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},$e={key:0},Qe={class:"row q-gutter-x-md"},Ee={class:"col"},ke={class:"required text-bold q-my-xs"},Ne={class:"col"},Ie={class:"text-bold q-my-xs"},Ce={class:"row q-gutter-x-md"},Me={class:"col"},Re={class:"text-bold q-my-xs"},Ue={class:"col"},je={class:"text-bold q-my-xs"},Le={class:"row q-gutter-md"},Oe={class:"col"},Be={class:"text-bold q-my-xs"},De=s("div",{class:"col"},null,-1),Je={class:"col-12 col-md-12 row justify-end"},Ge=R({setup(l){const{data:e,isFetching:r}=ye(),{data:v,refetch:x}=ge(),c=Pe(),{t:i}=U(),V=ie("emitter"),a=_(),{notifyUpdateSuccess:F}=H();G(r,()=>{a.value=e!=null&&e.value?JSON.parse(JSON.stringify(e==null?void 0:e.value)):[],a.value.gender=a.value.gender===0?null:a.value.gender}),G(()=>de.global.locale.value,()=>{x.value()});const $=_(null),Q=[t=>we.test(t)||i("this_is_invalid_value"),t=>8<=t.length&&12>=t.length||i("the_length_is_from_8_to_12_characters")],w=_(null),g=[t=>!!t||i("this_field_is_required"),t=>t.indexOf(" ")!==0||i("this_field_not_blank"),t=>t.length<=50||i("the_length_is_from_0_to_50_characters")],b=_(null),E=ue(()=>[{name:i("male"),value:1},{name:i("female"),value:2}]),n=()=>{a.value.gender=a.value.gender===null?1:2},d=()=>{var t,p,f;c.mutate({fullName:(t=a.value)==null?void 0:t.fullName,mobile:(p=a.value)==null?void 0:p.mobile,gender:(f=a.value)==null?void 0:f.gender},{onSuccess:k=>{var L,O;if((k==null?void 0:k.code)===1){const{setLocalStorageWithExpiry:Z}=A(),ee=(L=JSON.parse(localStorage.getItem(I)||"{}"))==null?void 0:L.expiry,P=(O=JSON.parse(localStorage.getItem(I)||"{}"))==null?void 0:O.value;P.fullName=a.value.fullName,P.mobile=a.value.mobile,P.gender=a.value.gender,Z(I,P,ee),V.emit("changeProfileInfo"),F()}}})};return(t,p)=>(S(),C(W,null,[s("div",qe,[s("div",Se,m(o(i)("basic_info")),1)]),s("div",Ve,[u(Y,{class:"q-gutter-md",onSubmit:d},{default:h(()=>[u(he,{showing:o(r),label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:h(()=>[s("div",Fe,[u(ce,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),o(r)?_e("v-if",!0):(S(),C("div",$e,[s("div",Qe,[s("div",Ee,[s("p",ke,m(o(i)("name")),1),u(y,{ref_key:"nameField",ref:w,modelValue:a.value.fullName,"onUpdate:modelValue":p[0]||(p[0]=f=>a.value.fullName=f),outlined:"",dense:"",placeholder:o(i)("input_name"),rules:g},null,8,["modelValue","placeholder"])]),s("div",Ne,[s("p",Ie,m(o(i)("email")),1),u(y,{outlined:"",dense:"","model-value":a.value.email,"bg-color":"grey-5",disable:""},null,8,["model-value"])])]),s("div",Ce,[s("div",Me,[s("p",Re,m(o(i)("mobile")),1),u(y,{ref_key:"mobileField",ref:$,modelValue:a.value.mobile,"onUpdate:modelValue":p[1]||(p[1]=f=>a.value.mobile=f),outlined:"",dense:"",mask:"############",placeholder:o(i)("input_mobile"),"unmasked-value":"",rules:Q},null,8,["modelValue","placeholder"])]),s("div",Ue,[s("p",je,m(o(i)("gender")),1),u(K,{ref_key:"sexField",ref:b,modelValue:a.value.gender,"onUpdate:modelValue":p[2]||(p[2]=f=>a.value.gender=f),options:o(E),label:o(i)("select_gender"),dense:"",outlined:"","map-options":"","option-label":"name","emit-value":"",onBlur:n},null,8,["modelValue","options","label"])])]),s("div",Le,[s("div",Oe,[s("p",Be,m(o(i)("role")),1),u(K,{"model-value":a.value.roleSn,label:o(i)("role"),options:o(v),"map-options":"",dense:"",outlined:"","option-label":"name","option-value":"sn","emit-value":"","bg-color":"grey-5",disable:""},null,8,["model-value","label","options"])]),De])])),s("div",Je,[u(z,{label:o(i)("save"),color:"negative",type:"submit",class:"q-px-lg","no-caps":"",unelevated:"",loading:o(c).isLoading.value,disable:o(r)},null,8,["label","loading","disable"])])]),_:1})])],64))}});var Ke=M(Ge,[["__file","D:/project_learn/goPMS/src/modules/profile/components/me-form.vue"]]);const Te=async l=>{const{data:e}=await j.post("/passport/changePassword",l);return e},ze=()=>T(Te),We={class:"row q-pb-md justify-between"},Ye={class:"text-h6 text-bold"},Ae={class:"row q-gutter-x-md"},Xe={class:"col"},He={class:"required text-bold q-my-xs"},Ze=s("div",{class:"col"},null,-1),es={class:"row q-gutter-x-md"},ss={class:"col"},ts={class:"required text-bold q-my-xs"},os={class:"col"},ls={class:"required text-bold q-my-xs"},as={class:"col-12 col-md-12 row justify-end"},ns=R({setup(l){const{t:e}=U(),{signOut:r}=A(),v=ze(),{notifyUpdateSuccess:x}=H(),c=_({curPassword:"",newPassword:"",reEnterPassword:""}),i=_(null),V=_(null),a=[n=>!!n||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters")],F=[n=>!!n||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters"),n=>{var d;return((d=c.value)==null?void 0:d.curPassword)!=n||e("your_current_password_is_incorrect")}],$=_(null),Q=[n=>!!n&&!!c.value.newPassword||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters"),n=>c.value.newPassword===n||e("the_new_password_and_re_enter_password_do_not_match")],w=_(!1),g=_(!1),b=_(!1),E=()=>{const{curPassword:n,newPassword:d}=c.value;v.mutate({curPassword:n,newPassword:d},{onSuccess:t=>{(t==null?void 0:t.code)===1&&(x(),r())}})};return(n,d)=>(S(),C(W,null,[s("div",We,[s("div",Ye,m(o(e)("change_password")),1)]),u(Y,{onSubmit:E},{default:h(()=>[s("div",Ae,[s("div",Xe,[s("p",He,m(o(e)("current_password")),1),u(y,{ref_key:"curPasswordField",ref:i,modelValue:c.value.curPassword,"onUpdate:modelValue":d[1]||(d[1]=t=>c.value.curPassword=t),outlined:"",dense:"",label:o(e)("input_current_password"),rules:a,type:w.value?"text":"password"},{append:h(()=>[u(N,{name:w.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[0]||(d[0]=t=>w.value=!w.value)},null,8,["name"])]),_:1},8,["modelValue","label","type"])]),Ze]),s("div",es,[s("div",ss,[s("p",ts,m(o(e)("new_password")),1),u(y,{ref_key:"newPasswordField",ref:V,modelValue:c.value.newPassword,"onUpdate:modelValue":d[3]||(d[3]=t=>c.value.newPassword=t),outlined:"",dense:"",label:o(e)("input_new_password"),rules:a&&F,type:b.value?"text":"password"},{append:h(()=>[u(N,{name:b.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[2]||(d[2]=t=>b.value=!b.value)},null,8,["name"])]),_:1},8,["modelValue","label","rules","type"])]),s("div",os,[s("p",ls,m(o(e)("re_enter_password")),1),u(y,{ref_key:"reEnterPasswordField",ref:$,modelValue:c.value.reEnterPassword,"onUpdate:modelValue":d[5]||(d[5]=t=>c.value.reEnterPassword=t),outlined:"",dense:"",label:o(e)("re_enter_new_password"),rules:Q,type:g.value?"text":"password"},{append:h(()=>[u(N,{name:g.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[4]||(d[4]=t=>g.value=!g.value)},null,8,["name"])]),_:1},8,["modelValue","label","type"])])]),s("div",as,[u(z,{label:o(e)("save"),color:"negative",type:"submit",class:"q-px-lg","no-caps":"",unelevated:"",loading:o(v).isLoading.value},null,8,["label","loading"])])]),_:1})],64))}});var rs=M(ns,[["__file","D:/project_learn/goPMS/src/modules/profile/components/change-password-form.vue"]]);const is=l=>(ve("data-v-6dec1eac"),l=l(),fe(),l),ds={class:"row q-mb-md justify-between"},us={class:"text-h5 text-bold"},cs=is(()=>s("hr",{class:"q-my-md"},null,-1)),_s={name:"Profile"},ms=R(J(q({},_s),{setup(l){const{t:e}=U();return(r,v)=>{const x=me("pms-sections");return S(),pe(x,null,{header:h(()=>[s("div",ds,[s("div",us,m(o(e)("my_account")),1)])]),default:h(()=>[u(Ke),cs,u(rs)]),_:1})}}}));var Es=M(ms,[["__scopeId","data-v-6dec1eac"],["__file","D:/project_learn/goPMS/src/modules/profile/view.vue"]]);export{Es as default};
