var Ee=Object.defineProperty,Oe=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var pe=(l,s,d)=>s in l?Ee(l,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[s]=d,_e=(l,s)=>{for(var d in s||(s={}))Le.call(s,d)&&pe(l,d,s[d]);if(me)for(var d of me(s))je.call(s,d)&&pe(l,d,s[d]);return l},fe=(l,s)=>Oe(l,Ae(s));import{aE as Be,aF as ke,bj as he,_ as oe,J as le,r as f,a as j,F as k,L as M,M as a,N as o,I as t,R as m,P as e,q as A,Q as I,aM as He,aH as Se,aI as T,T as we,G as x,V as ae,W as B,aP as ye,aQ as be,aR as De,aS as Ie,aT as xe,w as ve,U as J,bq as ze,aO as F,O as Q}from"./index.4bd8ab7e.js";import{Q as Ve}from"./QInnerLoading.36fa411b.js";import{Q as Ke,a as ge,c as R,b as We}from"./QTable.87be80e4.js";import{Q as G}from"./QTooltip.a00a2acf.js";import{Q as Xe}from"./QPagination.952d6437.js";import{u as se}from"./useI18n.96209f4d.js";import{u as Je}from"./use-quasar.fa06306f.js";import{d as C}from"./date.525ad423.js";import{b as ie,c as te,u as Ge,d as Z}from"./axiosClient.ad61c203.js";import{Q as H}from"./queryKeys.832af9fa.js";import{Q as Te}from"./QToolbarTitle.dfdc5985.js";import{Q as Ce}from"./QToolbar.06ebec8c.js";import{Q as qe}from"./QDate.20311372.js";import{Q as $e}from"./QPopupProxy.0d4ba934.js";import{Q as Ze}from"./QForm.8a0c543d.js";import{C as L}from"./ClosePopup.34597da2.js";import{u as et,I as Pe,a as tt,b as ot}from"./import-stock-edit-modal.523a9d4a.js";import{u as Qe}from"./useNotify.6f32b3a1.js";import{f as ne,a as lt}from"./useFormat.349e799c.js";import{F as at}from"./filter.e22c1f76.js";import"./QList.550b5ccf.js";import"./QSelect.2521a28c.js";import"./QMenu.d60d439b.js";import"./position-engine.e365a736.js";import"./selection.cdf30163.js";import"./QItemLabel.0748896a.js";import"./rtl.4b414a6d.js";import"./use-cache.b0833c75.js";import"./useCategoryServiceQuery.1a080013.js";const st=C.formatDate(new Date,"DD/MM/YYYY"),ee=(l=st)=>{const[s,d,v]=l.split("/");return`${v}/${d}/${s}`},it=async l=>{var d,v;const{data:s}=await ie.get(`/inventory/stock/getImportStockList?page=${(v=(d=l.page)==null?void 0:d.value)==null?void 0:v.currentPage}&limit=${l.limit}&displayType=${l.displayType.value.id}&startTime=${l.startTime.value?Number(C.formatDate(ee(l.startTime.value),"X")):Number(C.formatDate(ee(l.startWeek.value),"X"))}&endTime=${Number(C.formatDate(ee(l.endTime.value),"X"))}`);return s},nt=l=>Be([H.IMPORT_STOCK,{params:l}],()=>it(l)),rt=async l=>{const{data:s}=await ie.post("/inventory/stock/removeImportStock",l);return s},ct=()=>{const l=he();return ke(rt,{onSuccess:(s,d)=>{const v=l.getQueryData(H.IMPORT_STOCK);if(!v)return;const{data:r}=v;!r||l.setQueryData(H.IMPORT_STOCK,()=>fe(_e({},v),{data:r.filter(b=>b.importStockSn!==d.importStockSn)}))}})},dt=async l=>{const{data:s}=await ie.post("/inventory/stock/createImportStock",l);return s},ut=()=>{const l=he();return ke(dt,{onSuccess:()=>{l.invalidateQueries(H.STAFF)}})};const mt=l=>(Ie("data-v-25889082"),l=l(),xe(),l),pt={class:"text-h6 text-weight-bold q-pa-md"},_t={class:"col-12 col-md-6 q-pr-md"},ft={class:"text-weight-bold"},vt={class:"col-12 col-md-6"},gt={class:"text-weight-bold"},kt={class:"row items-center justify-end"},ht={class:"col-12 col-md-12"},St={class:"text-weight-bold"},wt={class:"q-pt-md col-12"},yt={class:"q-pa-md bg-grey-2"},bt={class:"row col-12 col-md-12"},Dt={class:"col-6 text-h7 text-weight-bold"},It={class:"col-sm-6 col-xs-12 text-h7 text-weight-bold"},xt={class:"col-12 q-pt-md col-md-12"},Vt={class:"row col-12 col-md-12"},Tt={class:"col-md-8 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},Ct={class:"text-h7 text-weight-bold"},qt={class:"col-md-4 col-sm-6 col-xs-12"},$t={class:"col-md-4 col-sm-6 col-xs-12"},Pt=mt(()=>t("span",{class:"text-orange-10 text-subtitle2 text-weight-bold"},"VND",-1)),Qt={class:"row col-12 col-md-12 justify-end q-pa-sm q-px-sm"},Mt=le({props:{modelValue:{type:Boolean,required:!0}},emits:["close","update:modelValue","changeSuccess"],setup(l,{expose:s,emit:d}){const v=l,{t:r}=se(),b=f(),Y=ut(),h=et(),{notifyUpdateSuccess:D}=Qe(),i=f({receiptID:"",receiptDateTime:"",note:"",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}),V=()=>{var u;(u=i.value)==null||u.importStockDetail.push({categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0})},q=j({get(){return v.modelValue},set(u){d("update:modelValue",u)}}),$=f(null),_=[u=>200>(u==null?void 0:u.length)||r("the_length_is_from_0_to_200_characters")],y=j(()=>{var u,c;return((c=(u=i==null?void 0:i.value)==null?void 0:u.note)==null?void 0:c.length)>201}),S=u=>{i.value.importStockDetail.splice(u,1),N()},U=()=>{z()},z=()=>{i.value={receiptID:"",receiptDateTime:"",note:" ",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}},E=()=>{var u;i.value.note===null&&(i.value.note=""),(u=b.value)==null||u.validate().then(c=>{if(c)Y.mutate(i.value,{onSuccess:async()=>{D(),await setTimeout(()=>{d("close"),i.value={receiptID:"",receiptDateTime:"",note:"",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}},900)}});else return!1})},N=()=>{let u=0;if(i.value.importStockDetail.map(function(c){(!c.categorySn||!c.productSn)&&(u=1)}),u===0){const c={importStock:[...i.value.importStockDetail]};h.mutate(c,{onSuccess:g=>{i.value.totalPrice=g.data.totalPrice,i.value.importStockDetail=g.data.importStockList}})}else return};return s({setupCreateImportStockDialog:async()=>{console.log("setup")}}),(u,c)=>(k(),M(De,{modelValue:e(q),"onUpdate:modelValue":c[4]||(c[4]=g=>be(q)?q.value=g:null),"full-width":"",onHide:U},{default:a(()=>[o(ye,null,{default:a(()=>[o(Ce,{class:"q-pa-md"},{default:a(()=>[o(Te,null,{default:a(()=>[t("div",pt,m(e(r)("new_import_receipt")),1)]),_:1}),A(o(I,{class:"q-pa-md",flat:"",round:"",dense:"",icon:"close"},null,512),[[L]])]),_:1}),t("div",null,[o(Ze,{ref_key:"changeCreateImportStockRef",ref:b,class:"q-gutter-md q-pa-md",onSubmit:He(E,["prevent","stop"])},{default:a(()=>[o(Se,{class:"row"},{default:a(()=>[t("div",_t,[t("p",ft,m(e(r)("import_receipt_id")),1),o(T,{ref:"nameField",modelValue:i.value.receiptID,"onUpdate:modelValue":c[0]||(c[0]=g=>i.value.receiptID=g),"bg-color":"grey-3",filled:"",dense:"",disable:""},null,8,["modelValue"])]),t("div",vt,[t("p",gt,m(e(r)("import_date_time")),1),o(T,{modelValue:i.value.receiptDateTime,"onUpdate:modelValue":c[2]||(c[2]=g=>i.value.receiptDateTime=g),"bg-color":"grey-3",dense:"",disable:"",filled:""},{prepend:a(()=>[o(we,{name:"event",class:"cursor-pointer"},{default:a(()=>[o($e,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[o(qe,{modelValue:i.value.receiptDateTime,"onUpdate:modelValue":c[1]||(c[1]=g=>i.value.receiptDateTime=g),mask:"YYYY-MM-DD HH:mm"},{default:a(()=>[t("div",kt,[A(o(I,{label:"Close",color:"primary",flat:""},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",ht,[t("p",St,m(e(r)("note")),1),o(T,{ref_key:"note",ref:$,modelValue:i.value.note,"onUpdate:modelValue":c[3]||(c[3]=g=>i.value.note=g),"bg-color":"grey-1",placeholder:e(r)("input_note"),filled:"",autogrow:"",rules:_,error:e(y)},{error:a(()=>[t("p",null,m(e(r)("the_length_is_from_0_to_200_characters")),1)]),_:1},8,["modelValue","placeholder","error"])]),t("div",wt,[t("div",yt,[t("div",bt,[t("div",Dt,m(e(r)("import_stock")),1),t("div",It,[o(I,{outline:"",class:"btn-fixed-width float-right",color:"negative","no-caps":"",label:e(r)("add_new"),icon:"add_circle",onClick:V},null,8,["label"])])]),(k(!0),x(B,null,ae(i.value.importStockDetail,(g,P)=>(k(),x("div",{key:P,class:"row col-12 col-md-12"},[o(Pe,{"data-stock":g,view:2,index:P,onCalculateAmoundStock:N,onDeleteImportStockView:W=>S(P)},null,8,["data-stock","index","onDeleteImportStockView"])]))),128))])]),t("div",xt,[t("div",Vt,[t("div",Tt,[t("p",Ct,m(e(r)("total_price")),1)]),t("div",qt,[t("div",$t,[o(T,{"model-value":e(ne)(i.value.totalPrice),"input-class":"text-orange-10 text-weight-bold text-right","bg-color":"orange-1",disable:"",filled:"",dense:""},{append:a(()=>[Pt]),_:1},8,["model-value"])])])])])]),_:1}),t("div",Qt,[A(o(I,{label:e(r)("cancel"),dense:"",outline:"","no-caps":"",class:"q-mr-md",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[L]]),o(I,{"no-caps":"",label:e(r)("save"),type:"submit",color:"negative"},null,8,["label"])])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"]))}});var Ut=oe(Mt,[["__scopeId","data-v-25889082"],["__file","D:/project_learn/goPMS/src/modules/stock/import/components/import-stock-create-modal.vue"]]);const Nt=l=>(Ie("data-v-47f6e66b"),l=l(),xe(),l),Rt={class:"text-h6 q-ma-none q-pa-md text-weight-bold"},Ft={key:0,class:"wrapper q-pa-md"},Yt={key:1,class:"q-gutter-md q-pa-md"},Et={class:"col-12 col-md-6 q-pr-md"},Ot={class:"q-ma-none text-weight-bold"},At={class:"col-12 col-md-6"},Lt={class:"q-ma-none text-weight-bold"},jt={class:"row items-center justify-end"},Bt={class:"col-12 col-md-12"},Ht={class:"q-ma-none text-weight-bold"},zt={class:"q-pt-md col-12"},Kt={class:"q-pa-md bg-grey-2"},Wt={class:"row col-12 col-md-12"},Xt={class:"col-6 text-h7 q-ma-none text-weight-bold"},Jt={class:"col-12 q-pt-md col-md-12"},Gt={class:"row col-12 col-md-12"},Zt={class:"col-md-8 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},eo={class:"text-h7 q-ma-none text-weight-bold"},to={class:"col-md-4 col-sm-6 col-xs-12"},oo=Nt(()=>t("span",{class:"text-orange-10 text-subtitle2 text-weight-bold"},"VND",-1)),lo=le({props:{modelValue:{type:Boolean,require:!0}},emits:["close","update:modelValue"],setup(l,{expose:s,emit:d}){const v=l,{t:r}=se(),b=f(-1);s({setupCreateImportStockDialog:async _=>{b.value=_,i.value()}});const{data:h,isLoading:D,refetch:i}=tt({stockSn:b,isDelete:1}),V=f(null),q=[_=>!!_||r("this_field_is_required"),_=>(_==null?void 0:_.length)>=1&&(_==null?void 0:_.length)<51||r("the_length_is_from_1_to_50_characters")],$=j({get(){return v.modelValue},set(_){d("update:modelValue",_)}});return(_,y)=>(k(),M(De,{modelValue:e($),"onUpdate:modelValue":y[2]||(y[2]=S=>be($)?$.value=S:null),"full-width":""},{default:a(()=>[o(ye,{class:"view-form"},{default:a(()=>[o(Ce,{class:"q-pa-md"},{default:a(()=>[o(Te,null,{default:a(()=>[t("div",Rt,m(e(r)("import_receipt_detail")),1)]),_:1}),A(o(I,{class:"q-pa-md",flat:"",round:"",dense:"",icon:"close"},null,512),[[L]])]),_:1}),t("div",null,[e(D)?(k(),x("div",Ft,[o(Ve,{showing:e(D),label:"Please wait...","lab55el-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"])])):(k(),x("form",Yt,[o(Se,{class:"row"},{default:a(()=>[t("div",Et,[t("p",Ot,m(e(r)("import_receipt_id")),1),o(T,{ref_key:"nameField",ref:V,modelValue:e(h).importStock.receiptId,"onUpdate:modelValue":y[0]||(y[0]=S=>e(h).importStock.receiptId=S),filled:"",disable:"",dense:"",placeholder:e(r)("import_receipt_id"),"lazy-rules":"",rules:q},null,8,["modelValue","placeholder"])]),t("div",At,[t("p",Lt,m(e(r)("import_date_time")),1),o(T,{"model-value":e(C).formatDate(e(h).importStock.importDate*1e3,e(te)),disable:"",dense:"",filled:""},{prepend:a(()=>[o(we,{name:"event",class:"cursor-pointer"},{default:a(()=>[o($e,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[o(qe,{"model-value":e(C).formatDate(e(h).importStock.importDate*1e3,e(te)),mask:"YYYY-MM-DD HH:mm"},{default:a(()=>[t("div",jt,[A(o(I,{label:"Close",color:"primary",flat:""},null,512),[[L]])])]),_:1},8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value"])]),t("div",Bt,[t("p",Ht,m(e(r)("note")),1),o(T,{modelValue:e(h).importStock.note,"onUpdate:modelValue":y[1]||(y[1]=S=>e(h).importStock.note=S),disable:"",filled:"",autogrow:""},null,8,["modelValue"])]),t("div",zt,[t("div",Kt,[t("div",Wt,[t("div",Xt,m(e(r)("import_stock")),1)]),(k(!0),x(B,null,ae(e(h).importStockDetailList,(S,U)=>(k(),x("div",{key:U,class:"row col-12 col-md-12"},[o(Pe,{index:U,"data-stock":S,view:1},null,8,["index","data-stock"])]))),128))])]),t("div",Jt,[t("div",Gt,[t("div",Zt,[t("p",eo,m(e(r)("total_price")),1)]),t("div",to,[o(T,{"model-value":e(ne)(e(h).importStock.totalPrice),"input-class":"text-orange-10 text-weight-bold text-right","bg-color":"orange-1",disable:"",filled:"",dense:""},{append:a(()=>[oo]),_:1},8,["model-value"])])])])]),_:1})]))])]),_:1})]),_:1},8,["modelValue"]))}});var ao=oe(lo,[["__scopeId","data-v-47f6e66b"],["__file","D:/project_learn/goPMS/src/modules/stock/import/components/import-stock-view-modal.vue"]]);const so={class:"relative-position",style:{"min-height":"200px"}},io={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},no={key:0},ro={class:"row align-left"},co=["onClick"],uo={class:"row justify-between"},mo=F("Seen"),po={class:"q-mt-md row justify-end"},_o=le({setup(l){const{t:s}=se(),d=Je(),v=C.formatDate,{hasPermission:r}=Ge(),b=f(null),Y=f(null),h=f(null),D=f(!1),i=f(!1),V=f(!1),q=()=>{D.value=!1,X.value()},{notifyUpdateSuccess:$}=Qe(),_=()=>{i.value=!1,X.value()},y=()=>{V.value=!1},S=f({key:"All receipts",id:0}),U=f({key:"Today",id:1}),z=j(()=>[{name:"index",label:s("no"),field:"index",align:"left"},{name:"importDate",label:s("import_date_time"),field:"importDate",align:"left"},{name:"receiptId",label:s("import_receipt_id"),field:"receiptId",align:"left"},{name:"totalPrice",label:s("total"),field:"totalPrice",align:"right"},{name:"note",label:s("note"),field:"note",align:"left"},{name:"action",label:"",field:"action",align:"left"}]);let E=new Date,N=f(v(Date.now(),Z)),K=f(v(Date.now(),Z)),u=f(v(new Date(E.getFullYear(),E.getMonth(),E.getDate()-7),Z)),c=f({currentPage:1,lastPage:1});const g=ct();ve(S,()=>{c.value.currentPage=1}),ve(U,()=>{c.value.currentPage=1});let{data:P,isLoading:W,refetch:X}=nt({page:c,limit:10,startWeek:u,displayType:S,startTime:N.value?N:u,endTime:K});const Me=w=>{u.value=w.startWeek,c.value.currentPage=1,N.value=w.startTime,K.value=w.endTime,S.value=w.valuereceipts},Ue=w=>{d.dialog({message:s("are_you_sure_delete_import_receipt"),cancel:{color:"grey-8",label:s("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:s("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{g.mutate({importStockSn:w},{onSuccess:p=>{(p==null?void 0:p.code)===1&&$(),X.value()}})}).onCancel(()=>{})},Ne=w=>{var p;V.value=!0,(p=h.value)==null||p.setupCreateImportStockDialog(Number(w))},Re=()=>{D.value=!0},Fe=w=>{var p;i.value=!0,(p=Y.value)==null||p.setupEditImportStockDialog(Number(w))},Ye=()=>{Re()};return(w,p)=>{var re,ce,de,ue;return k(),x(B,null,[t("div",so,[t("div",null,[o(at,{"booking-no-field":!1,"is-add":!0,"is-category":!1,onChangeSuccess:Me,onAddImportReceipt:Ye}),o(Ve,{showing:e(W),label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:a(()=>[t("div",io,[o(ze,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),e(W)?J("v-if",!0):(k(),x("div",no,[e(P)?(k(),M(Ke,{key:0,rows:(ce=(re=e(P))==null?void 0:re.data)==null?void 0:ce.importStockList,columns:e(z),"table-colspan":9,"table-header-class":"custom-header","row-key":"index","no-data-label":"No data","virtual-scroll-item-size":48,"rows-per-page-options":[0],"hide-pagination":"","hide-bottom":""},{header:a(n=>[o(ge,{props:n},{default:a(()=>[(k(!0),x(B,null,ae(n.cols,O=>(k(),M(We,{key:O.name,props:n},{default:a(()=>[F(m(O.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:a(n=>[o(ge,{props:n},{default:a(()=>[o(R,{key:"index",props:n,class:Q(n.row.deleteTime?"opacity-view":"")},{default:a(()=>[F(m(e(lt)(e(c).currentPage,n.pageIndex)),1)]),_:2},1032,["props","class"]),o(R,{key:"importDate"},{default:a(()=>[t("div",{class:Q(["row align-left",n.row.deleteTime?"opacity-view":""])},m(e(C).formatDate(n.row.importDate*1e3,e(te))),3)]),_:2},1024),o(R,{key:"receiptId"},{default:a(()=>[t("div",ro,[t("span",{class:Q(["q-ml-xs",!n.row.deleteTime&&e(r)("add-edit-delete-import-receipt")==!0?"doc-link":"opacity-view"]),onClick:O=>!n.row.deleteTime&&e(r)("add-edit-delete-import-receipt")==!0?Fe(n.row.sn):""},m(n.row.receiptId),11,co)])]),_:2},1024),o(R,{key:"totalPrice"},{default:a(()=>[t("div",{class:Q(["text-right",n.row.deleteTime?"opacity-view":""])},m(e(ne)(n.row.totalPrice))+" VND ",3)]),_:2},1024),o(R,{key:"note"},{default:a(()=>[t("div",uo,[t("div",{class:Q([n.row.deleteTime?"opacity-view":"","limit-text"])},[F(m(n.row.note)+" ",1),n.row.note?(k(),M(G,{key:0},{default:a(()=>[F(m(n.row.note),1)]),_:2},1024)):J("v-if",!0)],2)])]),_:2},1024),o(R,{key:"action",class:"text-align-end"},{default:a(()=>[n.row.deleteTime?(k(),M(I,{key:1,dense:"",round:"",flat:"",class:Q(e(r)("view-import-receipt-detail")===!1?"hidden":""),icon:"visibility",onClick:O=>Ne(n.row.sn)},{default:a(()=>[o(G,null,{default:a(()=>[mo]),_:1})]),_:2},1032,["class","onClick"])):(k(),M(I,{key:0,dense:"",round:"",flat:"",class:Q(e(r)("add-edit-delete-import-receipt")===!1?"hidden":""),icon:"delete",onClick:O=>Ue(n.row.sn)},{default:a(()=>[o(G,null,{default:a(()=>[F(m(e(s)("delete")),1)]),_:1})]),_:2},1032,["class","onClick"]))]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])):J("v-if",!0),t("div",po,[o(Xe,{modelValue:e(c).currentPage,"onUpdate:modelValue":p[0]||(p[0]=n=>e(c).currentPage=n),color:"negative",max:((ue=(de=e(P))==null?void 0:de.data)==null?void 0:ue.meta.lastPage)||1,"max-pages":6,"direction-links":""},null,8,["modelValue","max"])])]))])]),o(Ut,{ref_key:"importStockCreateRef",ref:b,modelValue:D.value,"onUpdate:modelValue":p[1]||(p[1]=n=>D.value=n),onClose:q},null,8,["modelValue"]),o(ot,{ref_key:"importStockEditRef",ref:Y,modelValue:i.value,"onUpdate:modelValue":p[2]||(p[2]=n=>i.value=n),onClose:_},null,8,["modelValue"]),o(ao,{ref_key:"importStockViewRef",ref:h,modelValue:V.value,"onUpdate:modelValue":p[3]||(p[3]=n=>V.value=n),onClose:y},null,8,["modelValue"])],64)}}});var Bo=oe(_o,[["__scopeId","data-v-6b059f76"],["__file","D:/project_learn/goPMS/src/modules/stock/import/view.vue"]]);export{Bo as default};
