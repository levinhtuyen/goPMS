var Pe=Object.defineProperty,Qe=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var re=(l,o,c)=>o in l?Pe(l,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[o]=c,se=(l,o)=>{for(var c in o||(o={}))Fe.call(o,c)&&re(l,c,o[c]);if(ae)for(var c of ae(o))ze.call(o,c)&&re(l,c,o[c]);return l},oe=(l,o)=>Qe(l,Ae(o));import{Q as Le}from"./QSelect.2521a28c.js";import{c as Oe,d as pe,f as Ve,r as L,b9 as $e,a as C,w as I,b as h,bd as Be,bq as me,T as ce,bw as be,a0 as de,q as Ie,an as Me,g as Re,n as Ue,bv as ue,aE as je,aF as De,bj as Je,_ as Ge,J as Ye,aC as He,K as fe,F as D,L as he,M as z,I as w,R as B,P as T,N as E,aO as ve,Q as We,G as ye,am as Xe,O as ge,U as Ze}from"./index.4bd8ab7e.js";import{Q as et}from"./QSlideTransition.a9dd61c4.js";import{Q as tt}from"./QInnerLoading.36fa411b.js";import{b as ke,u as lt}from"./axiosClient.ad61c203.js";import{u as it}from"./use-quasar.fa06306f.js";import{Q as _e}from"./queryKeys.832af9fa.js";import{u as nt}from"./roleQuery.b5a77f7e.js";import{u as at}from"./useI18n.96209f4d.js";import{u as rt}from"./useNotify.6f32b3a1.js";import"./QMenu.d60d439b.js";import"./position-engine.e365a736.js";import"./selection.cdf30163.js";import"./QItemLabel.0748896a.js";import"./rtl.4b414a6d.js";const st=["none","strict","leaf","leaf-filtered"];var ot=Oe({name:"QTree",props:oe(se({},pe),{nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>st.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noNodesLabel:String,noResultsLabel:String}),emits:["update:expanded","update:ticked","update:selected","lazy-load","after-show","after-hide"],setup(l,{slots:o,emit:c}){const{proxy:q}=Re(),{$q:_}=q,O=Ve(l,_),x=L({}),m=L(l.ticked||[]),k=L(l.expanded||[]);let p={};$e(()=>{p={}});const V=C(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(O.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),M=C(()=>l.selected!==void 0),J=C(()=>l.icon||_.iconSet.tree.icon),R=C(()=>l.controlColor||l.color),K=C(()=>l.textColor!==void 0?` text-${l.textColor}`:""),G=C(()=>{const e=l.selectedColor||l.color;return e?` text-${e}`:""}),N=C(()=>l.filterMethod!==void 0?l.filterMethod:(e,i)=>{const t=i.toLowerCase();return e[l.labelKey]&&e[l.labelKey].toLowerCase().indexOf(t)>-1}),v=C(()=>{const e={},i=(t,a)=>{const n=t.tickStrategy||(a?a.tickStrategy:l.tickStrategy),s=t[l.nodeKey],d=t[l.childrenKey]&&t[l.childrenKey].length>0,$=d!==!0,f=t.disabled!==!0&&M.value===!0&&t.selectable!==!1,le=t.disabled!==!0&&t.expandable!==!1,Ee=n!=="none",j=n==="strict",ie=n==="leaf-filtered",H=n==="leaf"||n==="leaf-filtered";let W=t.disabled!==!0&&t.tickable!==!1;H===!0&&W===!0&&a&&a.tickable!==!0&&(W=!1);let F=t.lazy;F===!0&&x.value[s]!==void 0&&Array.isArray(t[l.childrenKey])===!0&&(F=x.value[s]);const r={key:s,parent:a,isParent:d,isLeaf:$,lazy:F,disabled:t.disabled,link:t.disabled!==!0&&(f===!0||le===!0&&(d===!0||F===!0)),children:[],matchesFilter:l.filter?N.value(t,l.filter):!0,selected:s===l.selected&&f===!0,selectable:f,expanded:d===!0?k.value.includes(s):!1,expandable:le,noTick:t.noTick===!0||j!==!0&&F&&F!=="loaded",tickable:W,tickStrategy:n,hasTicking:Ee,strictTicking:j,leafFilteredTicking:ie,leafTicking:H,ticked:j===!0||$===!0?m.value.includes(s):!1};if(e[s]=r,d===!0&&(r.children=t[l.childrenKey].map(u=>i(u,r)),l.filter&&(r.matchesFilter!==!0?r.matchesFilter=r.children.some(u=>u.matchesFilter):r.noTick!==!0&&r.disabled!==!0&&r.tickable===!0&&ie===!0&&r.children.every(u=>u.matchesFilter!==!0||u.noTick===!0||u.tickable!==!0)===!0&&(r.tickable=!1)),r.matchesFilter===!0&&(r.noTick!==!0&&j!==!0&&r.children.every(u=>u.noTick)===!0&&(r.noTick=!0),H))){if(r.ticked=!1,r.indeterminate=r.children.some(u=>u.indeterminate===!0),r.tickable=r.tickable===!0&&r.children.some(u=>u.tickable),r.indeterminate!==!0){const u=r.children.reduce((ne,Ne)=>Ne.ticked===!0?ne+1:ne,0);u===r.children.length?r.ticked=!0:u>0&&(r.indeterminate=!0)}r.indeterminate===!0&&(r.indeterminateNextState=r.children.every(u=>u.tickable!==!0||u.ticked!==!0))}return r};return l.nodes.forEach(t=>i(t,null)),e});I(()=>l.ticked,e=>{m.value=e}),I(()=>l.expanded,e=>{k.value=e});function P(e){const i=[].reduce,t=(a,n)=>{if(a||!n)return a;if(Array.isArray(n)===!0)return i.call(Object(n),t,a);if(n[l.nodeKey]===e)return n;if(n[l.childrenKey])return t(null,n[l.childrenKey])};return t(null,l.nodes)}function y(){return m.value.map(e=>P(e))}function g(){return k.value.map(e=>P(e))}function S(e){return e&&v.value[e]?v.value[e].expanded:!1}function Q(){l.expanded!==void 0?c("update:expanded",[]):k.value=[]}function b(){const e=k.value,i=t=>{t[l.childrenKey]&&t[l.childrenKey].length>0&&t.expandable!==!1&&t.disabled!==!0&&(e.push(t[l.nodeKey]),t[l.childrenKey].forEach(i))};l.nodes.forEach(i),l.expanded!==void 0?c("update:expanded",e):k.value=e}function A(e,i,t=P(e),a=v.value[e]){if(a.lazy&&a.lazy!=="loaded"){if(a.lazy==="loading")return;x.value[e]="loading",Array.isArray(t[l.childrenKey])!==!0&&(t[l.childrenKey]=[]),c("lazy-load",{node:t,key:e,done:n=>{x.value[e]="loaded",t[l.childrenKey]=Array.isArray(n)===!0?n:[],Ue(()=>{const s=v.value[e];s&&s.isParent===!0&&X(e,!0)})},fail:()=>{delete x.value[e],t[l.childrenKey].length===0&&delete t[l.childrenKey]}})}else a.isParent===!0&&a.expandable===!0&&X(e,i)}function X(e,i){let t=k.value;const a=l.expanded!==void 0;if(a===!0&&(t=t.slice()),i){if(l.accordion&&v.value[e]){const n=[];v.value[e].parent?v.value[e].parent.children.forEach(s=>{s.key!==e&&s.expandable===!0&&n.push(s.key)}):l.nodes.forEach(s=>{const d=s[l.nodeKey];d!==e&&n.push(d)}),n.length>0&&(t=t.filter(s=>n.includes(s)===!1))}t=t.concat([e]).filter((n,s,d)=>d.indexOf(n)===s)}else t=t.filter(n=>n!==e);a===!0?c("update:expanded",t):k.value=t}function xe(e){return e&&v.value[e]?v.value[e].ticked:!1}function U(e,i){let t=m.value;const a=l.ticked!==void 0;a===!0&&(t=t.slice()),i?t=t.concat(e).filter((n,s,d)=>d.indexOf(n)===s):t=t.filter(n=>e.includes(n)===!1),a===!0&&c("update:ticked",t)}function Se(e,i,t){const a={tree:q,node:e,key:t,color:l.color,dark:O.value};return ue(a,"expanded",()=>i.expanded,n=>{n!==i.expanded&&A(t,n)}),ue(a,"ticked",()=>i.ticked,n=>{n!==i.ticked&&U([t],n)}),a}function Z(e){return(l.filter?e.filter(i=>v.value[i[l.nodeKey]].matchesFilter):e).map(i=>Ke(i))}function qe(e){if(e.icon!==void 0)return h(ce,{class:"q-tree__icon q-mr-sm",name:e.icon,color:e.iconColor});const i=e.img||e.avatar;if(i)return h("img",{class:`q-tree__${e.img?"img":"avatar"} q-mr-sm`,src:i})}function Ce(){c("after-show")}function we(){c("after-hide")}function Ke(e){const i=e[l.nodeKey],t=v.value[i],a=e.header&&o[`header-${e.header}`]||o["default-header"],n=t.isParent===!0?Z(e[l.childrenKey]):[],s=n.length>0||t.lazy&&t.lazy!=="loaded";let d=e.body&&o[`body-${e.body}`]||o["default-body"];const $=a!==void 0||d!==void 0?Se(e,t,i):null;return d!==void 0&&(d=h("div",{class:"q-tree__node-body relative-position"},[h("div",{class:K.value},[d($)])])),h("div",{key:i,class:`q-tree__node relative-position q-tree__node--${s===!0?"parent":"child"}`},[h("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(t.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(t.selected===!0?" q-tree__node--selected":"")+(t.disabled===!0?" q-tree__node--disabled":""),tabindex:t.link===!0?0:-1,onClick:f=>{te(e,t,f)},onKeypress(f){Be(f)!==!0&&(f.keyCode===13?te(e,t,f,!0):f.keyCode===32&&Y(e,t,f,!0))}},[h("div",{class:"q-focus-helper",tabindex:-1,ref:f=>{p[t.key]=f}}),t.lazy==="loading"?h(me,{class:"q-tree__spinner",color:R.value}):s===!0?h(ce,{class:"q-tree__arrow"+(t.expanded===!0?" q-tree__arrow--rotate":""),name:J.value,onClick(f){Y(e,t,f)}}):null,t.hasTicking===!0&&t.noTick!==!0?h(be,{class:"q-tree__tickbox",modelValue:t.indeterminate===!0?null:t.ticked,color:R.value,dark:O.value,dense:!0,keepColor:!0,disable:t.tickable!==!0,onKeydown:de,"onUpdate:modelValue":f=>{Te(t,f)}}):null,h("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(t.selected===!0?G.value:K.value)},[a?a($):[qe(e),h("div",e[l.labelKey])]])]),s===!0?h(et,{duration:l.duration,onShow:Ce,onHide:we},()=>Ie(h("div",{class:"q-tree__node-collapsible"+K.value,key:`${i}__q`},[d,h("div",{class:"q-tree__children"+(t.disabled===!0?" q-tree__node--disabled":"")},n)]),[[Me,t.expanded]])):d])}function ee(e){const i=p[e];i&&i.focus()}function te(e,i,t,a){a!==!0&&ee(i.key),M.value&&i.selectable?l.noSelectionUnset===!1?c("update:selected",i.key!==l.selected?i.key:null):i.key!==l.selected&&c("update:selected",i.key||null):Y(e,i,t,a),typeof e.handler=="function"&&e.handler(e)}function Y(e,i,t,a){t!==void 0&&de(t),a!==!0&&ee(i.key),A(i.key,!i.expanded,e,i)}function Te(e,i){if(e.indeterminate===!0&&(i=e.indeterminateNextState),e.strictTicking)U([e.key],i);else if(e.leafTicking){const t=[],a=n=>{n.isParent?(i!==!0&&n.noTick!==!0&&n.tickable===!0&&t.push(n.key),n.leafTicking===!0&&n.children.forEach(a)):n.noTick!==!0&&n.tickable===!0&&(n.leafFilteredTicking!==!0||n.matchesFilter===!0)&&t.push(n.key)};a(e),U(t,i)}}return Object.assign(q,{getNodeByKey:P,getTickedNodes:y,getExpandedNodes:g,isExpanded:S,collapseAll:Q,expandAll:b,setExpanded:A,isTicked:xe,setTicked:U}),l.defaultExpandAll===!0&&b(),()=>{const e=Z(l.nodes);return h("div",{class:V.value},e.length===0?l.filter?l.noResultsLabel||_.lang.tree.noResults:l.noNodesLabel||_.lang.tree.noNodes:e)}}});const ct=async l=>{var c;const{data:o}=await ke.get("/passport/getPermissionList",{params:{roleSn:(c=l.value)==null?void 0:c.sn}});return o.data},dt=l=>je([_e.PERMISSION,l],()=>ct(l)),ut=async l=>{const{data:o}=await ke.post("/passport/grantPermission",l);return o},ft=()=>{const l=Je();return De(ut,{onSuccess:()=>{l.invalidateQueries(_e.PERMISSION)}})};const ht={class:"q-ma-none q-px-lg q-pb-md text-bold"},vt={class:"text-bold q-my-xs"},yt={key:0,class:"container q-pt-md borders-table q-mt-md q-mx-lg"},gt={class:"q-mx-md text-bold"},mt={class:"block",style:{width:"100%"}},bt={key:1,class:"full-width full-height q-mt-md row justify-center relative-position"},kt={lass:"full-width full-height q-mt-md row justify-center"},_t={class:"q-pt-xl q-gutter-sm row justify-end items-center q-gutter-lg"},xt=Ye({setup(l){const{profile:o,hasPermission:c}=lt(),q=it(),{t:_}=at(),{notifyUpdateSuccess:O}=rt(),x=L(),{data:m,isFetching:k,refetch:p}=dt(x),V=L(),{data:M,isFetching:J,refetch:R}=nt(),K=L(),G=ft();let N=[{}];I(k,()=>{V.value=m!=null&&m.value?JSON.parse(JSON.stringify(m==null?void 0:m.value)):[]}),I(J,()=>{K.value=JSON.parse(JSON.stringify(M.value)),x.value=K.value.find(y=>{var g;return y.sn===Number((g=o.value)==null?void 0:g.roleSn)})}),I(()=>He.global.locale.value,()=>{R.value(),p.value()});const v=y=>{var g;N.push({permissionSn:y.sn,grant:y.grant}),((g=y.children)==null?void 0:g.length)>0&&y.children.forEach(S=>{var Q;S.grant=S.status=y.grant,((Q=S.children)==null?void 0:Q.length)>0?v(S):N.push({permissionSn:S.sn,grant:S.grant})})},P=()=>{q.loading.show(),N.splice(0,1),G.mutate({permissionList:N},{onSuccess:()=>{q.loading.hide(),O()},onError:({response:y})=>{q.loading.hide(),y==null||y.data.error.forEach(g=>{q.notify({message:g.message,position:"bottom-right",type:"negative",actions:[{label:"Dismiss",color:"white"}]})})}})};return(y,g)=>{const S=fe("router-link"),Q=fe("pms-sections");return D(),he(Q,null,{header:z(()=>[w("h5",ht,B(T(_)("permission")),1),w("div",null,[w("p",vt,B(T(_)("select_role")),1),E(Le,{modelValue:x.value,"onUpdate:modelValue":g[0]||(g[0]=b=>x.value=b),dense:"",filled:"",options:K.value,"option-value":"sn","option-label":"name"},null,8,["modelValue","options"])])]),footer:z(()=>[w("div",_t,[E(S,{to:{name:"Staff"},class:"text-bold",style:{"text-decoration":"none"}},{default:z(()=>[ve(B(T(_)("back_to_staff_list")),1)]),_:1}),E(We,{class:"q-px-lg",label:T(_)("save"),color:"negative","no-caps":"",unelevated:"",onClick:g[1]||(g[1]=b=>P())},null,8,["label"])])]),default:z(()=>[T(k)?(D(),ye("div",bt,[E(tt,{showing:!0,label:"Please wait...","label-class":"text-teal","label-style":"font-size: 1.1em"},{default:z(()=>[w("div",kt,[E(me,{color:"negative",thickness:2,size:"2em"})])]),_:1})])):(D(),ye("div",yt,[w("p",gt,B(T(_)("permission_name")),1),E(Xe,{inset:""}),V.value?(D(),he(ot,{key:0,nodes:V.value,class:"q-ml-md","node-key":"sn","no-connectors":""},{"default-header":z(b=>[w("div",mt,[w("p",{class:ge(["q-ma-none q-pa-xs",b.node.parentSn==0?"text-bold":""])},[ve(B(b.node.name)+" ",1),E(be,{modelValue:b.node.grant,"onUpdate:modelValue":[A=>b.node.grant=A,A=>v(b.node)],disable:b.node.status!==1,class:ge([T(c)("edit-permission")===!1?"hidden":"","float-right q-mx-lg"]),dense:"","true-value":1,"false-value":0,color:"negative"},null,8,["modelValue","onUpdate:modelValue","disable","class"])],2)])]),_:1},8,["nodes"])):Ze("v-if",!0)]))]),_:1})}}});var Vt=Ge(xt,[["__scopeId","data-v-c073a722"],["__file","D:/project_learn/goPMS/src/modules/role-permission/view.vue"]]);export{Vt as default};
