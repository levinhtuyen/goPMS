var pe=Object.defineProperty,fe=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var H=(t,n,a)=>n in t?pe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,g=(t,n)=>{for(var a in n||(n={}))ve.call(n,a)&&H(t,a,n[a]);if(K)for(var a of K(n))he.call(n,a)&&H(t,a,n[a]);return t},O=(t,n)=>fe(t,ye(n));import{aw as te,bh as se,_ as ne,J as ae,a as z,r as S,by as ge,F as R,L as P,M as w,P as u,G as I,W,V as X,N as c,I as d,aF as C,R as b,az as B,ay as Y,q as Oe,Q as Z,O as Se,aJ as Re,aK as be,bJ as we,bx as Ce,i as Te,p as qe,U as ee,aG as Ve,aI as xe}from"./index.7efcbe86.js";import{u as re}from"./useI18n.6b7b36de.js";import{Q as oe}from"./QSkeleton.3ea79f8f.js";import{Q as Fe}from"./QForm.df816fa6.js";import{C as Qe}from"./ClosePopup.145acd40.js";import{u as Le}from"./useNotify.967ca7e7.js";import{b as le,u as Be}from"./axiosClient.a0ee23b9.js";import{Q as T}from"./queryKeys.832af9fa.js";import{u as ue}from"./useRoomTypeListQuery.ac5115e9.js";import"./use-quasar.f3f15168.js";const ke=async t=>{const{data:n}=await le.post("/configuration/room/createRoomType",t);return n},Ie=()=>{const t=se();return te(ke,{onSuccess:(n,a)=>{const y=t.getQueryData(T.ROOM_TYPES);!y||t.setQueryData(T.ROOM_TYPES,()=>[...y,O(g({},a),{sn:n.sn,numOfRoom:0})])}})},Me=async t=>{const{data:n}=await le.post("/configuration/room/updateRoomType",t);return n},De=()=>{const t=se(),{findRoomTypeBySn:n}=ue(),a=m=>{const i=t.getQueryData(T.FLOORS),e=n(m.sn);!i||!e||t.setQueryData(T.FLOORS,()=>i.map(v=>O(g({},v),{roomList:v.roomList.map(h=>e.code!==h.roomTypeCode?h:O(g({},h),{roomTypeCode:m.code}))})))},y=m=>{const i=t.getQueryData(T.ROOM_TYPES);!i||t.setQueryData(T.ROOM_TYPES,()=>i.map(e=>e.sn!==m.sn?e:O(g({},m),{numOfRoom:e.numOfRoom})))};return te(Me,{onSuccess:(m,i)=>{a(i),y(i)}})};const M=t=>(Re("data-v-ae84c5da"),t=t(),be(),t),Ae={key:0,class:"wrapper"},Ee={class:"container"},Ne={key:1,class:"wrapper"},Ue={class:"col-12 col-md-12"},ze={class:"q-ma-none text-weight-bold"},Pe=M(()=>d("span",null,"*",-1)),Ye={class:"col-12 col-md-12"},Je={class:"q-ma-none text-weight-bold"},$e=M(()=>d("span",null,"*",-1)),je={class:"row col-12"},Ge={class:"col-4 q-pr-sm"},Ke={class:"q-ma-none text-weight-bold"},He=M(()=>d("span",null,"*",-1)),We={class:"col-4 q-pr-sm"},Xe={class:"q-ma-none text-weight-bold"},Ze={class:"col-4"},eo={class:"q-ma-none text-weight-bold"},oo=M(()=>d("span",null,"*",-1)),to={class:"row justify-end q-gutter-md"},so=ae({props:{roomTypeSn:{type:[String,Number],required:!0}},emits:["onRequestSuccess"],setup(t,{emit:n}){const a=t,{hasPermission:y}=Be(),{notifySaveSuccess:m,notifySaveFailed:i}=Le(),{t:e}=re(),{data:v,isLoading:h,findRoomTypeBySn:f}=ue(),_=z(()=>a.roomTypeSn==="new"?null:f(a.roomTypeSn)),k=Ie(),J=De(),$=z(()=>h.value),l=S({numOfAdult:2,numOfChildren:0,numOfBed:1,name:"",code:""});ge(()=>{var o,r,s,p,q,V,x,F,Q,L;l.value={numOfAdult:(r=(o=_.value)==null?void 0:o.numOfAdult)!=null?r:2,numOfChildren:(p=(s=_.value)==null?void 0:s.numOfChildren)!=null?p:0,numOfBed:(V=(q=_.value)==null?void 0:q.numOfBed)!=null?V:1,name:(F=(x=_.value)==null?void 0:x.name)!=null?F:"",code:(L=(Q=_.value)==null?void 0:Q.code)!=null?L:""}});const D=S(null),de=[o=>!!o||e("this_field_is_required"),o=>Number.isInteger(o)||e("this_is_invalid_value"),o=>1<=o||e("the_value_is_from_1_to_10"),o=>o<=10||e("the_value_is_from_1_to_10")],A=S(null),E=S(null),ie=[o=>!!o||e("this_field_is_required"),o=>Number.isInteger(o)||e("this_is_invalid_value"),o=>1<=o||e("the_value_is_from_1_to_10"),o=>o<=10||e("the_value_is_from_1_to_10")],N=S(null),me=[o=>!!o.trim()||e("this_field_is_required"),o=>o.trim().length<=50||e("the_length_is_from_1_to_50_characters"),o=>{var r;return!((r=v.value)!=null&&r.filter(s=>{var p;return s.sn!==((p=_.value)==null?void 0:p.sn)}).some(s=>s.name.toLowerCase()===o.trim().toLowerCase()))||e("already_exists",{name:e("room_type_name").toLowerCase()})}],U=S(null),ce=[o=>!!o.trim()||e("this_field_is_required"),o=>o.trim().length<=10||e("the_length_is_from_1_to_10_characters"),o=>{var r;return!((r=v.value)!=null&&r.filter(s=>{var p;return s.sn!==((p=_.value)==null?void 0:p.sn)}).some(s=>s.code===o.trim()))||e("already_exists",{name:e("room_type_code").toLowerCase()})}],_e=()=>{var r,s,p,q,V,x,F,Q,L,j,G;if((r=D.value)==null||r.validate(),(s=A.value)==null||s.validate(),(p=E.value)==null||p.validate(),(q=N.value)==null||q.validate(),(V=U.value)==null||V.validate(),((x=D.value)==null?void 0:x.error)||((F=A.value)==null?void 0:F.error)||((Q=E.value)==null?void 0:Q.error)||((L=N.value)==null?void 0:L.error)||((j=U.value)==null?void 0:j.error))return;if(a.roomTypeSn==="new"){k.mutate(O(g({},l.value),{code:l.value.code.trim(),name:l.value.name.trim()}),{onSuccess:()=>{m(),n("onRequestSuccess")},onError:()=>{i()}});return}const o=((G=_.value)==null?void 0:G.code)!==l.value.code;J.mutate(O(g({},l.value),{code:l.value.code.trim(),name:l.value.name.trim(),sn:a.roomTypeSn}),{onSuccess:()=>{m(),n("onRequestSuccess",o?l.value.code:void 0)},onError:()=>{i()}})};return(o,r)=>(R(),P(Fe,{onSubmit:_e},{default:w(()=>[u($)?(R(),I("div",Ae,[(R(),I(W,null,X(2,s=>c(oe,{key:s,type:"QInput"})),64)),d("div",Ee,[(R(),I(W,null,X(3,s=>c(oe,{key:s,class:"col",type:"QInput"})),64))])])):(R(),I("div",Ne,[c(Y,{class:"row"},{default:w(()=>[d("div",Ue,[d("p",ze,[C(b(u(e)("room_type_code")),1),Pe]),c(B,{ref_key:"codeField",ref:U,modelValue:l.value.code,"onUpdate:modelValue":r[0]||(r[0]=s=>l.value.code=s),filled:"",dense:"",placeholder:u(e)("input_room_type_code"),"lazy-rules":"",rules:ce},null,8,["modelValue","placeholder"])]),d("div",Ye,[d("p",Je,[C(b(u(e)("room_type_name")),1),$e]),c(B,{ref_key:"nameField",ref:N,modelValue:l.value.name,"onUpdate:modelValue":r[1]||(r[1]=s=>l.value.name=s),filled:"",dense:"","lazy-rules":"",placeholder:u(e)("input_room_type_name"),rules:me},null,8,["modelValue","placeholder"])]),d("div",je,[d("div",Ge,[d("p",Ke,[C(b(u(e)("number_of_adults")),1),He]),c(B,{ref_key:"numOfAdultField",ref:D,modelValue:l.value.numOfAdult,"onUpdate:modelValue":r[2]||(r[2]=s=>l.value.numOfAdult=s),modelModifiers:{number:!0},filled:"",dense:"","lazy-rules":"",rules:de,type:"number"},null,8,["modelValue"])]),d("div",We,[d("p",Xe,b(u(e)("number_of_children")),1),c(B,{ref_key:"numOfChildrenField",ref:A,modelValue:l.value.numOfChildren,"onUpdate:modelValue":r[3]||(r[3]=s=>l.value.numOfChildren=s),modelModifiers:{number:!0},filled:"",dense:"","lazy-rules":"",type:"number"},null,8,["modelValue"])]),d("div",Ze,[d("p",eo,[C(b(u(e)("number_of_beds")),1),oo]),c(B,{ref_key:"numOfBedField",ref:E,modelValue:l.value.numOfBed,"onUpdate:modelValue":r[4]||(r[4]=s=>l.value.numOfBed=s),modelModifiers:{number:!0},filled:"",dense:"","lazy-rules":"",rules:ie,type:"number"},null,8,["modelValue"])])])]),_:1})])),d("div",to,[Oe((R(),P(Z,{dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},{default:w(()=>[C(b(u(e)("cancel")),1)]),_:1})),[[Qe]]),c(Z,{"no-caps":"",label:u(e)("save"),color:"negative",type:"submit",class:Se(u(y)("add-edit-room-type")===!1?"hidden":""),disable:u($),loading:u(k).isLoading.value||u(J).isLoading.value,"data-testId":"submit-btn"},null,8,["label","class","disable","loading"])])]),_:1}))}});var no=ne(so,[["__scopeId","data-v-ae84c5da"],["__file","D:/gopms-web/src/modules/room-settings/components/room-type-form.vue"]]);const ao={class:"text-h6 text-weight-bold q-pl-md"},ro=ae({setup(t){const n=we(),a=Ce(),{t:y}=re(),m=S(!1),i=z(()=>{const{roomTypeSn:f}=a.params;return Array.isArray(f)?null:f==="new"?"new":typeof+f=="number"?+f:null}),e=Te("emitter");qe(()=>m.value=!0);const v=()=>{n.replace({path:"/settings/room-settings",query:a.query})},h=f=>{if(f&&a.query.code){n.replace({path:"/settings/room-settings",query:{code:f}});return}m.value=!1,e.emit("addRoomType")};return(f,_)=>u(i)?(R(),P(xe,{key:0,modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=k=>m.value=k),onHide:v},{default:w(()=>[c(Ve,{style:{width:"550px","max-width":"90vw"}},{default:w(()=>[c(Y,{class:"q-pb-none"},{default:w(()=>[d("div",ao,[C(b(u(i)==="new"?u(y)("new_room_type"):u(y)("edit_room_type")),1),ee(" {{ router.options.history.state.code }} ")])]),_:1}),c(Y,{class:"q-pt-none"},{default:w(()=>[c(no,{"room-type-sn":u(i),onOnRequestSuccess:h},null,8,["room-type-sn"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):ee("v-if",!0)}});var go=ne(ro,[["__file","D:/gopms-web/src/modules/room-settings/views/room-types.vue"]]);export{go as default};
