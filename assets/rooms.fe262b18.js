var ye=Object.defineProperty,_e=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var j=(e,s,o)=>s in e?ye(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,g=(e,s)=>{for(var o in s||(s={}))ve.call(s,o)&&j(e,o,s[o]);if(J)for(var o of J(s))he.call(s,o)&&j(e,o,s[o]);return e},R=(e,s)=>_e(e,Se(s));import{aw as W,bh as X,_ as Z,J as ee,i as ge,bJ as oe,bx as te,a as ne,r as F,by as Re,F as Q,L as se,M as C,P as m,G as D,W as we,V as Te,N as S,I as v,aF as O,R as q,az as Ce,ay as N,q as Le,Q as G,O as Fe,aJ as Qe,aK as be,p as Oe,U as K,aG as qe,aI as xe}from"./index.7efcbe86.js";import{u as re}from"./useI18n.6b7b36de.js";import{Q as Ie}from"./QSkeleton.3ea79f8f.js";import{Q as H}from"./QSelect.8edab530.js";import{Q as Ve}from"./QForm.df816fa6.js";import{C as De}from"./ClosePopup.145acd40.js";import{u as Ne}from"./useNotify.967ca7e7.js";import{b as ae,u as Me}from"./axiosClient.a0ee23b9.js";import{Q as T}from"./queryKeys.832af9fa.js";import{u as M}from"./useRoomTypeListQuery.ac5115e9.js";import{u as ke}from"./useRoomTypeFloorInfoQuery.bd3b2180.js";import"./QMenu.b19dfcca.js";import"./position-engine.4a23d733.js";import"./selection.6afffe69.js";import"./QItemLabel.938a9258.js";import"./rtl.4b414a6d.js";import"./use-quasar.f3f15168.js";const Ue=async e=>{const{data:s}=await ae.post("/configuration/room/createRoom",e);return s},Be=()=>{const e=X(),{findRoomTypeBySn:s}=M(),o=(t,n)=>{const a=e.getQueryData(T.FLOORS),r=s(n.roomTypeSn);!a||!r||e.setQueryData(T.FLOORS,()=>a.map(u=>u.sn!==n.floorSn?u:R(g({},u),{roomList:[...u.roomList,{sn:t.sn,name:n.name,roomTypeCode:r.name}]})))},h=t=>{const n=e.getQueryData(T.ROOM_TYPES);!n||e.setQueryData(T.ROOM_TYPES,()=>n.map(a=>a.sn!==t.roomTypeSn?a:R(g({},a),{numOfRoom:a.numOfRoom+1})))};return W(Ue,{onSuccess:(t,n)=>{h(n),o(t,n)}})},Ee=async e=>{const{data:s}=await ae.post("/configuration/room/updateRoom",e);return s},Pe=()=>{const e=X(),{findRoomTypeBySn:s}=M(),o=t=>{const n=e.getQueryData(T.FLOORS);if(!n)return;const a=n.flatMap(({roomList:u,sn:i,name:w})=>u.map(L=>R(g({},L),{floorSn:i,floorName:w}))).find(u=>u.sn===t.sn);if(!a)return;const r=s(t.roomTypeSn);if(!!r)return e.setQueryData(T.FLOORS,()=>{switch(a.floorSn!==t.floorSn){case!0:return n.map(i=>i.sn!==t.floorSn?R(g({},i),{roomList:i.roomList.filter(w=>w.sn!==t.sn)}):R(g({},i),{roomList:[...i.roomList,{sn:t.sn,name:t.name,roomTypeCode:r.code,roomTypeSn:t.roomTypeSn}]}));case!1:return n.map(i=>i.sn!==t.floorSn?i:R(g({},i),{roomList:i.roomList.map(w=>w.sn!==t.sn?w:{sn:t.sn,name:t.name,roomTypeCode:r.code,roomTypeSn:t.roomTypeSn})}))}}),a.roomTypeCode},h=(t,n)=>{const a=e.getQueryData(T.ROOM_TYPES);!a||!n||e.setQueryData(T.ROOM_TYPES,()=>a.map(r=>r.sn===t.roomTypeSn?R(g({},r),{numOfRoom:r.numOfRoom+1}):r.code===n?R(g({},r),{numOfRoom:r.numOfRoom-1}):r))};return W(Ee,{onSuccess:(t,n)=>{const a=o(n);h(n,a)}})};const k=e=>(Qe("data-v-7fc45f50"),e=e(),be(),e),Ae={key:0,class:"wrapper"},Ye={key:1,class:"wrapper"},$e={class:"col-12 col-md-12"},ze={class:"q-ma-none text-weight-bold"},Je=k(()=>v("span",null,"*",-1)),je={class:"col-6 col-md-6 col-sm-12 col-xs-12 q-pr-sm"},Ge={class:"q-ma-none text-weight-bold"},Ke=k(()=>v("span",null,"*",-1)),He={class:"col-6 col-md-6 col-sm-12 col-xs-12"},We={class:"q-ma-none text-weight-bold"},Xe=k(()=>v("span",null,"*",-1)),Ze={class:"row justify-end q-gutter-md"},eo=ee({props:{roomSn:{type:[String,Number],required:!0}},emits:["onRequestSuccess"],setup(e,{emit:s}){var Y,$,z;const o=e,h=ge("emitter"),{hasPermission:t}=Me(),{notifySaveSuccess:n,notifySaveFailed:a}=Ne(),r=oe(),u=te(),{data:i,isLoading:w,findRoomTypeByCode:L}=M(),{data:U,isLoading:le,findRoomByRoomSn:me,findFloorByRoomSn:ue}=ke(),B=Be(),E=Pe(),P=ne(()=>le.value||w.value),A=Array.isArray(u.query.code)||(Y=u.query.code)==null?void 0:Y.replaceAll("_"," "),ie=($=L(A))!=null&&$.sn?(z=L(A))==null?void 0:z.sn:{name:"Choose Room Type",sn:0},c=F({name:""});Re(()=>{var l,p,y;if(o.roomSn==="new")c.value={roomTypeSn:ie,floorSn:r.options.history.state.floorId,name:""};else{const f=me(o.roomSn);c.value={roomTypeSn:(l=L(f==null?void 0:f.roomTypeCode))==null?void 0:l.sn,floorSn:(p=ue(o.roomSn))==null?void 0:p.sn,name:(y=f==null?void 0:f.name)!=null?y:""}}});const x=F(null),ce=[l=>!!l||d("this_field_is_required"),l=>Number.isInteger(l)||d("this_is_invalid_value")],I=F(null),de=[l=>!!l||d("this_field_is_required"),l=>Number.isInteger(l)||d("this_is_invalid_value")],V=F(null),pe=[l=>!!l.trim()||d("this_field_is_required"),l=>l.trim().length<=50||d("the_length_is_from_1_to_50_characters"),l=>{var p;return!((p=U.value)!=null&&p.some(({roomList:y})=>y.some(({name:_,sn:b})=>o.roomSn==="new"?_.toLowerCase()===l.trim().toLowerCase():_.toLowerCase()===l.trim().toLowerCase()&&b!==o.roomSn)))||d("already_exists",{name:d("room_name").toLowerCase()})}],{t:d}=re(),fe=()=>{var l,p,y,f,_,b;if((l=V.value)==null||l.validate(),(p=I.value)==null||p.validate(),(y=x.value)==null||y.validate(),!(((f=V.value)==null?void 0:f.error)||((_=I.value)==null?void 0:_.error)||((b=x.value)==null?void 0:b.error))&&!(!c.value.floorSn||!c.value.roomTypeSn)){if(o.roomSn==="new"){B.mutate({roomTypeSn:c.value.roomTypeSn,floorSn:c.value.floorSn,name:c.value.name.trim()},{onSuccess:()=>{n(),s("onRequestSuccess"),h.emit("refetchListRoomSetting")},onError:()=>{a()}});return}E.mutate({sn:o.roomSn,roomTypeSn:c.value.roomTypeSn,floorSn:c.value.floorSn,name:c.value.name.trim()},{onSuccess:()=>{setTimeout(()=>{n(),s("onRequestSuccess"),h.emit("refetchListRoomSetting")},600)},onError:()=>{a()}})}};return(l,p)=>(Q(),se(Ve,{onSubmit:fe},{default:C(()=>[m(P)?(Q(),D("div",Ae,[(Q(),D(we,null,Te(3,y=>S(Ie,{key:y,type:"QInput"})),64))])):(Q(),D("div",Ye,[S(N,{class:"row q-py-none"},{default:C(()=>{var y,f;return[v("div",$e,[v("p",ze,[O(q(m(d)("room_name")),1),Je]),S(Ce,{ref_key:"nameField",ref:V,modelValue:c.value.name,"onUpdate:modelValue":p[0]||(p[0]=_=>c.value.name=_),filled:"",dense:"",placeholder:m(d)("input_room_name"),"lazy-rules":"",rules:pe},null,8,["modelValue","placeholder"])]),v("div",je,[v("p",Ge,[O(q(m(d)("room_type")),1),Ke]),S(H,{ref_key:"roomTypeField",ref:I,modelValue:c.value.roomTypeSn,"onUpdate:modelValue":p[1]||(p[1]=_=>c.value.roomTypeSn=_),filled:"",rules:de,options:(y=m(i))!=null?y:void 0,"map-options":"",dense:"","option-label":"name",label:m(d)("select_room_type"),clearable:"","option-value":"sn","bg-color":o.roomSn!=="new"?"grey-5":"",class:"custom-limit-select","emit-value":"",disable:o.roomSn!=="new"},null,8,["modelValue","options","label","bg-color","disable"])]),v("div",He,[v("p",We,[O(q(m(d)("floor")),1),Xe]),S(H,{ref_key:"floorSnField",ref:x,modelValue:c.value.floorSn,"onUpdate:modelValue":p[2]||(p[2]=_=>c.value.floorSn=_),filled:"",rules:ce,options:(f=m(U))!=null?f:void 0,"map-options":"",dense:"",label:m(d)("select_floor"),clearable:"",class:"custom-limit-select","option-label":"name","option-value":"sn","bg-color":o.roomSn!=="new"?"grey-5":"","emit-value":"",disable:o.roomSn!=="new"},null,8,["modelValue","options","label","bg-color","disable"])])]}),_:1})])),v("div",Ze,[Le(S(G,{label:m(d)("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[De]]),S(G,{"no-caps":"",label:m(d)("save"),color:"negative",type:"submit",disable:m(P),class:Fe(m(t)("add-edit-room")===!1?"hidden":""),loading:m(B).isLoading.value||m(E).isLoading.value,"data-testId":"submit-btn"},null,8,["label","disable","class","loading"])])]),_:1}))}});var oo=Z(eo,[["__scopeId","data-v-7fc45f50"],["__file","D:/gopms-web/src/modules/room-settings/components/room-form.vue"]]);const to={class:"text-h6 q-pl-md text-weight-bold"},no=ee({setup(e){const s=oe(),o=te(),{t:h}=re(),t=F(!1),n=ne(()=>{const{roomSn:r}=o.params;return Array.isArray(r)?null:r==="new"?"new":typeof+r=="number"?+r:null});Oe(()=>t.value=!0);const a=()=>{s.replace({path:"/settings/room-settings",query:o.query})};return(r,u)=>m(n)?(Q(),se(xe,{key:0,modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=i=>t.value=i),onHide:a},{default:C(()=>[S(qe,{style:{width:"550px","max-width":"80vw"}},{default:C(()=>[S(N,{class:"row"},{default:C(()=>[v("div",to,[O(q(m(n)==="new"?m(h)("new_room"):m(h)("edit_room")),1),K(" {{ router.options.history.state.roomName }} ")])]),_:1}),S(N,{class:"q-pt-none"},{default:C(()=>[S(oo,{"room-sn":m(n),onOnRequestSuccess:u[0]||(u[0]=i=>t.value=!1)},null,8,["room-sn"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):K("v-if",!0)}});var To=Z(no,[["__file","D:/gopms-web/src/modules/room-settings/views/rooms.vue"]]);export{To as default};
