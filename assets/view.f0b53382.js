import{av as oe,aw as se,bh as le,_ as ie,r as u,p as ne,by as de,a as p,C as H,K as re,F as m,L as ce,M as l,I as t,R as i,N as s,am as Q,ay as x,bo as he,O as T,X as _e,az as S,T as B,q as P,Q as b,G as g,U as W,aG as U,aI as ue}from"./index.7efcbe86.js";import{Q as fe}from"./QInnerLoading.5fef3982.js";import{Q as v,a as w}from"./selection.6afffe69.js";import{Q as O}from"./QList.e5651779.js";import{a as V}from"./QMenu.b19dfcca.js";import{Q as me}from"./QDate.804040fd.js";import{Q as ve}from"./QPopupProxy.9996c4ad.js";import{C as k}from"./ClosePopup.145acd40.js";import{b as j,c as we}from"./axiosClient.a0ee23b9.js";import{Q as z}from"./queryKeys.832af9fa.js";import{u as ye}from"./useI18n.6b7b36de.js";import{u as Se}from"./useNotify.967ca7e7.js";import{f as be,c as ge}from"./useFormat.349e799c.js";import{n as pe}from"./useCreateDate.6141d343.js";import"./position-engine.4a23d733.js";import"./use-cache.b0833c75.js";import"./date.2d51ed98.js";import"./use-quasar.f3f15168.js";const xe=async()=>{const{data:r}=await j.get("/shiftHandover/getShiftHandoverInfo");return r.data},Ve=()=>oe(z.SHIFT_HANDOVER,xe),De=async r=>{const{data:o}=await j.post("/shiftHandover/createShiftHandover",r);return o.data},Ce=()=>{const r=le();return se(De,{onSuccess:()=>{r.invalidateQueries(z.SHIFT_HANDOVER)}})};const Ie={setup(){const{t:r}=ye();let{data:o,isFetching:D}=Ve();const{notifySaveSuccess:e}=Se(),{mutate:C,isLoading:I}=Ce(),y=u({startingBalance:0,totalCashReceipts:0,totalCashPayments:0,endBalance:0,startedAt:""}),a=u({cashInSafe:0,cashForTheNextShift:0,cashWithdrawals:0,cashReceiver:"",note:"",password:""}),d=u(0);ne(()=>{d.value=window.innerWidth}),de(()=>{var n,f,N,q,M,R,A;o.value&&(y.value={startingBalance:(n=o.value)==null?void 0:n.startingBalance,totalCashReceipts:(f=o.value)==null?void 0:f.totalCashReceipts,totalCashPayments:(N=o.value)==null?void 0:N.totalCashPayments,endBalance:(q=o.value)==null?void 0:q.endBalance,startedAt:pe((M=o.value)==null?void 0:M.startedAt,we)},a.value={cashInSafe:(R=o.value)==null?void 0:R.endBalance,cashForTheNextShift:(A=o.value)==null?void 0:A.endBalance,cashWithdrawals:0,cashReceiver:"",note:"",password:""})});const c=p(()=>{var n,f;return!!((n=a.value)!=null&&n.cashReceiver)&&((f=a.value)==null?void 0:f.cashReceiver.length)<=20}),h=p(()=>{var n;return((n=a.value)==null?void 0:n.note.length)<=200}),E=()=>{var n;a.value.cashInSafe<=0?a.value.cashInSafe=Number((n=o.value)==null?void 0:n.endBalance):(a.value.cashForTheNextShift=a.value.cashInSafe,a.value.cashWithdrawals=0)},Y=()=>{(a.value.cashForTheNextShift>a.value.cashInSafe||a.value.cashForTheNextShift<0)&&(a.value.cashForTheNextShift=a.value.cashInSafe),a.value.cashWithdrawals=a.value.cashInSafe-a.value.cashForTheNextShift},L=()=>{a.value.cashWithdrawals>a.value.cashInSafe?a.value.cashWithdrawals=a.value.cashInSafe:a.value.cashWithdrawals<0&&(a.value.cashWithdrawals=0),a.value.cashForTheNextShift=a.value.cashInSafe-a.value.cashWithdrawals},G=H({cashInSafe:!1,cashForTheNextShift:!1,cashWithdrawals:!1}),K=u(null),F=p(()=>!!a.value.password&&a.value.password.length>=8&&a.value.password.length<=16),_=H({isOpenHandoverModal:!1,isPwd:!0,isSubmitHandover:!1,isSubbmitPopup:!1}),X=u(null),J=[n=>!!n||r("this_field_is_required")],Z=u(null),$=[n=>!!n||r("this_field_is_required")],ee=u(null),ae=[n=>!!n||r("this_field_is_required")],te=u(null);return{t:r,isFetching:D,formValues:y,startDailyField:X,startDailyRules:J,endDailyField:Z,endDailyRules:$,startOvernightField:ee,startOvernightRules:ae,endOvernightField:te,endOvernightRules:[n=>!!n||r("this_field_is_required")],onSubmit:()=>{if(_.isSubmitHandover=!0,F.value)_.isOpenHandoverModal=!1,C(a.value,{onSuccess:()=>{e(),_.isSubmitHandover=!1,_.isSubbmitPopup=!1}});else return _.isOpenHandoverModal=!0,!1},isSubmitting:I,widthScreen:d,ui:_,openHandoverModal:()=>{_.isSubbmitPopup=!0,c.value&&h.value&&(_.isOpenHandoverModal=!0)},passwordField:K,isPasswordRules:F,formatMoney:be,changeMoney:ge,inputActive:G,formData:a,handleCashInSafeAmount:E,handleCashForTheNextShiftAmount:Y,handleCashWithdrawalsAmount:L,isValidCashReceiverRules:c,isValidNoteRules:h}}},Fe={class:"text-h6 text-weight-bold q-mb-md"},Ne={class:"relative-position"},qe={class:"row"},Me={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},Re={class:"col-12 col-md-12 bg-grey-2"},Ae={class:"row justify-between"},He={class:"q-md-2"},Qe={class:"row justify-between"},Te={class:"q-md-2"},Be={class:"row justify-between"},Pe={class:"q-md-2"},We={class:"row justify-between text-bold"},Ue={class:"q-md-2"},Oe={class:"col-12 col-md-12 bg-grey-2"},ke={class:"row justify-between"},je={class:"q-md-2"},ze={class:"col-12 col-md-12 bg-deep-orange-1 q-py-md"},Ee={class:"row justify-between q-px-md"},Ye={class:"q-md-2"},Le={class:"text-bold"},Ge=["id","value","onChange"],Ke={class:"row justify-between q-px-md"},Xe={class:"q-md-2"},Je={class:"text-bold"},Ze=["id","value","onChange"],$e={class:"row justify-between q-px-md"},ea={class:"q-md-2"},aa={class:"text-bold"},ta=["id","value","onChange"],oa={class:"col-12 col-md-4"},sa={class:"text-weight-bold"},la={class:"row items-center justify-end"},ia={class:"text-weight-bold"},na={key:0},da={key:1},ra={class:"col-12 col-md-12"},ca={class:"text-weight-bold"},ha={class:"col-12 col-md-12 row justify-end q-pa-md"},_a={align:"center"},ua={class:"text-bold"},fa={class:"q-py-sm"},ma={key:0,class:"text-left"},va={key:1,class:"text-left"},wa={align:"center",class:"q-gutter-sm q-py-md"};function ya(r,o,D,e,C,I){const y=re("pms-sections");return m(),ce(y,null,{header:l(()=>[t("div",Fe,i(e.t("cash_handover")),1),s(Q,{inset:""})]),default:l(()=>[t("div",Ne,[t("div",qe,[s(U,{flat:""},{default:l(()=>[s(x,{horizontal:e.widthScreen>768},{default:l(()=>[s(fe,{showing:e.isFetching,label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:l(()=>[t("div",Me,[s(he,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),s(x,{class:"row col-6"},{default:l(()=>[t("div",Re,[s(O,null,{default:l(()=>[s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[t("div",Ae,[t("div",He,[t("div",null,"1. "+i(e.t("starting_balance")),1)]),t("div",null,i(e.formatMoney(e.formValues.startingBalance))+" VND",1)])]),_:1})]),_:1}),s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[t("div",Qe,[t("div",Te,[t("div",null,"2. "+i(e.t("total_cash_receipts")),1)]),t("div",null,i(e.formatMoney(e.formValues.totalCashReceipts))+" VND",1)])]),_:1})]),_:1}),s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[t("div",Be,[t("div",Pe,[t("div",null,"3. "+i(e.t("total_cash_payments")),1)]),t("div",null,i(e.formatMoney(e.formValues.totalCashPayments))+" VND",1)])]),_:1})]),_:1}),s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[t("div",We,[t("div",Ue,[t("div",null,"4. "+i(e.t("end_shift_balance"))+" (1+2-3)",1)]),t("div",null,i(e.formatMoney(e.formValues.endBalance))+" VND",1)])]),_:1})]),_:1})]),_:1})]),t("div",Oe,[s(O,null,{default:l(()=>[s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[t("div",ke,[t("div",je,[t("div",null,"5. "+i(e.t("cash_difference"))+" (6-4)",1)]),t("div",{class:T(e.formData.cashInSafe-e.formValues.endBalance<0?"text-red":"")},i(e.formatMoney(e.formData.cashInSafe-e.formValues.endBalance))+" VND ",3)])]),_:1})]),_:1})]),_:1})]),t("div",ze,[t("div",Ee,[t("div",Ye,[t("div",Le,"6. "+i(e.t("cash_in_safe"))+"*",1)]),t("div",null,[s(V,{modelValue:e.formData.cashInSafe,"onUpdate:modelValue":[o[0]||(o[0]=a=>e.formData.cashInSafe=a),e.handleCashInSafeAmount],modelModifiers:{number:!0},outlined:"",dense:"",class:"col",suffix:"VND",debounce:"500",rules:[a=>a>=1||e.t("the_value_is_from_1_to_100_000_000_000"),a=>a<=1e11||e.t("the_value_is_from_1_to_100_000_000_000")],type:"number",onBlur:o[1]||(o[1]=a=>e.inputActive.cashInSafe=!1),onFocus:o[2]||(o[2]=a=>e.inputActive.cashInSafe=!0)},{control:l(({id:a,modelValue:d,emitValue:c})=>[t("input",{id:a,class:"q-field__input text-right",style:{width:"100px"},value:e.inputActive.cashInSafe?d:e.formatMoney(d),onChange:h=>e.changeMoney(h,d,c)},null,40,Ge)]),_:1},8,["modelValue","rules","onUpdate:modelValue"])])]),t("div",Ke,[t("div",Xe,[t("div",Je,"7. "+i(e.t("hand_to_next_shift"))+"* (6-8)",1)]),t("div",null,[s(V,{modelValue:e.formData.cashForTheNextShift,"onUpdate:modelValue":[o[3]||(o[3]=a=>e.formData.cashForTheNextShift=a),e.handleCashForTheNextShiftAmount],modelModifiers:{number:!0},outlined:"",dense:"",class:"col",suffix:"VND",debounce:"500",rules:[a=>a>=0||e.t("the_value_is_from_1_to_100_000_000_000"),a=>a<=1e11||e.t("the_value_is_from_1_to_100_000_000_000")],type:"number",onBlur:o[4]||(o[4]=a=>e.inputActive.cashForTheNextShift=!1),onFocus:o[5]||(o[5]=a=>e.inputActive.cashForTheNextShift=!0)},{control:l(({id:a,modelValue:d,emitValue:c})=>[t("input",{id:a,class:"q-field__input text-right",style:{width:"100px"},value:e.inputActive.cashForTheNextShift?d:e.formatMoney(d),onChange:h=>e.changeMoney(h,d,c)},null,40,Ze)]),_:1},8,["modelValue","rules","onUpdate:modelValue"])])]),t("div",$e,[t("div",ea,[t("div",aa,"8. "+i(e.t("cash_withdrawals"))+" (6-7)",1)]),t("div",null,[s(V,{modelValue:e.formData.cashWithdrawals,"onUpdate:modelValue":[o[6]||(o[6]=a=>e.formData.cashWithdrawals=a),e.handleCashWithdrawalsAmount],modelModifiers:{number:!0},outlined:"",dense:"",class:"col",suffix:"VND",debounce:"500",rules:[a=>a>=0||e.t("the_value_is_from_1_to_100_000_000_000"),a=>a<=1e11||e.t("the_value_is_from_1_to_100_000_000_000")],type:"number",onBlur:o[7]||(o[7]=a=>e.inputActive.cashWithdrawals=!1),onFocus:o[8]||(o[8]=a=>e.inputActive.cashWithdrawals=!0)},{control:l(({id:a,modelValue:d,emitValue:c})=>[t("input",{id:a,class:"q-field__input text-right",style:{width:"100px"},value:e.inputActive.cashWithdrawals?d:e.formatMoney(d),onChange:h=>e.changeMoney(h,d,c)},null,40,ta)]),_:1},8,["modelValue","rules","onUpdate:modelValue"])])])])]),_:1}),s(Q,{vertical:""}),s(x,{class:"row col-6 q-px-md",style:_e(e.widthScreen>768?"height: 100px":"")},{default:l(()=>[t("div",oa,[t("div",sa,i(e.t("shift_started_at"))+":",1),s(S,{modelValue:e.formValues.startedAt,"onUpdate:modelValue":o[10]||(o[10]=a=>e.formValues.startedAt=a),disable:"",outlined:"",dense:"",class:"bg-grey-5"},{prepend:l(()=>[s(B,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(ve,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(me,{modelValue:e.formValues.startedAt,"onUpdate:modelValue":o[9]||(o[9]=a=>e.formValues.startedAt=a),mask:"YYYY-MM-DD HH:mm"},{default:l(()=>[t("div",la,[P(s(b,{label:"Close",color:"primary",flat:""},null,512),[[k]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",{class:T(["col-12 col-md-8",e.widthScreen>768?" q-pl-sm":""])},[t("div",ia,i(e.t("cash_receiver"))+"*",1),s(S,{modelValue:e.formData.cashReceiver,"onUpdate:modelValue":o[11]||(o[11]=a=>e.formData.cashReceiver=a),placeholder:e.t("input_receiver"),"lazy-rules":"",dense:"",outlined:"",error:!e.isValidCashReceiverRules&&e.ui.isSubbmitPopup},{error:l(()=>[!e.formData.cashReceiver&&e.ui.isSubbmitPopup?(m(),g("p",na,i(e.t("this_field_is_required")),1)):e.formData.cashReceiver.length>20&&e.ui.isSubbmitPopup?(m(),g("p",da,i(e.t("the_length_is_from_1_to_20_characters")),1)):W("v-if",!0)]),_:1},8,["modelValue","placeholder","error"])],2),t("div",ra,[t("div",ca,i(e.t("note")),1),s(S,{modelValue:e.formData.note,"onUpdate:modelValue":o[12]||(o[12]=a=>e.formData.note=a),placeholder:e.t("input_note"),"lazy-rules":"",dense:"",outlined:"",rows:"4",type:"textarea",class:"custome-textarea",error:!e.isValidNoteRules},{error:l(()=>[t("p",null,i(e.t("the_length_is_from_1_to_200_characters")),1)]),_:1},8,["modelValue","placeholder","error"])])]),_:1},8,["style"])]),_:1},8,["horizontal"])]),_:1})]),t("div",ha,[s(b,{class:"q-px-lg",label:e.t("handover"),loading:e.isSubmitting,type:"submit",color:"negative","no-caps":"",onClick:e.openHandoverModal},null,8,["label","loading","onClick"])])]),s(ue,{modelValue:e.ui.isOpenHandoverModal,"onUpdate:modelValue":o[15]||(o[15]=a=>e.ui.isOpenHandoverModal=a)},{default:l(()=>[s(U,{class:"q-pa-lg"},{default:l(()=>[t("div",_a,[t("p",ua,i(e.t("please_enter_a_password_to_confirm_handover")),1)]),t("div",fa,[s(S,{ref:"passwordField",modelValue:e.formData.password,"onUpdate:modelValue":o[14]||(o[14]=a=>e.formData.password=a),outlined:"",type:e.ui.isPwd?"password":"text",placeholder:e.t("input_password"),dense:"",error:!e.isPasswordRules&&e.ui.isSubmitHandover,autocomplete:"new-password"},{append:l(()=>[s(B,{name:e.ui.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[13]||(o[13]=a=>e.ui.isPwd=!e.ui.isPwd)},null,8,["name"])]),error:l(()=>[!e.formData.password&&e.ui.isSubmitHandover?(m(),g("p",ma,i(e.t("this_field_is_required")),1)):e.ui.isSubmitHandover&&(e.formData.password.length<8||e.formData.password.length>16)?(m(),g("p",va,i(e.t("the_length_is_from_8_to_16_characters")),1)):W("v-if",!0)]),_:1},8,["modelValue","type","placeholder","error"])]),t("div",wa,[P(s(b,{label:e.t("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"6px 20px"}},null,8,["label"]),[[k]]),s(b,{label:e.t("confirm_handover"),color:"negative","no-caps":"",onClick:e.onSubmit},null,8,["label","onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ua=ie(Ie,[["render",ya],["__scopeId","data-v-45ae8695"],["__file","D:/gopms-web/src/modules/shift-handover/view.vue"]]);export{Ua as default};
