var Ee=Object.defineProperty,Ae=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var pe=(l,s,d)=>s in l?Ee(l,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[s]=d,_e=(l,s)=>{for(var d in s||(s={}))Oe.call(s,d)&&pe(l,d,s[d]);if(me)for(var d of me(s))Be.call(s,d)&&pe(l,d,s[d]);return l},fe=(l,s)=>Ae(l,Le(s));import{av as ze,aw as ke,bh as he,_ as oe,J as le,r as f,a as B,F as k,L as M,M as a,N as o,I as t,R as m,P as e,q as L,Q as I,aD as He,ay as we,az as T,T as ye,G as x,V as ae,W as z,aG as Se,aH as be,aI as De,aJ as Ie,aK as xe,w as ve,U as X,bo as je,aF as F,O as Q}from"./index.7efcbe86.js";import{Q as Ve}from"./QInnerLoading.5fef3982.js";import{Q as Ke,a as ge,c as R,b as We}from"./QTable.4cc8e1c9.js";import{Q as G}from"./QTooltip.c975c2a0.js";import{Q as Je}from"./QPagination.a48c1bef.js";import{u as se}from"./useI18n.6b7b36de.js";import{u as Xe}from"./use-quasar.f3f15168.js";import{d as C}from"./date.2d51ed98.js";import{b as ie,c as te,u as Ge,d as Z}from"./axiosClient.a0ee23b9.js";import{Q as H}from"./queryKeys.832af9fa.js";import{Q as Te}from"./QToolbarTitle.6428114f.js";import{Q as Ce}from"./QToolbar.1dcdb2c5.js";import{Q as $e}from"./QDate.804040fd.js";import{Q as qe}from"./QPopupProxy.9996c4ad.js";import{Q as Ze}from"./QForm.df816fa6.js";import{C as O}from"./ClosePopup.145acd40.js";import{u as et,I as Pe,a as tt,b as ot}from"./import-stock-edit-modal.63328578.js";import{u as Qe}from"./useNotify.967ca7e7.js";import{f as ne,a as lt}from"./useFormat.349e799c.js";import{F as at}from"./filter.94c23db9.js";import"./QList.e5651779.js";import"./QSelect.8edab530.js";import"./QMenu.b19dfcca.js";import"./position-engine.4a23d733.js";import"./selection.6afffe69.js";import"./QItemLabel.938a9258.js";import"./rtl.4b414a6d.js";import"./use-cache.b0833c75.js";import"./useCategoryServiceQuery.9c0b8426.js";const st=C.formatDate(new Date,"DD/MM/YYYY"),ee=(l=st)=>{const[s,d,v]=l.split("/");return`${v}/${d}/${s}`},it=async l=>{var d,v;const{data:s}=await ie.get(`/inventory/stock/getImportStockList?page=${(v=(d=l.page)==null?void 0:d.value)==null?void 0:v.currentPage}&limit=${l.limit}&displayType=${l.displayType.value.id}&startTime=${l.startTime.value?Number(C.formatDate(ee(l.startTime.value),"X")):Number(C.formatDate(ee(l.startWeek.value),"X"))}&endTime=${Number(C.formatDate(ee(l.endTime.value),"X"))}`);return s},nt=l=>ze([H.IMPORT_STOCK,{params:l}],()=>it(l)),ct=async l=>{const{data:s}=await ie.post("/inventory/stock/removeImportStock",l);return s},rt=()=>{const l=he();return ke(ct,{onSuccess:(s,d)=>{const v=l.getQueryData(H.IMPORT_STOCK);if(!v)return;const{data:c}=v;!c||l.setQueryData(H.IMPORT_STOCK,()=>fe(_e({},v),{data:c.filter(b=>b.importStockSn!==d.importStockSn)}))}})},dt=async l=>{const{data:s}=await ie.post("/inventory/stock/createImportStock",l);return s},ut=()=>{const l=he();return ke(dt,{onSuccess:()=>{l.invalidateQueries(H.STAFF)}})};const mt=l=>(Ie("data-v-25889082"),l=l(),xe(),l),pt={class:"text-h6 text-weight-bold q-pa-md"},_t={class:"col-12 col-md-6 q-pr-md"},ft={class:"text-weight-bold"},vt={class:"col-12 col-md-6"},gt={class:"text-weight-bold"},kt={class:"row items-center justify-end"},ht={class:"col-12 col-md-12"},wt={class:"text-weight-bold"},yt={class:"q-pt-md col-12"},St={class:"q-pa-md bg-grey-2"},bt={class:"row col-12 col-md-12"},Dt={class:"col-6 text-h7 text-weight-bold"},It={class:"col-sm-6 col-xs-12 text-h7 text-weight-bold"},xt={class:"col-12 q-pt-md col-md-12"},Vt={class:"row col-12 col-md-12"},Tt={class:"col-md-8 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},Ct={class:"text-h7 text-weight-bold"},$t={class:"col-md-4 col-sm-6 col-xs-12"},qt={class:"col-md-4 col-sm-6 col-xs-12"},Pt=mt(()=>t("span",{class:"text-orange-10 text-subtitle2 text-weight-bold"},"VND",-1)),Qt={class:"row col-12 col-md-12 justify-end q-pa-sm q-px-sm"},Mt=le({props:{modelValue:{type:Boolean,required:!0}},emits:["close","update:modelValue","changeSuccess"],setup(l,{expose:s,emit:d}){const v=l,{t:c}=se(),b=f(),Y=ut(),h=et(),{notifyUpdateSuccess:D}=Qe(),i=f({receiptID:"",receiptDateTime:"",note:"",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}),V=()=>{var u;(u=i.value)==null||u.importStockDetail.push({categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0})},$=B({get(){return v.modelValue},set(u){d("update:modelValue",u)}}),q=f(null),_=[u=>200>(u==null?void 0:u.length)||c("the_length_is_from_0_to_200_characters")],S=B(()=>{var u,r;return((r=(u=i==null?void 0:i.value)==null?void 0:u.note)==null?void 0:r.length)>201}),w=u=>{i.value.importStockDetail.splice(u,1),N()},U=()=>{j()},j=()=>{i.value={receiptID:"",receiptDateTime:"",note:" ",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}},E=()=>{var u;i.value.note===null&&(i.value.note=""),(u=b.value)==null||u.validate().then(r=>{if(r)Y.mutate(i.value,{onSuccess:async()=>{D(),await setTimeout(()=>{d("close"),i.value={receiptID:"",receiptDateTime:"",note:"",sn:null,totalPrice:0,importStockDetail:[{categorySn:null,importPrice:0,productSn:null,productUnitName:"",quantity:1,sn:null,total:0}]}},900)}});else return!1})},N=()=>{let u=0;if(i.value.importStockDetail.map(function(r){(!r.categorySn||!r.productSn)&&(u=1)}),u===0){const r={importStock:[...i.value.importStockDetail]};h.mutate(r,{onSuccess:g=>{i.value.totalPrice=g.data.totalPrice,i.value.importStockDetail=g.data.importStockList}})}else return};return s({setupCreateImportStockDialog:async()=>{console.log("setup")}}),(u,r)=>(k(),M(De,{modelValue:e($),"onUpdate:modelValue":r[4]||(r[4]=g=>be($)?$.value=g:null),"full-width":"",onHide:U},{default:a(()=>[o(Se,null,{default:a(()=>[o(Ce,{class:"q-pa-md"},{default:a(()=>[o(Te,null,{default:a(()=>[t("div",pt,m(e(c)("new_import_receipt")),1)]),_:1}),L(o(I,{class:"q-pa-md",flat:"",round:"",dense:"",icon:"close"},null,512),[[O]])]),_:1}),t("div",null,[o(Ze,{ref_key:"changeCreateImportStockRef",ref:b,class:"q-gutter-md q-pa-md",onSubmit:He(E,["prevent","stop"])},{default:a(()=>[o(we,{class:"row"},{default:a(()=>[t("div",_t,[t("p",ft,m(e(c)("import_receipt_id")),1),o(T,{ref:"nameField",modelValue:i.value.receiptID,"onUpdate:modelValue":r[0]||(r[0]=g=>i.value.receiptID=g),"bg-color":"grey-3",filled:"",dense:"",disable:""},null,8,["modelValue"])]),t("div",vt,[t("p",gt,m(e(c)("import_date_time")),1),o(T,{modelValue:i.value.receiptDateTime,"onUpdate:modelValue":r[2]||(r[2]=g=>i.value.receiptDateTime=g),"bg-color":"grey-3",dense:"",disable:"",filled:""},{prepend:a(()=>[o(ye,{name:"event",class:"cursor-pointer"},{default:a(()=>[o(qe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[o($e,{modelValue:i.value.receiptDateTime,"onUpdate:modelValue":r[1]||(r[1]=g=>i.value.receiptDateTime=g),mask:"YYYY-MM-DD HH:mm"},{default:a(()=>[t("div",kt,[L(o(I,{label:"Close",color:"primary",flat:""},null,512),[[O]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",ht,[t("p",wt,m(e(c)("note")),1),o(T,{ref_key:"note",ref:q,modelValue:i.value.note,"onUpdate:modelValue":r[3]||(r[3]=g=>i.value.note=g),"bg-color":"grey-1",placeholder:e(c)("input_note"),filled:"",autogrow:"",rules:_,error:e(S)},{error:a(()=>[t("p",null,m(e(c)("the_length_is_from_0_to_200_characters")),1)]),_:1},8,["modelValue","placeholder","error"])]),t("div",yt,[t("div",St,[t("div",bt,[t("div",Dt,m(e(c)("import_stock")),1),t("div",It,[o(I,{outline:"",class:"btn-fixed-width float-right",color:"negative","no-caps":"",label:e(c)("add_new"),icon:"add_circle",onClick:V},null,8,["label"])])]),(k(!0),x(z,null,ae(i.value.importStockDetail,(g,P)=>(k(),x("div",{key:P,class:"row col-12 col-md-12"},[o(Pe,{"data-stock":g,view:2,index:P,onCalculateAmoundStock:N,onDeleteImportStockView:W=>w(P)},null,8,["data-stock","index","onDeleteImportStockView"])]))),128))])]),t("div",xt,[t("div",Vt,[t("div",Tt,[t("p",Ct,m(e(c)("total_price")),1)]),t("div",$t,[t("div",qt,[o(T,{"model-value":e(ne)(i.value.totalPrice),"input-class":"text-orange-10 text-weight-bold text-right","bg-color":"orange-1",disable:"",filled:"",dense:""},{append:a(()=>[Pt]),_:1},8,["model-value"])])])])])]),_:1}),t("div",Qt,[L(o(I,{label:e(c)("cancel"),dense:"",outline:"","no-caps":"",class:"q-mr-md",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[O]]),o(I,{"no-caps":"",label:e(c)("save"),type:"submit",color:"negative"},null,8,["label"])])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"]))}});var Ut=oe(Mt,[["__scopeId","data-v-25889082"],["__file","D:/gopms-web/src/modules/stock/import/components/import-stock-create-modal.vue"]]);const Nt=l=>(Ie("data-v-47f6e66b"),l=l(),xe(),l),Rt={class:"text-h6 q-ma-none q-pa-md text-weight-bold"},Ft={key:0,class:"wrapper q-pa-md"},Yt={key:1,class:"q-gutter-md q-pa-md"},Et={class:"col-12 col-md-6 q-pr-md"},At={class:"q-ma-none text-weight-bold"},Lt={class:"col-12 col-md-6"},Ot={class:"q-ma-none text-weight-bold"},Bt={class:"row items-center justify-end"},zt={class:"col-12 col-md-12"},Ht={class:"q-ma-none text-weight-bold"},jt={class:"q-pt-md col-12"},Kt={class:"q-pa-md bg-grey-2"},Wt={class:"row col-12 col-md-12"},Jt={class:"col-6 text-h7 q-ma-none text-weight-bold"},Xt={class:"col-12 q-pt-md col-md-12"},Gt={class:"row col-12 col-md-12"},Zt={class:"col-md-8 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},eo={class:"text-h7 q-ma-none text-weight-bold"},to={class:"col-md-4 col-sm-6 col-xs-12"},oo=Nt(()=>t("span",{class:"text-orange-10 text-subtitle2 text-weight-bold"},"VND",-1)),lo=le({props:{modelValue:{type:Boolean,require:!0}},emits:["close","update:modelValue"],setup(l,{expose:s,emit:d}){const v=l,{t:c}=se(),b=f(-1);s({setupCreateImportStockDialog:async _=>{b.value=_,i.value()}});const{data:h,isLoading:D,refetch:i}=tt({stockSn:b,isDelete:1}),V=f(null),$=[_=>!!_||c("this_field_is_required"),_=>(_==null?void 0:_.length)>=1&&(_==null?void 0:_.length)<51||c("the_length_is_from_1_to_50_characters")],q=B({get(){return v.modelValue},set(_){d("update:modelValue",_)}});return(_,S)=>(k(),M(De,{modelValue:e(q),"onUpdate:modelValue":S[2]||(S[2]=w=>be(q)?q.value=w:null),"full-width":""},{default:a(()=>[o(Se,{class:"view-form"},{default:a(()=>[o(Ce,{class:"q-pa-md"},{default:a(()=>[o(Te,null,{default:a(()=>[t("div",Rt,m(e(c)("import_receipt_detail")),1)]),_:1}),L(o(I,{class:"q-pa-md",flat:"",round:"",dense:"",icon:"close"},null,512),[[O]])]),_:1}),t("div",null,[e(D)?(k(),x("div",Ft,[o(Ve,{showing:e(D),label:"Please wait...","lab55el-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"])])):(k(),x("form",Yt,[o(we,{class:"row"},{default:a(()=>[t("div",Et,[t("p",At,m(e(c)("import_receipt_id")),1),o(T,{ref_key:"nameField",ref:V,modelValue:e(h).importStock.receiptId,"onUpdate:modelValue":S[0]||(S[0]=w=>e(h).importStock.receiptId=w),filled:"",disable:"",dense:"",placeholder:e(c)("import_receipt_id"),"lazy-rules":"",rules:$},null,8,["modelValue","placeholder"])]),t("div",Lt,[t("p",Ot,m(e(c)("import_date_time")),1),o(T,{"model-value":e(C).formatDate(e(h).importStock.importDate*1e3,e(te)),disable:"",dense:"",filled:""},{prepend:a(()=>[o(ye,{name:"event",class:"cursor-pointer"},{default:a(()=>[o(qe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[o($e,{"model-value":e(C).formatDate(e(h).importStock.importDate*1e3,e(te)),mask:"YYYY-MM-DD HH:mm"},{default:a(()=>[t("div",Bt,[L(o(I,{label:"Close",color:"primary",flat:""},null,512),[[O]])])]),_:1},8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value"])]),t("div",zt,[t("p",Ht,m(e(c)("note")),1),o(T,{modelValue:e(h).importStock.note,"onUpdate:modelValue":S[1]||(S[1]=w=>e(h).importStock.note=w),disable:"",filled:"",autogrow:""},null,8,["modelValue"])]),t("div",jt,[t("div",Kt,[t("div",Wt,[t("div",Jt,m(e(c)("import_stock")),1)]),(k(!0),x(z,null,ae(e(h).importStockDetailList,(w,U)=>(k(),x("div",{key:U,class:"row col-12 col-md-12"},[o(Pe,{index:U,"data-stock":w,view:1},null,8,["index","data-stock"])]))),128))])]),t("div",Xt,[t("div",Gt,[t("div",Zt,[t("p",eo,m(e(c)("total_price")),1)]),t("div",to,[o(T,{"model-value":e(ne)(e(h).importStock.totalPrice),"input-class":"text-orange-10 text-weight-bold text-right","bg-color":"orange-1",disable:"",filled:"",dense:""},{append:a(()=>[oo]),_:1},8,["model-value"])])])])]),_:1})]))])]),_:1})]),_:1},8,["modelValue"]))}});var ao=oe(lo,[["__scopeId","data-v-47f6e66b"],["__file","D:/gopms-web/src/modules/stock/import/components/import-stock-view-modal.vue"]]);const so={class:"relative-position",style:{"min-height":"200px"}},io={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},no={key:0},co={class:"row align-left"},ro=["onClick"],uo={class:"row justify-between"},mo=F("Seen"),po={class:"q-mt-md row justify-end"},_o=le({setup(l){const{t:s}=se(),d=Xe(),v=C.formatDate,{hasPermission:c}=Ge(),b=f(null),Y=f(null),h=f(null),D=f(!1),i=f(!1),V=f(!1),$=()=>{D.value=!1,J.value()},{notifyUpdateSuccess:q}=Qe(),_=()=>{i.value=!1,J.value()},S=()=>{V.value=!1},w=f({key:"All receipts",id:0}),U=f({key:"Today",id:1}),j=B(()=>[{name:"index",label:s("no"),field:"index",align:"left"},{name:"importDate",label:s("import_date_time"),field:"importDate",align:"left"},{name:"receiptId",label:s("import_receipt_id"),field:"receiptId",align:"left"},{name:"totalPrice",label:s("total"),field:"totalPrice",align:"right"},{name:"note",label:s("note"),field:"note",align:"left"},{name:"action",label:"",field:"action",align:"left"}]);let E=new Date,N=f(v(Date.now(),Z)),K=f(v(Date.now(),Z)),u=f(v(new Date(E.getFullYear(),E.getMonth(),E.getDate()-7),Z)),r=f({currentPage:1,lastPage:1});const g=rt();ve(w,()=>{r.value.currentPage=1}),ve(U,()=>{r.value.currentPage=1});let{data:P,isLoading:W,refetch:J}=nt({page:r,limit:10,startWeek:u,displayType:w,startTime:N.value?N:u,endTime:K});const Me=y=>{u.value=y.startWeek,r.value.currentPage=1,N.value=y.startTime,K.value=y.endTime,w.value=y.valuereceipts},Ue=y=>{d.dialog({message:s("are_you_sure_delete_import_receipt"),cancel:{color:"grey-8",label:s("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:s("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{g.mutate({importStockSn:y},{onSuccess:p=>{(p==null?void 0:p.code)===1&&q(),J.value()}})}).onCancel(()=>{})},Ne=y=>{var p;V.value=!0,(p=h.value)==null||p.setupCreateImportStockDialog(Number(y))},Re=()=>{D.value=!0},Fe=y=>{var p;i.value=!0,(p=Y.value)==null||p.setupEditImportStockDialog(Number(y))},Ye=()=>{Re()};return(y,p)=>{var ce,re,de,ue;return k(),x(z,null,[t("div",so,[t("div",null,[o(at,{"booking-no-field":!1,"is-add":!0,"is-category":!1,onChangeSuccess:Me,onAddImportReceipt:Ye}),o(Ve,{showing:e(W),label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:a(()=>[t("div",io,[o(je,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),e(W)?X("v-if",!0):(k(),x("div",no,[e(P)?(k(),M(Ke,{key:0,rows:(re=(ce=e(P))==null?void 0:ce.data)==null?void 0:re.importStockList,columns:e(j),"table-colspan":9,"table-header-class":"custom-header","row-key":"index","no-data-label":"No data","virtual-scroll-item-size":48,"rows-per-page-options":[0],"hide-pagination":"","hide-bottom":""},{header:a(n=>[o(ge,{props:n},{default:a(()=>[(k(!0),x(z,null,ae(n.cols,A=>(k(),M(We,{key:A.name,props:n},{default:a(()=>[F(m(A.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:a(n=>[o(ge,{props:n},{default:a(()=>[o(R,{key:"index",props:n,class:Q(n.row.deleteTime?"opacity-view":"")},{default:a(()=>[F(m(e(lt)(e(r).currentPage,n.pageIndex)),1)]),_:2},1032,["props","class"]),o(R,{key:"importDate"},{default:a(()=>[t("div",{class:Q(["row align-left",n.row.deleteTime?"opacity-view":""])},m(e(C).formatDate(n.row.importDate*1e3,e(te))),3)]),_:2},1024),o(R,{key:"receiptId"},{default:a(()=>[t("div",co,[t("span",{class:Q(["q-ml-xs",!n.row.deleteTime&&e(c)("add-edit-delete-import-receipt")==!0?"doc-link":"opacity-view"]),onClick:A=>!n.row.deleteTime&&e(c)("add-edit-delete-import-receipt")==!0?Fe(n.row.sn):""},m(n.row.receiptId),11,ro)])]),_:2},1024),o(R,{key:"totalPrice"},{default:a(()=>[t("div",{class:Q(["text-right",n.row.deleteTime?"opacity-view":""])},m(e(ne)(n.row.totalPrice))+" VND ",3)]),_:2},1024),o(R,{key:"note"},{default:a(()=>[t("div",uo,[t("div",{class:Q([n.row.deleteTime?"opacity-view":"","limit-text"])},[F(m(n.row.note)+" ",1),n.row.note?(k(),M(G,{key:0},{default:a(()=>[F(m(n.row.note),1)]),_:2},1024)):X("v-if",!0)],2)])]),_:2},1024),o(R,{key:"action",class:"text-align-end"},{default:a(()=>[n.row.deleteTime?(k(),M(I,{key:1,dense:"",round:"",flat:"",class:Q(e(c)("view-import-receipt-detail")===!1?"hidden":""),icon:"visibility",onClick:A=>Ne(n.row.sn)},{default:a(()=>[o(G,null,{default:a(()=>[mo]),_:1})]),_:2},1032,["class","onClick"])):(k(),M(I,{key:0,dense:"",round:"",flat:"",class:Q(e(c)("add-edit-delete-import-receipt")===!1?"hidden":""),icon:"delete",onClick:A=>Ue(n.row.sn)},{default:a(()=>[o(G,null,{default:a(()=>[F(m(e(s)("delete")),1)]),_:1})]),_:2},1032,["class","onClick"]))]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])):X("v-if",!0),t("div",po,[o(Je,{modelValue:e(r).currentPage,"onUpdate:modelValue":p[0]||(p[0]=n=>e(r).currentPage=n),color:"negative",max:((ue=(de=e(P))==null?void 0:de.data)==null?void 0:ue.meta.lastPage)||1,"max-pages":6,"direction-links":""},null,8,["modelValue","max"])])]))])]),o(Ut,{ref_key:"importStockCreateRef",ref:b,modelValue:D.value,"onUpdate:modelValue":p[1]||(p[1]=n=>D.value=n),onClose:$},null,8,["modelValue"]),o(ot,{ref_key:"importStockEditRef",ref:Y,modelValue:i.value,"onUpdate:modelValue":p[2]||(p[2]=n=>i.value=n),onClose:_},null,8,["modelValue"]),o(ao,{ref_key:"importStockViewRef",ref:h,modelValue:V.value,"onUpdate:modelValue":p[3]||(p[3]=n=>V.value=n),onClose:S},null,8,["modelValue"])],64)}}});var zo=oe(_o,[["__scopeId","data-v-6b059f76"],["__file","D:/gopms-web/src/modules/stock/import/view.vue"]]);export{zo as default};
