var vt=Object.defineProperty,ft=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var Z=(e,c,_)=>c in e?vt(e,c,{enumerable:!0,configurable:!0,writable:!0,value:_}):e[c]=_,tt=(e,c)=>{for(var _ in c||(c={}))gt.call(c,_)&&Z(e,_,c[_]);if(X)for(var _ of X(c))ht.call(c,_)&&Z(e,_,c[_]);return e},et=(e,c)=>ft(e,St(c));import{Q as kt}from"./QToolbarTitle.6428114f.js";import{aw as R,_ as nt,J as it,r as h,a as N,C as yt,w as ct,p as bt,P as t,F as I,G as U,I as o,aF as L,R as g,N as u,az as D,O as xt,M as S,q as P,an as ot,Q as V,U as wt,aJ as rt,aK as ut,av as qt,bh as dt,L as lt,aD as It,ay as Vt,bn as Dt,T as $t,V as Qt,W as Pt,aG as Ct,aH as Mt,aI as Tt}from"./index.7efcbe86.js";import{Q as Lt}from"./QToolbar.1dcdb2c5.js";import{Q as Nt}from"./QInnerLoading.5fef3982.js";import{Q as Ut}from"./QDate.804040fd.js";import{Q as Ft}from"./QPopupProxy.9996c4ad.js";import{Q as Rt}from"./QForm.df816fa6.js";import{C as G}from"./ClosePopup.145acd40.js";import{u as mt}from"./useI18n.6b7b36de.js";import{b as C,c as Et}from"./axiosClient.a0ee23b9.js";import{Q as F}from"./queryKeys.832af9fa.js";import{f as j,c as Ot}from"./useFormat.349e799c.js";import{u as At}from"./use-quasar.f3f15168.js";import{Q as st}from"./QSelect.8edab530.js";import{a as at}from"./QMenu.b19dfcca.js";import{Q as Bt}from"./QTooltip.c975c2a0.js";import{u as zt}from"./useCategoryServiceQuery.9c0b8426.js";import{u as Kt}from"./useNotify.967ca7e7.js";const Yt=async e=>{const{data:c}=await C.post("/inventory/stock/calculateAmountImportStock",e);return c},Ht=()=>R(Yt,{}),Jt=async e=>{const{data:c}=await C.get(`/inventory/extraProperty/getProductList?categorySn=${e}&limit=1100&isActive=1`);return c},Gt=()=>R(Jt,{onSuccess:()=>{}});const E=e=>(rt("data-v-3f0ea452"),e=e(),ut(),e),jt={key:0,class:"row col-12 col-md-12"},Wt={class:"col-md-2 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},Xt={class:"q-ma-none text-weight-bold"},Zt=E(()=>o("span",null,"*",-1)),te={class:"col-md-2 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},ee={class:"q-ma-none text-weight-bold"},oe=E(()=>o("span",null,"*",-1)),le={class:"col-md-2 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},se={class:"q-ma-none text-weight-bold"},ae={class:"q-ma-none text-weight-bold"},ne=E(()=>o("span",null,"*",-1)),ie={class:"col-md-2 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},ce={class:"q-ma-none text-weight-bold"},re=["id","value","onChange"],ue={class:"col-md-2 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},de={class:"q-ma-none text-weight-bold"},me=["value"],pe={class:"col-md-1 col-sm-2 col-xs-3 q-pa-sm q-px-sm"},_e=E(()=>o("p",{class:"q-ma-none text-weight-bold"},"\xA0",-1)),ve=it({props:{dataStock:{type:null,required:!0},view:{type:Number,required:!0},index:{type:Number,required:!0}},emits:["calculateAmoundStock","deleteImportStockView"],setup(e,{emit:c}){const _=e,x=h(!1),y=Gt(),{t:n}=mt(),p=N(()=>_.dataStock),k=h(!1);_.view===1&&(k.value=!0);const $=h(!1);_.index===0&&($.value=!0),_.dataStock.categorySn?y.mutate(_.dataStock.categorySn,{onSuccess:d=>{b.value=d.data.productList}}):x.value=!0;const O=h(null),A=[d=>!!d||n("this_field_is_required")],B=h(null),W=[d=>!!d||n("this_field_is_required")],w=h(null),M=[d=>d>=1||n("quantity_validate")],b=h(),i=yt({importPrice:!1}),{data:v}=zt(),q=h();ct(v,()=>{var d,l,s;((l=(d=v==null?void 0:v.value)==null?void 0:d.pages[0])==null?void 0:l.length)>0?q.value=(s=v==null?void 0:v.value)==null?void 0:s.pages[0]:q.value=v==null?void 0:v.value}),bt(()=>{var d,l,s;((l=(d=v==null?void 0:v.value)==null?void 0:d.pages[0])==null?void 0:l.length)>0?q.value=(s=v==null?void 0:v.value)==null?void 0:s.pages[0]:q.value=v==null?void 0:v.value});const T=()=>{c("deleteImportStockView")},z=d=>{const l=d;p.value.productSn=null,l&&y.mutate(l,{onSuccess:s=>{b.value=s.data.productList}})},K=()=>{Q()},Q=async()=>{!p.value.categorySn||!p.value.productSn||p.value.quantity<=0||await c("calculateAmoundStock")},Y=d=>{var l;!((l=d==null?void 0:d.productSn)!=null&&l.sn)||(p.value.productSn=d.productSn.sn,Q())},H=()=>{Q()};return(d,l)=>t(p)?(I(),U("div",jt,[o("div",Wt,[o("p",Xt,[L(g(t(n)("category"))+" ",1),Zt]),u(st,{ref_key:"category",ref:O,modelValue:t(p).categorySn,"onUpdate:modelValue":[l[0]||(l[0]=s=>t(p).categorySn=s),l[1]||(l[1]=s=>z(t(p).categorySn))],filled:"",dense:"","map-options":"",options:q.value,"emit-value":"",disable:k.value,"option-value":"sn","option-label":"name",label:t(n)("select_category"),clearable:"",behavior:"menu",class:"custom-input-readonly",rules:A},null,8,["modelValue","options","disable","label"])]),o("div",te,[o("p",ee,[L(g(t(n)("product")),1),oe]),u(st,{ref_key:"product",ref:B,modelValue:t(p).productSn,"onUpdate:modelValue":[l[2]||(l[2]=s=>t(p).productSn=s),l[3]||(l[3]=s=>Y(t(p)))],filled:"",dense:"","map-options":"",disable:k.value,options:b.value,"option-label":"name","option-value":"sn",class:"custom-input-readonly",label:t(n)("select_product"),clearable:"",rules:W},null,8,["modelValue","disable","options","label"])]),o("div",le,[o("p",se,g(t(n)("unit")),1),u(D,{ref_key:"quantity",ref:w,modelValue:t(p).productUnitName,"onUpdate:modelValue":l[4]||(l[4]=s=>t(p).productUnitName=s),disable:"",filled:"",dense:"","lazy-rules":""},null,8,["modelValue"])]),o("div",{class:xt(["col-md-1 col-sm-6 col-xs-12 q-pa-sm q-px-sm",k.value?"col-md-2":""])},[o("p",ae,[L(g(t(n)("quantity")),1),ne]),u(D,{ref_key:"quantity",ref:w,modelValue:t(p).quantity,"onUpdate:modelValue":[l[5]||(l[5]=s=>t(p).quantity=s),l[6]||(l[6]=s=>H())],filled:"","bg-color":k.value?"":"grey-1",dense:"",disable:k.value,"lazy-rules":"",rules:M},null,8,["modelValue","bg-color","disable"])],2),o("div",ie,[o("p",ce,g(t(n)("import_price")),1),u(at,{modelValue:t(p).importPrice,"onUpdate:modelValue":[l[7]||(l[7]=s=>t(p).importPrice=s),l[10]||(l[10]=s=>K())],modelModifiers:{number:!0},filled:"",dense:"",disable:k.value,class:"col","bg-color":k.value?"":"grey-1",suffix:"VND",debounce:"500",type:"number",rules:[s=>s>=0||t(n)("the_value_is_from_1_to_100_000_000_000"),s=>s<=1e11||t(n)("the_value_is_from_1_to_100_000_000_000")],onBlur:l[8]||(l[8]=s=>t(i).importPrice=!1),onFocus:l[9]||(l[9]=s=>t(i).importPrice=!0)},{control:S(({id:s,floatingLabel:J,modelValue:a,emitValue:m})=>[P(o("input",{id:s,class:"q-field__input text-right",value:t(i).importPrice?a:t(j)(a),onChange:r=>t(Ot)(r,a,m)},null,40,re),[[ot,J]])]),_:1},8,["modelValue","disable","bg-color","rules"])]),o("div",ue,[o("p",de,g(t(n)("total")),1),u(at,{modelValue:t(p).total,"onUpdate:modelValue":l[11]||(l[11]=s=>t(p).total=s),modelModifiers:{number:!0},filled:"",dense:"",class:"col",disable:"",suffix:"VND",debounce:"500",rules:[s=>s>=0||t(n)("the_value_is_from_1_to_100_000_000_000"),s=>s<=1e11||t(n)("the_value_is_from_1_to_100_000_000_000")]},{control:S(({modelValue:s})=>[o("input",{class:"q-field__input text-right",value:t(j)(s)},null,8,me)]),_:1},8,["modelValue","rules"])]),P(o("div",pe,[_e,u(V,{dense:"",round:"",flat:"",color:"grey",class:"float-right",icon:"delete",onClick:l[12]||(l[12]=s=>T())},{default:S(()=>[u(Bt,null,{default:S(()=>[L(g(t(n)("delete")),1)]),_:1})]),_:1})],512),[[ot,!k.value&&!$.value]])])):wt("v-if",!0)}});var fe=nt(ve,[["__scopeId","data-v-3f0ea452"],["__file","D:/gopms-web/src/modules/stock/import/components/import-stock.vue"]]);const Se=async e=>{if(!e.stockSn.value||e.stockSn.value===-1)return;const{data:c}=await C.get(`/inventory/stock/getImportStockDetail?importStockSn=${e.stockSn.value}&isDelete=${e.isDelete}`);return c.data},ge=e=>qt([F.IMPORT_STOCK,{params:e}],()=>Se(e)),he=async e=>{const{data:c}=await C.post("/inventory/stock/removeImportStockDetail",e);return c},ke=()=>{const e=dt();return R(he,{onSuccess:(c,_)=>{const x=e.getQueryData(F.IMPORT_STOCK);if(!x)return;const{data:y}=x;!y||e.setQueryData(F.IMPORT_STOCK,()=>et(tt({},x),{data:y.filter(n=>n.importStockDetailSn!==_.importStockDetailSn)}))}})},ye=async e=>{const{data:c}=await C.post("/inventory/stock/updateImportStock",e);return c},be=()=>{const e=dt();return R(ye,{onSuccess:()=>{e.invalidateQueries(F.IMPORT_STOCK)}})};const xe=e=>(rt("data-v-f0f8202c"),e=e(),ut(),e),we={class:"text-h6 text-weight-bold q-pa-md"},qe={key:0,class:"wrapper q-pa-md"},Ie={class:"col-md-6 col-sm-6 col-xs-12"},Ve={class:"text-weight-bold"},De={class:"col-md-6 col-sm-6 col-xs-12 responsive-padding-block"},$e={class:"text-weight-bold"},Qe={class:"row items-center justify-end"},Pe={class:"col-sm-12 col-xs-12"},Ce={class:"text-weight-bold"},Me={class:"q-pt-md col-12"},Te={class:"q-pa-md bg-grey-2"},Le={class:"row col-12 col-md-12"},Ne={class:"col-6 text-h7 text-weight-bold"},Ue={class:"col-sm-6 col-xs-12 text-h7 text-weight-bold"},Fe={class:"col-12 q-pt-md col-md-12"},Re={class:"row col-12 col-md-12"},Ee={class:"col-md-8 col-sm-6 col-xs-12 q-pa-sm q-px-sm"},Oe={class:"text-h7 text-weight-bold"},Ae={class:"col-md-4 col-sm-6 col-xs-12"},Be=xe(()=>o("span",{class:"text-orange-10 text-subtitle2 text-weight-bold"},"VND",-1)),ze={class:"col-12 col-md-12 custome-btn"},Ke=it({props:{modelValue:{type:Boolean,require:!0}},emits:["close","update:modelValue"],setup(e,{expose:c,emit:_}){const x=e,y=At(),{t:n}=mt(),p=h(),k=h(-1),{notifyUpdateSuccess:$}=Kt(),O=be(),A=ke(),B=Ht();c({setupEditImportStockDialog:async a=>{k.value=a,b.value()}});const{data:w,isLoading:M,refetch:b}=ge({stockSn:k,isDelete:0}),i=h({});ct(w,()=>{var a,m;i.value=w.value,((m=(a=i==null?void 0:i.value)==null?void 0:a.importStock)==null?void 0:m.note)===null&&(i.value.importStock.note=" ")}),i.value=N(()=>w.value);const v=()=>{var a;(a=i.value)==null||a.importStockDetailList.push({categorySn:null,productSn:null,unit:"",quantity:1,importPrice:0,total:0})},q=(a,m)=>{if(!m){i.value.importStockDetailList.splice(a,1),T();return}y.dialog({message:n("are_you_sure_delete_this_row"),cancel:{color:"grey-8",label:n("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:n("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{let r={importStockDetailSn:m};A.mutate(r,{onSuccess:async f=>{(f==null?void 0:f.code)===1&&($(),b.value()),b.value()}})}).onCancel(()=>{y.notify({message:n("cancel"),position:"top",type:"negative",actions:[{color:"white"}]})}),b.value()},T=()=>{let a=0;if(i.value.importStockDetailList.map(function(m){(!m.categorySn||!m.productSn)&&(a=1)}),a===0){const m={importStock:[...i.value.importStockDetailList]};m.importStock.forEach(r=>{r.importPrice=Number(r.importPrice),r.total=Number(r.total)}),i.value.importStockDetailList.length>0?B.mutate(m,{onSuccess:r=>{i.value.importStock.totalPrice=r.data.totalPrice?r.data.totalPrice:0,i.value.importStockDetailList=r.data.importStockList}}):i.value.importStock.totalPrice=0}else return},z=h(null),K=[a=>!!a||n("this_field_is_required"),a=>(a==null?void 0:a.length)>=1&&(a==null?void 0:a.length)<51||n("the_length_is_from_1_to_50_characters")],Q=h(null),Y=[a=>a!==null||n("the_length_is_from_0_to_200_characters"),a=>200>(a==null?void 0:a.length)||n("the_length_is_from_0_to_200_characters")],H=N(()=>{var a,m,r;return((r=(m=(a=i==null?void 0:i.value)==null?void 0:a.importStock)==null?void 0:m.note)==null?void 0:r.length)>200}),d=N({get(){return x.modelValue},set(a){_("update:modelValue",a)}}),l=()=>{var a;(a=p.value)==null||a.validate().then(m=>{if(m){const r={importStockSn:i.value.importStock.sn,note:i.value.importStock.note,totalPrice:i.value.importStock.totalPrice,importStockDetail:[...i.value.importStockDetailList]};O.mutate(r,{onSuccess:f=>{(f==null?void 0:f.code)===1?($(),setTimeout(()=>{_("close")},800)):(f==null?void 0:f.code)===2&&(f==null?void 0:f.error).forEach(_t=>{y.notify({message:_t.message,position:"top",type:"negative",actions:[{color:"white"}]})})}})}else return!1})},s=()=>{J()},J=()=>{i.value=w.value||"[]"};return(a,m)=>(I(),lt(Tt,{modelValue:t(d),"onUpdate:modelValue":m[2]||(m[2]=r=>Mt(d)?d.value=r:null),"full-width":"",onHide:s},{default:S(()=>[u(Ct,{class:"view-form"},{default:S(()=>[u(Lt,{class:"q-pa-md"},{default:S(()=>[u(kt,null,{default:S(()=>[o("div",we,g(t(n)("edit_import_stock")),1)]),_:1}),P(u(V,{class:"q-pa-md",flat:"",round:"",dense:"",icon:"close"},null,512),[[G]])]),_:1}),o("div",null,[t(M)?(I(),U("div",qe,[u(Nt,{showing:t(M),label:"Please wait...","lab55el-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"])])):(I(),lt(Rt,{key:1,ref_key:"editImportStockRef",ref:p,class:"q-gutter-md q-pa-md",onSubmit:It(l,["prevent","stop"])},{default:S(()=>[u(Vt,{class:"row"},{default:S(()=>[o("div",Ie,[o("p",Ve,g(t(n)("import_receipt_id")),1),u(D,{ref_key:"nameField",ref:z,modelValue:i.value.importStock.receiptId,"onUpdate:modelValue":m[0]||(m[0]=r=>i.value.importStock.receiptId=r),filled:"",disable:"",dense:"","bg-color":"grey-3",placeholder:t(n)("import_receipt_id"),"lazy-rules":"",rules:K},null,8,["modelValue","placeholder"])]),o("div",De,[o("p",$e,g(t(n)("import_date_time")),1),u(D,{"model-value":t(Dt).formatDate(i.value.importStock.importDate*1e3,t(Et)),disable:"","bg-color":"grey-3",dense:"",filled:""},{prepend:S(()=>[u($t,{name:"event",class:"cursor-pointer"},{default:S(()=>[u(Ft,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:S(()=>[u(Ut,{"model-value":i.value.importStock.importDate,mask:"YYYY-MM-DD HH:mm"},{default:S(()=>[o("div",Qe,[P(u(V,{label:"Close",color:"primary",flat:""},null,512),[[G]])])]),_:1},8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value"])]),o("div",Pe,[o("p",Ce,g(t(n)("note")),1),u(D,{ref_key:"note",ref:Q,modelValue:i.value.importStock.note,"onUpdate:modelValue":m[1]||(m[1]=r=>i.value.importStock.note=r),"bg-color":"grey-1",placeholder:t(n)("input_note"),filled:"",autogrow:"",rules:Y,error:t(H)},{error:S(()=>[o("p",null,g(t(n)("the_length_is_from_0_to_200_characters")),1)]),_:1},8,["modelValue","placeholder","error"])]),o("div",Me,[o("div",Te,[o("div",Le,[o("div",Ne,g(t(n)("import_stock")),1),o("div",Ue,[u(V,{outline:"",class:"btn-fixed-width float-right",color:"negative",label:t(n)("add_new"),icon:"add_circle",onClick:v},null,8,["label"])])]),(I(!0),U(Pt,null,Qt(i.value.importStockDetailList,(r,f)=>(I(),U("div",{key:f,class:"row col-12 col-md-12"},[u(fe,{"data-stock":r,view:0,index:f,onCalculateAmoundStock:T,onDeleteImportStockView:pt=>q(f,r.sn)},null,8,["data-stock","index","onDeleteImportStockView"])]))),128))])]),o("div",Fe,[o("div",Re,[o("div",Ee,[o("p",Oe,g(t(n)("total_price")),1)]),o("div",Ae,[u(D,{"model-value":t(j)(i.value.importStock.totalPrice),"input-class":"text-orange-10 text-weight-bold text-right","bg-color":"orange-1",disable:"",filled:"",dense:""},{append:S(()=>[Be]),_:1},8,["model-value"])])])])]),_:1}),o("div",ze,[P(u(V,{label:t(n)("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[G]]),u(V,{label:t(n)("save"),type:"submit",color:"negative"},null,8,["label"])])]),_:1},8,["onSubmit"]))])]),_:1})]),_:1},8,["modelValue"]))}});var mo=nt(Ke,[["__scopeId","data-v-f0f8202c"],["__file","D:/gopms-web/src/modules/stock/components/import-stock-edit-modal.vue"]]);export{fe as I,ge as a,mo as b,Ht as u};
