var se=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var D=(l,e,r)=>e in l?se(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r,q=(l,e)=>{for(var r in e||(e={}))le.call(e,r)&&D(l,r,e[r]);if(B)for(var r of B(e))ae.call(e,r)&&D(l,r,e[r]);return l},J=(l,e)=>te(l,oe(e));import{av as ne,aw as G,bh as re,_ as R,J as U,i as ie,r as _,w as K,at as de,a as ue,F as V,G as C,I as s,R as m,P as o,N as u,M as w,bo as ce,az as y,U as _e,Q as T,W,T as N,K as me,L as pe,aJ as ve,aK as fe}from"./index.7efcbe86.js";import{Q as we}from"./QInnerLoading.5fef3982.js";import{Q as z}from"./QSelect.8edab530.js";import{Q as Y}from"./QForm.df816fa6.js";import{u as L}from"./useI18n.6b7b36de.js";import{b as M,V as he,u as A,L as I}from"./axiosClient.a0ee23b9.js";import{Q as X}from"./queryKeys.832af9fa.js";import{u as ge}from"./roleQuery.127a9451.js";import{u as H}from"./useNotify.967ca7e7.js";import"./QMenu.b19dfcca.js";import"./position-engine.4a23d733.js";import"./selection.6afffe69.js";import"./QItemLabel.938a9258.js";import"./rtl.4b414a6d.js";import"./use-quasar.f3f15168.js";const be=async()=>{const{data:l}=await M.get("/staff/getProfileInfo");return l.data},ye=()=>ne([X.ME],()=>be()),xe=async l=>{const{data:e}=await M.post("/staff/updateProfileInfo",l);return e},Pe=()=>{const l=re();return G(xe,{onSuccess:e=>{const r=X.ME,v=l.getQueryData(r);!v||l.setQueryData(r,()=>q(q({},v),e))}})},qe={class:"row q-pb-md justify-between"},Ve={class:"text-h6 text-bold"},Fe={class:"relative-position"},Se={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},$e={key:0},Qe={class:"row q-gutter-x-md"},ke={class:"col"},Ee={class:"required text-bold q-my-xs"},Ne={class:"col"},Ie={class:"text-bold q-my-xs"},Ce={class:"row q-gutter-x-md"},Re={class:"col"},Ue={class:"text-bold q-my-xs"},Le={class:"col"},Me={class:"text-bold q-my-xs"},Oe={class:"row q-gutter-md"},je={class:"col"},Be={class:"text-bold q-my-xs"},De=s("div",{class:"col"},null,-1),Je={class:"col-12 col-md-12 row justify-end"},Ke=U({setup(l){const{data:e,isFetching:r}=ye(),{data:v,refetch:x}=ge(),c=Pe(),{t:i}=L(),F=ie("emitter"),a=_(),{notifyUpdateSuccess:S}=H();K(r,()=>{a.value=e!=null&&e.value?JSON.parse(JSON.stringify(e==null?void 0:e.value)):[],a.value.gender=a.value.gender===0?null:a.value.gender}),K(()=>de.global.locale.value,()=>{x.value()});const $=_(null),Q=[t=>he.test(t)||i("this_is_invalid_value"),t=>8<=t.length&&12>=t.length||i("the_length_is_from_8_to_12_characters")],h=_(null),g=[t=>!!t||i("this_field_is_required"),t=>t.indexOf(" ")!==0||i("this_field_not_blank"),t=>t.length<=50||i("the_length_is_from_0_to_50_characters")],b=_(null),k=ue(()=>[{name:i("male"),value:1},{name:i("female"),value:2}]),n=()=>{a.value.gender=a.value.gender===null?1:2},d=()=>{var t,p,f;c.mutate({fullName:(t=a.value)==null?void 0:t.fullName,mobile:(p=a.value)==null?void 0:p.mobile,gender:(f=a.value)==null?void 0:f.gender},{onSuccess:E=>{var O,j;if((E==null?void 0:E.code)===1){const{setLocalStorageWithExpiry:Z}=A(),ee=(O=JSON.parse(localStorage.getItem(I)||"{}"))==null?void 0:O.expiry,P=(j=JSON.parse(localStorage.getItem(I)||"{}"))==null?void 0:j.value;P.fullName=a.value.fullName,P.mobile=a.value.mobile,P.gender=a.value.gender,Z(I,P,ee),F.emit("changeProfileInfo"),S()}}})};return(t,p)=>(V(),C(W,null,[s("div",qe,[s("div",Ve,m(o(i)("basic_info")),1)]),s("div",Fe,[u(Y,{class:"q-gutter-md",onSubmit:d},{default:w(()=>[u(we,{showing:o(r),label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:w(()=>[s("div",Se,[u(ce,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),o(r)?_e("v-if",!0):(V(),C("div",$e,[s("div",Qe,[s("div",ke,[s("p",Ee,m(o(i)("name")),1),u(y,{ref_key:"nameField",ref:h,modelValue:a.value.fullName,"onUpdate:modelValue":p[0]||(p[0]=f=>a.value.fullName=f),outlined:"",dense:"",placeholder:o(i)("input_name"),rules:g},null,8,["modelValue","placeholder"])]),s("div",Ne,[s("p",Ie,m(o(i)("email")),1),u(y,{outlined:"",dense:"","model-value":a.value.email,"bg-color":"grey-5",disable:""},null,8,["model-value"])])]),s("div",Ce,[s("div",Re,[s("p",Ue,m(o(i)("mobile")),1),u(y,{ref_key:"mobileField",ref:$,modelValue:a.value.mobile,"onUpdate:modelValue":p[1]||(p[1]=f=>a.value.mobile=f),outlined:"",dense:"",mask:"############",placeholder:o(i)("input_mobile"),"unmasked-value":"",rules:Q},null,8,["modelValue","placeholder"])]),s("div",Le,[s("p",Me,m(o(i)("gender")),1),u(z,{ref_key:"sexField",ref:b,modelValue:a.value.gender,"onUpdate:modelValue":p[2]||(p[2]=f=>a.value.gender=f),options:o(k),label:o(i)("select_gender"),dense:"",outlined:"","map-options":"","option-label":"name","emit-value":"",onBlur:n},null,8,["modelValue","options","label"])])]),s("div",Oe,[s("div",je,[s("p",Be,m(o(i)("role")),1),u(z,{"model-value":a.value.roleSn,label:o(i)("role"),options:o(v),"map-options":"",dense:"",outlined:"","option-label":"name","option-value":"sn","emit-value":"","bg-color":"grey-5",disable:""},null,8,["model-value","label","options"])]),De])])),s("div",Je,[u(T,{label:o(i)("save"),color:"negative",type:"submit",class:"q-px-lg","no-caps":"",unelevated:"",loading:o(c).isLoading.value,disable:o(r)},null,8,["label","loading","disable"])])]),_:1})])],64))}});var ze=R(Ke,[["__file","D:/gopms-web/src/modules/profile/components/me-form.vue"]]);const Ge=async l=>{const{data:e}=await M.post("/passport/changePassword",l);return e},Te=()=>G(Ge),We={class:"row q-pb-md justify-between"},Ye={class:"text-h6 text-bold"},Ae={class:"row q-gutter-x-md"},Xe={class:"col"},He={class:"required text-bold q-my-xs"},Ze=s("div",{class:"col"},null,-1),es={class:"row q-gutter-x-md"},ss={class:"col"},ts={class:"required text-bold q-my-xs"},os={class:"col"},ls={class:"required text-bold q-my-xs"},as={class:"col-12 col-md-12 row justify-end"},ns=U({setup(l){const{t:e}=L(),{signOut:r}=A(),v=Te(),{notifyUpdateSuccess:x}=H(),c=_({curPassword:"",newPassword:"",reEnterPassword:""}),i=_(null),F=_(null),a=[n=>!!n||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters")],S=[n=>!!n||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters"),n=>{var d;return((d=c.value)==null?void 0:d.curPassword)!=n||e("your_current_password_is_incorrect")}],$=_(null),Q=[n=>!!n&&!!c.value.newPassword||e("this_field_is_required"),n=>8<=n.length&&16>=n.length||e("the_length_is_from_8_to_16_characters"),n=>c.value.newPassword===n||e("the_new_password_and_re_enter_password_do_not_match")],h=_(!1),g=_(!1),b=_(!1),k=()=>{const{curPassword:n,newPassword:d}=c.value;v.mutate({curPassword:n,newPassword:d},{onSuccess:t=>{(t==null?void 0:t.code)===1&&(x(),r())}})};return(n,d)=>(V(),C(W,null,[s("div",We,[s("div",Ye,m(o(e)("change_password")),1)]),u(Y,{onSubmit:k},{default:w(()=>[s("div",Ae,[s("div",Xe,[s("p",He,m(o(e)("current_password")),1),u(y,{ref_key:"curPasswordField",ref:i,modelValue:c.value.curPassword,"onUpdate:modelValue":d[1]||(d[1]=t=>c.value.curPassword=t),outlined:"",dense:"",label:o(e)("input_current_password"),rules:a,type:h.value?"text":"password"},{append:w(()=>[u(N,{name:h.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[0]||(d[0]=t=>h.value=!h.value)},null,8,["name"])]),_:1},8,["modelValue","label","type"])]),Ze]),s("div",es,[s("div",ss,[s("p",ts,m(o(e)("new_password")),1),u(y,{ref_key:"newPasswordField",ref:F,modelValue:c.value.newPassword,"onUpdate:modelValue":d[3]||(d[3]=t=>c.value.newPassword=t),outlined:"",dense:"",label:o(e)("input_new_password"),rules:a&&S,type:b.value?"text":"password"},{append:w(()=>[u(N,{name:b.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[2]||(d[2]=t=>b.value=!b.value)},null,8,["name"])]),_:1},8,["modelValue","label","rules","type"])]),s("div",os,[s("p",ls,m(o(e)("re_enter_password")),1),u(y,{ref_key:"reEnterPasswordField",ref:$,modelValue:c.value.reEnterPassword,"onUpdate:modelValue":d[5]||(d[5]=t=>c.value.reEnterPassword=t),outlined:"",dense:"",label:o(e)("re_enter_new_password"),rules:Q,type:g.value?"text":"password"},{append:w(()=>[u(N,{name:g.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:d[4]||(d[4]=t=>g.value=!g.value)},null,8,["name"])]),_:1},8,["modelValue","label","type"])])]),s("div",as,[u(T,{label:o(e)("save"),color:"negative",type:"submit",class:"q-px-lg","no-caps":"",unelevated:"",loading:o(v).isLoading.value},null,8,["label","loading"])])]),_:1})],64))}});var rs=R(ns,[["__file","D:/gopms-web/src/modules/profile/components/change-password-form.vue"]]);const is=l=>(ve("data-v-6dec1eac"),l=l(),fe(),l),ds={class:"row q-mb-md justify-between"},us={class:"text-h5 text-bold"},cs=is(()=>s("hr",{class:"q-my-md"},null,-1)),_s={name:"Profile"},ms=U(J(q({},_s),{setup(l){const{t:e}=L();return(r,v)=>{const x=me("pms-sections");return V(),pe(x,null,{header:w(()=>[s("div",ds,[s("div",us,m(o(e)("my_account")),1)])]),default:w(()=>[u(ze),cs,u(rs)]),_:1})}}}));var ks=R(ms,[["__scopeId","data-v-6dec1eac"],["__file","D:/gopms-web/src/modules/profile/view.vue"]]);export{ks as default};
