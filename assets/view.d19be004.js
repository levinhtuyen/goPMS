import{aw as Ve,_ as Re,J as we,r as q,bx as Ie,bJ as Qe,K as xe,F as f,G as Be,N as a,P as e,M as n,W as Ne,I as d,R as p,Q as $,L as k,am as F,q as R,aF as w,U as v,bo as Oe}from"./index.7efcbe86.js";import{Q as I,a as Q}from"./selection.6afffe69.js";import{Q as Pe}from"./QList.e5651779.js";import{Q as $e}from"./QMenu.b19dfcca.js";import{Q as M,a as j,b as z}from"./QTabPanels.ffcab7b1.js";import{Q as Te}from"./QTabs.85589f95.js";import{Q as Ue}from"./QInnerLoading.5fef3982.js";import{C as x}from"./ClosePopup.145acd40.js";import{b as qe}from"./axiosClient.a0ee23b9.js";import{s as le,I as Fe,S as Me,P as je}from"./useBookingStatus.37cf751f.js";import{u as ze,a as ie,b as Ee,C as Le,c as Je,d as Ae,e as Ge}from"./useCheckInMutation.b014659e.js";import{u as Ke}from"./useI18n.6b7b36de.js";import{u as re}from"./useNotify.967ca7e7.js";import{u as ue}from"./use-quasar.f3f15168.js";import"./position-engine.4a23d733.js";import"./touch.70a9dd44.js";import"./use-cache.b0833c75.js";import"./QResizeObserver.315a2c46.js";import"./rtl.4b414a6d.js";import"./QSelect.8edab530.js";import"./QItemLabel.938a9258.js";import"./QForm.df816fa6.js";import"./useCalculateBookingAmountMutation.46b5c200.js";import"./queryKeys.832af9fa.js";import"./useFormat.349e799c.js";import"./QDate.804040fd.js";import"./QPopupProxy.9996c4ad.js";import"./date.2d51ed98.js";import"./useAppendixQuery.039c05de.js";import"./QSpace.c00d4884.js";import"./QBar.49f2f7c7.js";import"./useValidate.96008b94.js";import"./QTable.4cc8e1c9.js";import"./QTooltip.c975c2a0.js";import"./QToolbarTitle.6428114f.js";import"./QToolbar.1dcdb2c5.js";import"./const.327e9cc0.js";import"./QTime.fadff47c.js";import"./TouchPan.87d2034a.js";import"./useCreateDate.6141d343.js";const We=async B=>{const{data:b}=await qe.post("reservation/updateBookingDetail",B);return b.data},He=()=>Ve(We,{onSuccess:()=>{}});function Xe(){const B=ue(),{notifyUpdateSuccess:b}=re(),s=ze(),{refetchBookingDetails:T}=ie();return{handleCheckIn:N=>{B.dialog({message:"Are you sure you want to check in this booking?",cancel:{color:"grey-8",label:"Cancel",noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:"Confirm",noCaps:!0,dense:!0}}).onOk(()=>{s.mutate({bookingSn:N?String(N):""},{onSuccess:U=>{U&&(b(),T.value())}})})}}}const Ye={class:"row justify-between items-center",style:{height:"100%"}},Ze={class:"text-bold",style:{"font-size":"20px"}},eo={class:"row items-center"},oo={style:{"font-size":"20px","margin-right":"16px"}},to={class:"text-bold"},ao={class:"row justify-center q-mb-md"},no={class:"text-right q-mt-md"},so={lass:"full-width full-height q-mt-md row justify-center"},lo=we({setup(B){const{notifyUpdateSuccess:b}=re(),{t:s}=Ke(),T=ue(),m=q("roomInformation"),N=Ie(),U=Qe(),ce=q(),me=q(),de=He(),{handleCheckIn:pe}=Xe(),{isDisplayEarlyCheckIn:fe,formPayment:S,formRoomInfo:o,serviceInfo:E,refetchBookingDetails:L,bookingDetailsFetching:ge}=ie(),{ui:u,cancelReservationDialogRef:ke,changeStayDateDialogRef:ve,changeRoomDialogRef:be,checkOutDialogRef:Se,openChangeStayDate:ye,openCancelReservationDialog:he,openChangeRoomDialog:_e,openCheckOutDialog:De}=Ee(),O=g=>{switch(L.value(),g){case"cancelReservation":u.cancelReservationVisible=!1;break;case"changeStayDate":u.changeStayDateVisible=!1;break;case"changeRoom":u.changeRoomVisible=!1;break;case"checkOut":u.checkOutDialogVisible=!1;break}},Ce=()=>{T.dialog({message:s("confirm_edit_pricing"),cancel:{color:"grey-8",label:s("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:s("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{const g=E.value.map(function(c){return{createBy:c.createBy,deleteBy:c.deleteBy,deleteReason:c.deleteReason,deleteTime:c.deleteTime,productName:c.productName,productSn:c.productSn,quantity:c.quantity,sn:c.sn,totalPrice:c.totalPrice,unitPrice:c.unitPrice}}),t={bookingSn:o.value.sn,bookingTypeSn:o.value.bookingTypeSn,bookingSourceSn:o.value.bookingSourceSn,note:o.value.note,guest:o.value.guest,extraFee:S.value.extraFee,depositMethodSn:S.value.depositMethodSn,amountDeposit:S.value.amountDeposit,discount:S.value.discount,service:g};de.mutate(t,{onSuccess:()=>{b(),L.value(),U.push({name:"BookingDetails",params:{sn:o.value.sn}})}})})};return(g,t)=>{const c=xe("pms-sections");return f(),Be(Ne,null,[a(Le,{ref_key:"changeRoomDialogRef",ref:be,modelValue:e(u).changeRoomVisible,"onUpdate:modelValue":t[0]||(t[0]=l=>e(u).changeRoomVisible=l),onChangeSuccess:t[1]||(t[1]=l=>O("changeRoom"))},null,8,["modelValue"]),a(Je,{ref_key:"cancelReservationDialogRef",ref:ke,modelValue:e(u).cancelReservationVisible,"onUpdate:modelValue":t[2]||(t[2]=l=>e(u).cancelReservationVisible=l),onCancelSuccess:t[3]||(t[3]=l=>O("cancelReservation"))},null,8,["modelValue"]),a(Ae,{ref_key:"checkOutDialogRef",ref:Se,modelValue:e(u).checkOutDialogVisible,"onUpdate:modelValue":t[4]||(t[4]=l=>e(u).checkOutDialogVisible=l),onCheckOutSuccess:t[5]||(t[5]=l=>O("checkOut"))},null,8,["modelValue"]),a(Ge,{ref_key:"changeStayDateDialogRef",ref:ve,modelValue:e(u).changeStayDateVisible,"onUpdate:modelValue":t[6]||(t[6]=l=>e(u).changeStayDateVisible=l),onChangeSuccess:t[7]||(t[7]=l=>O("changeStayDate"))},null,8,["modelValue"]),a(c,{title:e(s)("edit_booking_detail"),class:"relative-position"},{default:n(()=>{var l,J,A,G,K;return[d("div",Ye,[d("p",Ze,p((l=e(o))==null?void 0:l.roomTypeCode)+" - "+p((J=e(o))==null?void 0:J.roomName),1),d("div",eo,[d("p",oo,"#"+p((A=e(o))==null?void 0:A.bookingNo),1),a($,{"no-caps":"",unelevated:"",color:(K=e(le)((G=e(o))==null?void 0:G.bookingStatusSn))==null?void 0:K.color},{default:n(()=>{var i,y;return[d("p",to,p((y=e(le)((i=e(o))==null?void 0:i.bookingStatusSn))==null?void 0:y.typeName),1)]}),_:1},8,["color"]),e(N).name!=="BookingEdit"?(f(),k($,{key:0,class:"bg-grey-1",icon:"more_vert",flat:""},{default:n(()=>[a($e,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:n(()=>[a(Pe,{style:{"min-width":"200px"}},{default:n(()=>{var i,y,W,H,X,Y,Z,ee,oe,te,ae,ne;return[a(F),((i=e(o))==null?void 0:i.bookingStatusSn)===2||((y=e(o))==null?void 0:y.bookingStatusSn)===5?R((f(),k(I,{key:0,clickable:"",onClick:t[8]||(t[8]=P=>{var r;return e(De)((r=e(o))==null?void 0:r.sn)})},{default:n(()=>[a(Q,{class:"row"},{default:n(()=>[w(p(e(s)("check_out")),1)]),_:1})]),_:1})),[[x]]):v("v-if",!0),((W=e(o))==null?void 0:W.bookingStatusSn)===4||((H=e(o))==null?void 0:H.bookingStatusSn)===1?R((f(),k(I,{key:1,clickable:"",onClick:t[9]||(t[9]=P=>{var r;return e(pe)((r=e(o))==null?void 0:r.sn)})},{default:n(()=>[a(Q,{class:"row"},{default:n(()=>[w(p(e(s)("check_in")),1)]),_:1})]),_:1})),[[x]]):v("v-if",!0),((X=e(o))==null?void 0:X.bookingStatusSn)===1||((Y=e(o))==null?void 0:Y.bookingStatusSn)===4||((Z=e(o))==null?void 0:Z.bookingStatusSn)===2?R((f(),k(I,{key:2,clickable:"",onClick:t[10]||(t[10]=P=>{var r,h,_,D,C,V,se;return e(ye)((r=e(o))==null?void 0:r.sn,(h=e(o))==null?void 0:h.roomName,(D=(_=e(o))==null?void 0:_.guest[0])==null?void 0:D.fullName,Number((C=e(o))==null?void 0:C.checkIn),Number((V=e(o))==null?void 0:V.checkOut),(se=e(o))==null?void 0:se.bookingStatusSn)})},{default:n(()=>[a(Q,{class:"row"},{default:n(()=>[w(p(e(s)("change_stay_date")),1)]),_:1})]),_:1})),[[x]]):v("v-if",!0),((ee=e(o))==null?void 0:ee.bookingStatusSn)===1||((oe=e(o))==null?void 0:oe.bookingStatusSn)===4||((te=e(o))==null?void 0:te.bookingStatusSn)===2?R((f(),k(I,{key:3,clickable:"",onClick:t[11]||(t[11]=P=>{var r,h,_,D,C,V;return e(_e)((r=e(o))==null?void 0:r.roomSn,(h=e(o))==null?void 0:h.roomName,(D=(_=e(o))==null?void 0:_.guest[0])==null?void 0:D.fullName,(C=e(o))==null?void 0:C.sn,(V=e(o))==null?void 0:V.roomTypeSn)})},{default:n(()=>[a(Q,{class:"row"},{default:n(()=>[w(p(e(s)("change_room")),1)]),_:1})]),_:1})),[[x]]):v("v-if",!0),a(F),((ae=e(o))==null?void 0:ae.bookingStatusSn)===1||((ne=e(o))==null?void 0:ne.bookingStatusSn)===4?R((f(),k(I,{key:4,clickable:"",onClick:t[12]||(t[12]=P=>{var r;return e(he)((r=e(o))==null?void 0:r.sn)})},{default:n(()=>[a(Q,{class:"row"},{default:n(()=>[w(p(e(s)("cancel_booking")),1)]),_:1})]),_:1})),[[x]]):v("v-if",!0)]}),_:1})]),_:1})]),_:1})):v("v-if",!0)])]),a(F,{class:"q-my-md"}),d("div",ao,[a(Te,{modelValue:m.value,"onUpdate:modelValue":t[13]||(t[13]=i=>m.value=i),dense:"","active-color":"white",align:"justify","indicator-color":"transparent",class:"box-shadow-tabs col-lg-5 col-md-8 col-xs-12 row","active-bg-color":"negative"},{default:n(()=>[a(M,{name:"roomInformation",class:"col custom-tab",label:e(s)("room_information"),"no-caps":""},null,8,["label"]),a(M,{name:"services",class:"col custom-tab",label:e(s)("services"),"no-caps":""},null,8,["label"]),a(M,{name:"payment",class:"col custom-tab",label:e(s)("payment"),"no-caps":""},null,8,["label"])]),_:1},8,["modelValue"])]),d("div",null,[a(z,{modelValue:m.value,"onUpdate:modelValue":t[14]||(t[14]=i=>m.value=i),class:"overflow-auto"},{default:n(()=>[a(j,{name:"roomInformation"},{default:n(()=>[a(Fe,{ref_key:"formInforRef",ref:ce,data:e(o),page:"edit"},null,8,["data"])]),_:1})]),_:1},8,["modelValue"]),a(z,{modelValue:m.value,"onUpdate:modelValue":t[15]||(t[15]=i=>m.value=i),class:"overflow-auto"},{default:n(()=>[a(j,{name:"services"},{default:n(()=>[a(Me,{data:e(E),"room-info":e(o),page:"services"},null,8,["data","room-info"])]),_:1})]),_:1},8,["modelValue"]),a(z,{modelValue:m.value,"onUpdate:modelValue":t[16]||(t[16]=i=>m.value=i),class:"overflow-auto"},{default:n(()=>[a(j,{name:"payment"},{default:n(()=>[a(je,{ref_key:"formPaymentRef",ref:me,"form-room-info":e(o),data:e(S),page:"edit","is-display-early-check-in":e(fe)},null,8,["form-room-info","data","is-display-early-check-in"])]),_:1})]),_:1},8,["modelValue"])]),d("div",no,[a($,{class:"q-mr-md",dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"},label:"Cancel",onClick:t[17]||(t[17]=i=>g.$router.push({name:"BookingDetails",params:{sn:g.$route.params.sn}}))}),a($,{class:"",color:"negative",label:"Save","no-caps":"",onClick:Ce})]),a(Ue,{showing:e(ge)},{default:n(()=>[d("div",so,[a(Oe,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"])]}),_:1},8,["title"])],64)}}});var Ko=Re(lo,[["__scopeId","data-v-aa8df462"],["__file","D:/gopms-web/src/modules/booking/booking-edit/view.vue"]]);export{Ko as default};
