var Vt=Object.defineProperty,Dt=Object.defineProperties;var Ct=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var Rt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var et=(n,c,g)=>c in n?Vt(n,c,{enumerable:!0,configurable:!0,writable:!0,value:g}):n[c]=g,ie=(n,c)=>{for(var g in c||(c={}))Rt.call(c,g)&&et(n,g,c[g]);if(Ze)for(var g of Ze(c))$t.call(c,g)&&et(n,g,c[g]);return n},tt=(n,c)=>Dt(n,Ct(c));import{Q as Ue}from"./QSpace.c00d4884.js";import{aw as ge,_ as Ce,J as Re,r as v,C as se,a as X,F as w,L as J,M as l,N as o,I as t,R as a,P as e,q as Y,Q as T,am as ue,ay as ce,aH as ae,T as ve,O as Xe,aE as $e,aF as z,aG as ke,aI as Se,av as Pe,bI as Pt,w as Ve,au as It,G as E,bo as nt,V as Me,W as Ae,U as it,az as he,aD as Nt,aJ as ct,aK as ut,an as Fe,bh as rt,p as Ot,at as Tt,bx as Qt,by as Ft}from"./index.7efcbe86.js";import{Q as Le}from"./QBar.49f2f7c7.js";import{Q as ot}from"./QDate.804040fd.js";import{Q as Te}from"./QPopupProxy.9996c4ad.js";import{Q as lt}from"./QTime.fadff47c.js";import{a as De}from"./QMenu.b19dfcca.js";import{Q as we}from"./QForm.df816fa6.js";import{C as le}from"./ClosePopup.145acd40.js";import{u as Ie}from"./useNotify.967ca7e7.js";import{c as Mt}from"./useCreateDate.6141d343.js";import{b as At}from"./useValidate.96008b94.js";import{d as me}from"./date.2d51ed98.js";import{b as te,F as xe,c as pe,L as Ut}from"./axiosClient.a0ee23b9.js";import{u as Ne}from"./useI18n.6b7b36de.js";import{Q as _e}from"./QSelect.8edab530.js";import{Q as Lt,a as at,c as fe,b as Et}from"./QTable.4cc8e1c9.js";import{f as Z,a as Bt,c as Ke}from"./useFormat.349e799c.js";import{u as dt}from"./use-quasar.f3f15168.js";import{u as jt}from"./useAppendixQuery.039c05de.js";import{Q as re}from"./queryKeys.832af9fa.js";import{u as zt}from"./useCalculateBookingAmountMutation.46b5c200.js";import{Q as Ht}from"./QInnerLoading.5fef3982.js";import{Q as Qe}from"./QTooltip.c975c2a0.js";import{Q as Jt,a as st}from"./selection.6afffe69.js";import{Q as Yt}from"./QList.e5651779.js";const Kt=async n=>{if(!n.sn)return!1;const{data:c}=await te.post("reservation/updateStayDate",n);return c},Xt=()=>ge(Kt,{});const Gt={class:"text-h5 text-bold"},Wt={class:"row items-center justify-between q-mt-md"},Zt={class:"text-bold text-body1"},eo={class:"text-bold text-body1"},to={class:"col"},oo={class:"q-mb-xs"},lo={class:"row items-center justify-end"},ao={class:"self-center full-width no-outline",tabindex:"0"},so={class:"row items-center justify-end"},no={class:"col"},io={class:"q-mb-xs"},co={class:"row items-center justify-end"},uo={class:"self-center full-width no-outline",tabindex:"0"},ro={class:"row items-center justify-end"},mo=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","changeSuccess"],setup(n,{expose:c,emit:g}){const P=n,{t:C}=Ne(),V=v(null),{notifyUpdateSuccess:B}=Ie(),b=Xt(),s=v(""),Q=v(""),A=v(),{formatDate:q,subtractFromDate:G}=me,R=se({sn:null,checkIn:Date.now()/1e3,checkOut:Date.now()/1e3}),H=X({get(){return P.modelValue},set(F){g("update:modelValue",F)}}),f=X({get:()=>q(new Date(R.checkIn*1e3),xe),set:F=>{R.checkIn=Number(q(new Date(F),"X"))}}),u=X({get:()=>q(new Date(R.checkOut*1e3),xe),set:F=>{R.checkOut=Number(q(new Date(F),"X"))}}),$=X(()=>!1),j=F=>new Date(F)>=G(new Date,{day:30}),k=F=>{const m=f.value?Mt(q(f.value,pe)):"";return m&&m.setHours(0,0,0),m?new Date(F)>=m:new Date(F)>=G(new Date,{day:30})},N=()=>{var F;(F=A.value)==null||F.validate().then(m=>{if(m)b.mutate({sn:R.sn,checkIn:R.checkIn,checkOut:R.checkOut},{onSuccess:h=>{h&&(B(),g("changeSuccess"))}});else return!1})};return c({setupChangeStayDateDialog:async(F,m,h,D,ye,qe)=>{R.sn=F,s.value=h,Q.value=m,R.checkIn=D,R.checkOut=ye,V.value=qe}}),(F,m)=>(w(),J(Se,{modelValue:e(H),"onUpdate:modelValue":m[6]||(m[6]=h=>ae(H)?H.value=h:null)},{default:l(()=>[o(ke,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",Gt,a(e(C)("change_stay_date")),1),o(Ue),Y(o(T,{dense:"",flat:"",icon:"close"},null,512),[[le]])]),_:1}),o(ue),t("div",Wt,[t("p",Zt,a(Q.value),1),t("p",eo,a(s.value),1)]),o(ce,{class:"q-pa-none q-py-md"},{default:l(()=>[o(we,{ref_key:"changeStayDateFomRef",ref:A,class:"q-gutter-md"},{default:l(()=>[t("div",to,[t("p",oo,a(e(C)("arrival_date_time"))+"*",1),o(De,{modelValue:e(f),"onUpdate:modelValue":m[2]||(m[2]=h=>ae(f)?f.value=h:null),placeholder:e(C)("select_date_time"),filled:"",dense:"",class:"custom-input-readonly",debounce:"500",rules:[h=>!!h||"Please input Arrival date time"],"bg-color":e($)?"grey-5":"",readonly:e($),disable:e($)},{prepend:l(()=>[o(ve,{name:"event",class:Xe(e($)?"":"cursor-pointer")},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(ot,{modelValue:e(f),"onUpdate:modelValue":m[0]||(m[0]=h=>ae(f)?f.value=h:null),mask:e(xe),options:j},{default:l(()=>[t("div",lo,[Y(o(T,{label:"Close",color:"primary",flat:""},null,512),[[le]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1},8,["class"])]),control:l(()=>[t("div",ao,a(e(q)(e(f),e(pe))),1)]),append:l(()=>[o(ve,{name:"access_time",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(lt,{modelValue:e(f),"onUpdate:modelValue":m[1]||(m[1]=h=>ae(f)?f.value=h:null),mask:e(xe),format24h:""},{default:l(()=>[t("div",so,[Y(o(T,{label:"Close",color:"primary",flat:""},null,512),[[le]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder","rules","bg-color","readonly","disable"])]),t("div",no,[t("p",io,a(e(C)("departure_date_time"))+"*",1),o(De,{modelValue:e(u),"onUpdate:modelValue":m[5]||(m[5]=h=>ae(u)?u.value=h:null),placeholder:"Select date time",filled:"",dense:"",debounce:"500",rules:[h=>!!h||"Please input Departure date time",h=>e(At)(e(q)(e(f),e(pe)),e(q)(e(u),e(pe)))||e(C)("the_time_must_be_greater_than_arrival_date_time")]},{prepend:l(()=>[o(ve,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(ot,{modelValue:e(u),"onUpdate:modelValue":m[3]||(m[3]=h=>ae(u)?u.value=h:null),mask:e(xe),options:k},{default:l(()=>[t("div",co,[Y(o(T,{label:"Close",color:"primary",flat:""},null,512),[[le]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),control:l(()=>[t("div",uo,a(e(q)(e(u),e(pe))),1)]),append:l(()=>[o(ve,{name:"access_time",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(lt,{modelValue:e(u),"onUpdate:modelValue":m[4]||(m[4]=h=>ae(u)?u.value=h:null),mask:e(xe),format24h:""},{default:l(()=>[t("div",ro,[Y(o(T,{label:"Close",color:"primary",flat:""},null,512),[[le]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[Y((w(),J(T,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[z(a(e(C)("cancel")),1)]),_:1})),[[le]]),o(T,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:N},{default:l(()=>[z(a(e(C)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Ds=Ce(mo,[["__scopeId","data-v-893a37ce"],["__file","D:/gopms-web/src/modules/booking/room-view/components/ChangeStayDateDialog.vue"]]);const po=async n=>{if(n.keyword||n.categorySn){const{data:c}=await te.get("/inventory/extraProperty/getProductAvailableList",{params:{keyword:n.keyword,categorySn:n.categorySn}});return c.data}return!1},_o=n=>Pe([re.PRODUCT_SERVICES,n],()=>po(n)),vo=async n=>{if(!n.bookingSn)return!1;const{data:c}=await te.post("reservation/checkOutReservation",n);return c},fo=()=>ge(vo),ho=async({queryKey:n})=>{const[,c,g]=n;if(!c)return;const{data:P}=await te.get("reservation/getBookingDetail",{params:{bookingSn:c,serviceAvailable:g}});return P.data},mt=(n,c,{enabled:g})=>{const P=[re.BOOKING_DETAILS,n,c];return Pe(P,ho,{enabled:g,select:C=>C})},go=async()=>{const{data:n}=await te.get("/appendix/getCategoryList?limit=-1");return n.data},pt=()=>Pt(re.CATEGORY_SERVICES,go,{});const Ee=n=>(ct("data-v-27d07e88"),n=n(),ut(),n),yo={class:"custom-title-dialog text-bold"},bo={key:0,class:"full-width full-height q-mt-md column justify-center items-center q-py-md"},xo=Ee(()=>t("span",{class:"text-negative q-mt-md"},"Fetching booking details...",-1)),ko={class:"row q-my-sm"},So={class:"col-md-6 col-sm-6 col-xs-12 row"},wo={class:"col-md-4 col-xs-4"},qo={class:"col-md-8 col-xs-8"},Vo={class:"text-bold"},Do={class:"col-md-4 col-xs-4"},Co={class:"col-md-8 col-xs-8"},Ro={class:"text-weight-bold"},$o={class:"col-md-4 col-xs-4"},Po={class:"col-md-8 col-xs-8"},Io={class:"text-weight-bold"},No={class:"col-md-4 col-xs-4"},Oo={class:"col-md-8 col-xs-8"},To={class:"text-bold"},Qo={class:"col-md-6 col-sm-6 col-xs-12 row"},Fo={class:"col-md-4 col-xs-4"},Mo={class:"col-md-8 col-xs-8"},Ao={class:"text-bold"},Uo={class:"col-md-4 col-xs-4"},Lo={class:"col-md-8 col-xs-8"},Eo={class:"text-bold"},Bo={class:"col-md-4 col-xs-4"},jo={class:"col-md-8 col-xs-8"},zo={class:"text-bold"},Ho={class:"text-bold custom-font-size-title"},Jo={class:"bg-grey-2 q-pa-md rounded-borders"},Yo={class:"q-ma-none q-mb-md"},Ko={class:"q-mr-sm"},Xo=Ee(()=>t("span",null,"VND",-1)),Go={class:"row items-center justify-between text-bold text-body1"},Wo={class:"q-ma-none"},Zo={class:"q-ma-none"},el=Ee(()=>t("span",null,"VND",-1)),tl={class:"row"},ol={class:"col-md-6 col-sm-12 text-bold custom-font-size-title inline-block"},ll={class:"col-md-6 col-sm-12"},al={key:0,class:"ellipsis",style:{width:"300px"}},sl={key:1,style:{width:"250px"}},nl={key:0},il={key:1},cl={key:0},ul={key:1},rl={key:0},dl={key:1},ml={key:0},pl={key:1},_l={class:"text-right"},vl={key:1,class:"text-center"},fl={class:"row items-center justify-between text-bold bg-grey-2 q-pa-md q-my-md"},hl={class:"q-ma-none"},gl={class:"q-mr-sm"},yl=Ee(()=>t("span",null,"VND",-1)),bl={class:"text-bold custom-font-size-title"},xl={class:"row"},kl={class:"col-md-3 col-sm-6 col-xs-12"},Sl={class:"q-mb-xs"},wl=["id","value","onChange"],ql={class:"col-md-3 col-sm-6 col-xs-12"},Vl={class:"q-mb-xs"},Dl=["id","value","onChange"],Cl={class:"col-md-3 col-sm-6 col-xs-12"},Rl={class:"q-mb-xs"},$l={class:"col-md-3 col-sm-6 col-xs-12"},Pl={class:"q-mb-xs"},Il=["id","value","onChange"],Nl={class:"text-bold custom-font-size-title"},Ol={class:"text-bold custom-font-size-title"},Tl={class:"row"},Ql={class:"col-md-6 col-xs-12"},Fl={class:"q-mb-none"},Ml={class:"col-md-6 col-xs-12 payment-balance"},Al={class:"q-ma-none bg-deep-orange-1 text-negative rounded-borders q-pa-md text-weight-bold"},Ul={class:"q-mr-sm float-right"},Ll={class:"q-py-md"},El=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","checkOutSuccess"],setup(n,{expose:c,emit:g}){const P=n,C=v(),V=v(),B=v(),b=v(!1),{t:s}=Ne(),Q=me.formatDate,A=dt(),q=se({categorySn:null,keyword:"",bookingProductSnExceptList:""}),G=v(),R={bookingNo:"",bookingSourceSn:null,bookingStatusSn:null,bookingTypeSn:null,checkIn:"",checkInActual:"",checkOut:"",checkOutActual:"",note:"",pricingPlanName:"",roomTypeSn:null,pricingPlanSn:null,roomName:"",roomPrice:null,roomSn:null,roomTypeCode:"",sn:null,guest:[],roomStatusSn:null},H={amountRoomPrice:0,amountDeposit:0,balance:0,discount:0,earlyCheckIn:"",extraFee:0,lateCheckOut:"",servicesPrice:0,paid:0,depositMethod:0,roomPrice:"",total:0,amountEarlyCheckIn:0,amountLateCheckOut:0,depositMethodSn:0,paymentMethodSn:1},f=v(0),u=v(""),$=v([]),j=se([]),k=se([]),N=se([]),x=X(()=>[{name:"index",label:s("no"),field:"index",align:"left",style:"width: 50px",required:!0},{name:"product",label:s("products"),field:"category",style:"width: 250px",align:"left"},{name:"quantity",label:s("quantity"),field:"quantity",style:"width: 150px",align:"left"},{name:"unitPrice",label:s("unit_price"),field:"unitPrice",align:"left"},{name:"totalPrice",label:s("total_price"),field:"totalPrice",align:"left"},{name:"createTime",label:s("added_at"),field:"createTime",align:"left"},{name:"operations",field:"operations",label:" ",align:"left"}]),F=v({page:1,limit:10}),m=v(!1),h=v(ie({},R)),D=v(ie({},H)),ye=v(!1),{notifyUpdateSuccess:qe}=Ie(),be=v(""),je=v(1),ee=se({extraFee:!1,discount:!1,amountDeposit:!1}),ze=fo(),{data:S}=pt(),{data:p,isFetching:d}=_o(q),O=zt(),{data:U,isFetching:_t}=jt({enabled:!0}),{data:L,isFetching:vt,refetch:ft}=mt(be,je,{enabled:!0});Ve(L,()=>{var y,i,M,ne;L!=null&&L.value&&(ye.value=(y=L.value)==null?void 0:y.isDisplayEarlyCheckIn,D.value=ie({},(i=L.value)==null?void 0:i.payment),h.value=ie({},(M=L==null?void 0:L.value)==null?void 0:M.roomInformation),D.value.paymentMethodSn=1,(ne=L==null?void 0:L.value)!=null&&ne.service&&($.value=JSON.parse(JSON.stringify(L.value.service))),Je())}),Ve(d,()=>{q.categorySn&&d.value===!1&&wt()}),Ve(p,()=>{G.value=p.value});const He=X({get(){return P.modelValue},set(y){g("update:modelValue",y)}}),ht=X(()=>{switch(h.value.bookingTypeSn){case 1:return s("hourly");case 2:return s("overnight");case 3:return s("daily");default:return s("hourly")}}),Ge=X(()=>[{name:s("cash"),value:1},{name:s("credit_card"),value:2},{name:s("bank_transfer"),value:3},{name:s("debt"),value:4}]),We=X(()=>{let y=[...$.value,...j],i=0;return y.forEach(M=>{typeof M.unitPrice!="undefined"?i+=M.unitPrice*M.quantity:i+=M.product.price*M.quantity}),i}),gt=X(()=>D.value.balance+We.value),yt=X(()=>D.value.depositMethodSn===4||D.value.paymentMethodSn==4?[y=>!!y||s("booking_source_required")]:[]),bt=X(()=>D.value.depositMethodSn==4?[y=>!!y||s("this_field_is_required"),y=>y>=1||s("the_value_is_from_1_to_100_000_000_000"),y=>y<=1e11||s("the_value_is_from_1_to_100_000_000_000")]:[y=>y>=0||s("the_value_is_from_1_to_100_000_000_000"),y=>y<=1e11||s("the_value_is_from_1_to_100_000_000_000")]),Je=()=>{if(!h.value.checkInActual||!h.value.bookingTypeSn)return!1;const y={pricingPlanSn:h.value.pricingPlanSn,bookingType:h.value.bookingTypeSn,checkinDateTime:Number(h.value.checkInActual),checkoutDateTime:Number(me.formatDate(new Date,"X")),discount:D.value.discount||0,extraFee:D.value.extraFee||0,amountDeposit:D.value.amountDeposit||0};O.mutate(y,{onSuccess:i=>{h.value.roomPrice=i.roomPrice,D.value.total=i.totalCharge,D.value.balance=i.balance,D.value.amountRoomPrice=i.roomPrice,C.value=i.priceAdjustmentList}})},xt=async y=>{m.value=!1,j.splice(0,j.length),k.splice(0,k.length),y===be.value&&(ft.value(),Je()),be.value=y},kt=()=>{var y,i,M;L!=null&&L.value&&(ye.value=(y=L.value)==null?void 0:y.isDisplayEarlyCheckIn,D.value=ie({},(i=L.value)==null?void 0:i.payment),h.value=ie({},(M=L==null?void 0:L.value)==null?void 0:M.roomInformation))},St=()=>{var y;(y=V.value)==null||y.validate().then(i=>{if(i)A.dialog({style:"text-align: left",message:s("are_you_sure_check_out"),persistent:!0,cancel:{color:"grey-8",label:s("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:s("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{const M=v([]);j.forEach(K=>{var de;M.value.push({productSn:(de=K.product)==null?void 0:de.sn,quantity:K.quantity,createTime:K.createTime})}),k.forEach(K=>{M.value.push({bookingProductSn:K.bookingProductSn,deleteReason:K.deleteReason,quantity:K.quantity,productSn:K.productSn})});const ne={bookingSn:be.value,bookingSourceSn:h.value.bookingSourceSn,note:h.value.note,extraFee:D.value.extraFee,depositMethodSn:D.value.depositMethodSn,paymentMethodSn:D.value.paymentMethodSn,amountDeposit:D.value.amountDeposit,discount:D.value.discount,services:M.value};ze.mutate(ne,{onSuccess:K=>{K&&(qe(),g("checkOutSuccess"))}})});else return!1})},wt=async()=>{if(p.value){await j.push({product:JSON.parse(JSON.stringify(p==null?void 0:p.value[0])),productList:JSON.parse(JSON.stringify(p.value)),quantity:1,createTime:Number(me.formatDate(Date.now(),"X"))});const y=document.querySelector(".q-table__middle");y&&y.scrollTo(0,y==null?void 0:y.scrollHeight)}else It.create({message:s("not_ser_yet"),position:"top",type:"negative",actions:[{label:"Dismiss",color:"white"}]})},qt=(y,i,M,ne,K)=>{var de;(de=B.value)==null||de.validate().then(Oe=>{if(Oe)k.push({bookingProductSn:ne,deleteReason:M,productSn:y,quantity:i}),j.forEach(_=>{_.productList.forEach(oe=>{oe.sn===y&&(_.product.stock+=i)})}),N.push(ne),q.bookingProductSnExceptList=JSON.stringify(N),$.value.splice(K,1),b.value=!1;else return!1})},Ye=()=>{var y;(y=V.value)==null||y.validate().then(i=>{if(i)Je();else return!1})};return c({setupCheckOutDialog:xt}),(y,i)=>(w(),J(Se,{modelValue:e(He),"onUpdate:modelValue":i[21]||(i[21]=M=>ae(He)?He.value=M:null),"full-width":"","full-height":"",onHide:kt},{default:l(()=>[o(ke,{style:{padding:"3px 0px 27px 27px"},class:"no-scroll custom-dialog-checkout"},{default:l(()=>[o(Le,{class:"bg-white q-mt-md q-mr-lg q-pa-none",style:{"padding-bottom":"11px"}},{default:l(()=>[t("div",yo,a(e(s)("check_out")),1),o(Ue),Y(o(T,{dense:"",flat:"",icon:"close"},null,512),[[le]])]),_:1}),o(ue,{style:{"margin-right":"27px"}}),o(ce,{class:"q-pa-none q-pb-md scroll q-pr-md",style:{height:"calc(100% - 97px)","padding-top":"11px"}},{default:l(()=>[e(vt)?(w(),E("div",bo,[o(nt,{color:"negative",thickness:2,size:"2em"}),xo])):(w(),J(we,{key:1,ref_key:"checkOutFormRef",ref:V,class:"q-gutter-y-md q-ma-none q-mb-md"},{default:l(()=>{var M,ne,K,de,Oe;return[t("div",ko,[t("div",So,[t("div",wo,[t("p",null,a(e(s)("guest_make"))+":",1)]),t("div",qo,[t("p",Vo,a((ne=(M=h.value)==null?void 0:M.guest[0])==null?void 0:ne.fullName),1)]),t("div",Do,[t("p",null,a(e(s)("arrival_date_time"))+":",1)]),t("div",Co,[t("p",Ro,a(e(me).formatDate(new Date(Number((K=h.value)==null?void 0:K.checkInActual)*1e3),e(pe))),1)]),t("div",$o,[t("p",null,a(e(s)("departure_date_time"))+":",1)]),t("div",Po,[t("p",Io,a(e(me).formatDate(new Date,"DD/MM/YYYY HH:mm")),1)]),t("div",No,[t("p",null,a(e(s)("booking_type"))+":",1)]),t("div",Oo,[t("p",To,a(e(ht)),1)])]),t("div",Qo,[t("div",Fo,[t("p",null,a(e(s)("booking_number"))+":",1)]),t("div",Mo,[t("p",Ao,a((de=h.value)==null?void 0:de.bookingNo),1)]),t("div",Uo,[t("p",null,a(e(s)("room"))+":",1)]),t("div",Lo,[t("p",Eo,a(h.value.roomTypeCode)+" - "+a((Oe=h.value)==null?void 0:Oe.roomName),1)]),t("div",Bo,[t("p",null,a(e(s)("booking_source"))+":",1)]),t("div",jo,[t("p",zo,[o(_e,{modelValue:h.value.bookingSourceSn,"onUpdate:modelValue":i[0]||(i[0]=_=>h.value.bookingSourceSn=_),loading:e(_t),filled:"",dense:"",options:e(U),"option-value":"sn","option-label":"name","map-options":"","emit-value":"",label:e(s)("select_source"),clearable:"",behavior:"menu","input-class":"overflow-hidden",class:"q-field--with-bottom custom-input-readonly","input-style":"overflow: hidden;",rules:e(yt)},null,8,["modelValue","loading","options","label","rules"])])])])]),o(ue),o(ce,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",Ho,a(e(s)("room_price")),1),t("div",Jo,[(w(!0),E(Ae,null,Me(C.value,(_,oe)=>(w(),E("div",{key:oe,class:"row items-center justify-between text-body1"},[t("p",Yo,a(_.title),1),t("div",null,[t("span",Ko,a(e(Z)(_.roomPrice)),1),Xo])]))),128)),o(ue,{class:"q-my-md"}),t("div",Go,[t("p",Wo,a(e(s)("total_room_price")),1),t("p",Zo,[z(a(e(Z)(D.value.amountRoomPrice))+" ",1),el])])])]),_:1}),o(ue),o(ce,{class:"q-pa-none q-my-md"},{default:l(()=>{var _,oe,W;return[t("div",tl,[t("p",ol,a(e(s)("service")),1),t("div",ll,[m.value?(w(),J(_e,{key:1,modelValue:e(q).categorySn,"onUpdate:modelValue":i[2]||(i[2]=r=>e(q).categorySn=r),filled:"","fill-input":"",class:"ellipsis inline-block float-right",label:e(s)("category_placeholder"),"input-debounce":"200",options:(_=e(S))==null?void 0:_.pages[0],dense:"",outlined:"","option-label":"name","option-value":"sn","emit-value":"",clearable:"","map-options":"",style:{width:"220px"}},null,8,["modelValue","label","options"])):(w(),J(T,{key:0,outline:"","no-caps":"",color:"deep-orange-12",class:"bg-grey-1 float-right",label:e(s)("add_new"),icon:"add_circle",style:{"font-size":"12px"},onClick:i[1]||(i[1]=r=>m.value=!0)},null,8,["label"]))])]),((oe=$.value)==null?void 0:oe.length)>0||((W=e(j))==null?void 0:W.length)>0?(w(),J(Lt,{key:0,rows:[...$.value,...e(j)],columns:e(x),"table-colspan":9,"row-key":"index",class:"scroll-table",dense:"","no-data-label":"t('not_ser_yet')","virtual-scroll-item-size":48,"rows-per-page-options":[0],"hide-bottom":""},{header:l(r=>[o(at,{props:r},{default:l(()=>[(w(!0),E(Ae,null,Me(r.cols,I=>(w(),J(Et,{key:I.name,props:r,style:{"font-size":"14px","font-weight":"bold",height:"42px"}},{default:l(()=>[z(a(e(s)(I.label)),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:l(r=>[o(at,{class:"vertical-top custom-table",props:r},{default:l(()=>[o(fe,{key:"index",props:r},{default:l(()=>[t("p",null,a(e(Bt)(F.value.page,r.pageIndex)),1)]),_:2},1032,["props"]),o(fe,{key:"product",props:r},{default:l(()=>[r.row.productName?(w(),E("p",al,a(r.row.productName),1)):(w(),E("div",sl,[o(_e,{modelValue:r.row.product,"onUpdate:modelValue":[I=>r.row.product=I,I=>r.row.quantity=1],class:"q-mr-md",label:e(s)("select_product"),options:r.row.productList,dense:"",filled:"",outlined:"","map-options":"","option-label":"name","option-value":"sn"},null,8,["modelValue","onUpdate:modelValue","label","options"]),it(` <q-select
                        v-model="props.row.product"
                        class="q-mr-md"
                        label="Select product"
                        :options="props.row.productList"
                        dense
                        filled
                        use-chips
                        behavior="menu"
                        outlined
                        map-options
                        option-label="name"
                        option-value="sn"
                        fill-input
                        use-input
                        hide-selected
                        @filter="
                          (val, update) => {
                            filterProduct(val, update, Number(props.pageIndex - rows.length));
                          }
                        "
                        @input-value="setKeySearchCategoryModel"
                        @update:model-value="props.row.quantity = 1"
                      /> `)]))]),_:2},1032,["props"]),o(fe,{key:"quantity",props:r},{default:l(()=>[r.row.productName?(w(),E("p",nl,a(r.row.quantity),1)):(w(),E("div",il,[o(he,{modelValue:r.row.quantity,"onUpdate:modelValue":I=>r.row.quantity=I,outlined:"",dense:"",style:{width:"150px"},"input-class":"text-center"},{prepend:l(()=>[o(T,{flat:"",round:"",color:"grey-6",icon:"remove",style:{"max-height":"10px"},disable:r.row.quantity===1,onClick:I=>r.row.quantity--},null,8,["disable","onClick"])]),append:l(()=>[o(T,{flat:"",round:"",color:"grey-6",icon:"add",style:{"max-height":"10px"},disable:r.row.quantity===r.row.product.stock,onClick:I=>r.row.quantity++},null,8,["disable","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]),_:2},1032,["props"]),o(fe,{key:"unitPrice",props:r},{default:l(()=>[r.row.productName?(w(),E("p",ul,a(e(Z)(r.row.unitPrice))+" VND",1)):(w(),E("p",cl,a(e(Z)(r.row.product.price))+" VND ",1))]),_:2},1032,["props"]),o(fe,{key:"totalPrice",props:r},{default:l(()=>[r.row.productName?(w(),E("p",dl,a(e(Z)(r.row.quantity*r.row.unitPrice))+" VND",1)):(w(),E("p",rl,a(e(Z)(r.row.quantity*r.row.product.price))+" VND ",1))]),_:2},1032,["props"]),o(fe,{key:"createTime",props:r},{default:l(()=>[r.row.productName?(w(),E("p",ml,a(e(me).formatDate(new Date(Number(r.row.createTime)*1e3),e(pe))),1)):(w(),E("p",pl,a(e(Q)(new Date(Number(r.row.createTime)*1e3),e(pe))),1))]),_:2},1032,["props"]),o(fe,{key:"operations",props:r},{default:l(()=>[r.row.productList?(w(),J(ve,{key:0,name:"delete",color:"grey-6",icon:"delete",size:"1.8em",onClick:I=>e(j).splice(Number(r.pageIndex-$.value.length),1)},null,8,["onClick"])):(w(),J(ve,{key:1,name:"delete",color:"grey-6",size:"1.8em",class:"cursor-pointer",onClick:I=>(b.value=!0,f.value=r.pageIndex,u.value="")},{default:l(()=>[o(Se,{modelValue:b.value,"onUpdate:modelValue":i[5]||(i[5]=I=>b.value=I),"transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(ke,{class:"q-pa-md"},{default:l(()=>[o(we,{ref_key:"delReasonFormRef",ref:B,onSubmit:Nt(I=>qt(r.row.productSn,r.row.quantity,u.value,r.row.sn,f.value-$.value.length),["prevent","stop"])},{default:l(()=>[t("p",null,a(e(s)("delete_label_product")),1),o(he,{modelValue:u.value,"onUpdate:modelValue":i[3]||(i[3]=I=>u.value=I),class:"q-mb-sm",outlined:"",dense:"",placeholder:e(s)("reason_placeholder"),rules:[I=>!!I||e(s)("please_select_one_value"),I=>I.length<=200||e(s)("the_length_is_from_0_to_200_characters")]},null,8,["modelValue","placeholder","rules"]),t("div",_l,[o(T,{class:"q-mr-sm",outline:"","no-caps":"",color:"grey-8",label:e(s)("cancel"),onClick:i[4]||(i[4]=I=>b.value=!1)},null,8,["label"]),o(T,{type:"submit","no-caps":"",color:"negative",label:e(s)("confirm")},null,8,["label"])])]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1032,["onClick"]))]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])):(w(),E("div",vl,a(e(s)("not_ser_yet")),1)),t("div",fl,[t("p",hl,a(e(s)("total_services_amount")),1),t("div",null,[t("span",gl,a(e(Z)(e(We))),1),yl])])]}),_:1}),o(ue),o(ce,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",bl,a(e(s)("other_fees")),1),t("div",xl,[t("div",kl,[t("p",Sl,a(e(s)("extra_fee")),1),o(De,{modelValue:D.value.extraFee,"onUpdate:modelValue":[i[6]||(i[6]=_=>D.value.extraFee=_),i[9]||(i[9]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col q-pr-md",suffix:"VND",debounce:"500",rules:[_=>_>=0||e(s)("the_value_is_from_1_to_100_000_000_000"),_=>_<=1e11||e(s)("the_value_is_from_1_to_100_000_000_000")],type:"number",onBlur:i[7]||(i[7]=_=>e(ee).extraFee=!1),onFocus:i[8]||(i[8]=_=>e(ee).extraFee=!0)},{control:l(({id:_,floatingLabel:oe,modelValue:W,emitValue:r})=>[Y(t("input",{id:_,class:"q-field__input text-right",value:e(ee).extraFee?W:e(Z)(W),onChange:I=>e(Ke)(I,W,r)},null,40,wl),[[Fe,oe]])]),_:1},8,["modelValue","rules"])]),t("div",ql,[t("p",Vl,a(e(s)("discount")),1),o(De,{modelValue:D.value.discount,"onUpdate:modelValue":[i[10]||(i[10]=_=>D.value.discount=_),i[13]||(i[13]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col q-pr-md",suffix:"VND",debounce:"500",rules:[_=>_>=0||e(s)("the_value_is_from_1_to_100_000_000_000"),_=>_<=1e11||e(s)("the_value_is_from_1_to_100_000_000_000")],onBlur:i[11]||(i[11]=_=>e(ee).discount=!1),onFocus:i[12]||(i[12]=_=>e(ee).discount=!0)},{control:l(({id:_,floatingLabel:oe,modelValue:W,emitValue:r})=>[Y(t("input",{id:_,class:"q-field__input text-right",value:e(ee).discount?W:e(Z)(W),onChange:I=>e(Ke)(I,W,r)},null,40,Dl),[[Fe,oe]])]),_:1},8,["modelValue","rules"])]),t("div",Cl,[t("p",Rl,a(e(s)("deposit_method")),1),o(_e,{modelValue:D.value.depositMethodSn,"onUpdate:modelValue":i[14]||(i[14]=_=>D.value.depositMethodSn=_),class:"q-mr-md q-mb-md",label:e(s)("select_method"),options:e(Ge),dense:"",filled:"",outlined:"",clearable:"","map-options":"","option-label":"name","option-value":"value","emit-value":""},null,8,["modelValue","label","options"])]),t("div",$l,[t("p",Pl,a(e(s)("deposit_amount")),1),o(De,{modelValue:D.value.amountDeposit,"onUpdate:modelValue":[i[15]||(i[15]=_=>D.value.amountDeposit=_),i[18]||(i[18]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col",suffix:"VND",debounce:"500",rules:e(bt),onBlur:i[16]||(i[16]=_=>e(ee).amountDeposit=!1),onFocus:i[17]||(i[17]=_=>e(ee).amountDeposit=!0)},{control:l(({id:_,floatingLabel:oe,modelValue:W,emitValue:r})=>[Y(t("input",{id:_,class:"q-field__input text-right",value:e(ee).amountDeposit?W:e(Z)(W),onChange:I=>e(Ke)(I,W,r)},null,40,Il),[[Fe,oe]])]),_:1},8,["modelValue","rules"])])])]),_:1}),o(ue),o(ce,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",Nl,a(e(s)("booking_note")),1),o(he,{modelValue:h.value.note,"onUpdate:modelValue":i[19]||(i[19]=_=>h.value.note=_),filled:"",dense:"",placeholder:e(s)("input_booking_note"),behavior:"menu",rules:[_=>!_||_.length<=200||e(s)("the_length_is_from_0_to_200_characters")]},null,8,["modelValue","placeholder","rules"])]),_:1}),o(ue),o(ce,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",Ol,a(e(s)("payment")),1),t("div",Tl,[t("div",Ql,[t("p",Fl,a(e(s)("payment_method")),1),o(_e,{modelValue:D.value.paymentMethodSn,"onUpdate:modelValue":i[20]||(i[20]=_=>D.value.paymentMethodSn=_),class:"q-mr-md",label:e(s)("select_payment_method"),options:e(Ge),dense:"",filled:"",outlined:"",clearable:"","map-options":"","option-label":"name","option-value":"value","emit-value":"",rules:[_=>!!_||e(s)("please_select_one_value")]},null,8,["modelValue","label","options","rules"])]),t("div",Ml,[t("p",Al,[z(a(e(s)("balance"))+" ",1),t("span",Ul,a(e(Z)(e(gt)))+" VND",1)])])]),t("p",Ll," (*) "+a(e(s)("balance"))+" = "+a(e(s)("total_room_price"))+" + "+a(e(s)("total_services_amount"))+" + "+a(e(s)("extra_fee"))+" - "+a(e(s)("discount"))+" - "+a(e(s)("deposit_amount")),1)]),_:1})]}),_:1},512))]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right",style:{"padding-right":"27px"}},{default:l(()=>[Y((w(),J(T,{dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[z(a(e(s)("cancel")),1)]),_:1})),[[le]]),o(T,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:St},{default:l(()=>[z(a(e(s)("confirm_check_out")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Cs=Ce(El,[["__scopeId","data-v-27d07e88"],["__file","D:/gopms-web/src/modules/booking/room-view/components/CheckOutDialog.vue"]]);const Bl=async n=>{if(!n.roomSn||!n.bookingSn)return!1;const{data:c}=await te.post("reservation/updateRoom",n);return c},jl=()=>ge(Bl,{}),zl=async({queryKey:n})=>{const[,c]=n;if(!c)return;const{data:g}=await te.get(`/appendix/getRoomList?roomTypeSn=${c}`);return g.data},Hl=(n,{enabled:c})=>{const g=[re.ROOM_LIST,n];return Pe(g,zl,{enabled:c,select:P=>P})},Jl=async()=>{const{data:n}=await te.get("/appendix/getRoomTypeList");return n.data},Yl=()=>{const n=rt(),c=Pe(re.ROOM_TYPES,Jl,{staleTime:1e4}),g=C=>{const V=n.getQueryData(re.ROOM_TYPES);return V==null?void 0:V.find(B=>B.sn===C)},P=C=>{if(!C)return;const V=n.getQueryData(re.ROOM_TYPES);return V==null?void 0:V.find(B=>B.code===C)};return tt(ie({},c),{findRoomTypeBySn:g,findRoomTypeByCode:P})};const Kl={class:"text-h5 text-bold"},Xl={class:"row items-center justify-between q-mt-md"},Gl={class:"text-bold text-body1"},Wl={class:"text-bold text-body1"},Zl={class:"col"},ea={class:"q-mb-xs"},ta={class:"col"},oa={class:"q-mb-xs"},la=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","changeSuccess"],setup(n,{expose:c,emit:g}){const P=n,C=v(null),{notifyUpdateSuccess:V}=Ie(),B=jl(),b=v(""),s=v(""),Q=v(),{t:A}=Ne(),q=se({bookingSn:null,roomSn:null,reason:"",roomTypeSn:null}),{data:G}=Yl(),R=X({get(){return P.modelValue},set(k){g("update:modelValue",k)}}),{data:H,isFetching:f}=Hl(C,{enabled:!0}),u=()=>{var k;(k=Q.value)==null||k.validate().then(N=>{if(N)B.mutate(q,{onSuccess:x=>{x&&(V(),g("changeSuccess"))}});else return!1})},$=async(k,N,x,F,m)=>{q.bookingSn=F,q.roomSn=k,q.roomTypeSn=m,C.value=m,b.value=x,s.value=N},j=()=>{q.bookingSn=null,q.roomSn=null,q.reason="",q.roomTypeSn=null};return c({setupChangeRoomDialog:$}),(k,N)=>(w(),J(Se,{modelValue:e(R),"onUpdate:modelValue":N[3]||(N[3]=x=>ae(R)?R.value=x:null),onHide:j},{default:l(()=>[o(ke,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",Kl,a(e(A)("change_room")),1),o(Ue),Y(o(T,{dense:"",flat:"",icon:"close"},null,512),[[le]])]),_:1}),o(ue),t("div",Xl,[t("p",Gl,a(s.value),1),t("p",Wl,a(b.value),1)]),o(ce,{class:"q-pa-none q-py-md"},{default:l(()=>[o(we,{ref_key:"changeRoomFomRef",ref:Q,class:"q-gutter-md"},{default:l(()=>[t("div",Zl,[t("p",ea,a(e(A)("room_type_name")),1),o(_e,{modelValue:e(q).roomTypeSn,"onUpdate:modelValue":N[0]||(N[0]=x=>e(q).roomTypeSn=x),filled:"",dense:"",options:e(G)||[],"option-label":"name","option-value":"sn","map-options":"","emit-value":"",readonly:"",class:"custom-input-readonly","bg-color":"grey-5"},null,8,["modelValue","options"])]),t("div",ta,[t("p",oa,a(e(A)("room_name"))+"*",1),o(_e,{modelValue:e(q).roomSn,"onUpdate:modelValue":N[1]||(N[1]=x=>e(q).roomSn=x),loading:e(f),filled:"",dense:"","map-options":"",options:e(H)||[],"emit-value":"","option-label":"name","option-value":"sn",rules:[x=>!!x||"Please select Room name"]},null,8,["modelValue","loading","options","rules"])]),o(he,{modelValue:e(q).reason,"onUpdate:modelValue":N[2]||(N[2]=x=>e(q).reason=x),placeholder:e(A)("reason_placeholder_require"),class:"col",filled:"",rules:[x=>!!x||e(A)("this_field_is_required"),x=>x.length<=200||e(A)("reason_cancel_booking_valid_max")],type:"textarea","input-style":"height: 100px;",style:{"min-height":"100px"}},null,8,["modelValue","placeholder","rules"])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[Y((w(),J(T,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[z(a(e(A)("cancel")),1)]),_:1})),[[le]]),o(T,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:u},{default:l(()=>[z(a(e(A)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Rs=Ce(la,[["__scopeId","data-v-fe5a7166"],["__file","D:/gopms-web/src/modules/booking/room-view/components/ChangeRoomDialog.vue"]]);const aa=async n=>{if(!n.sn)return!1;const{data:c}=await te.post("reservation/cancelReservation",n);return c},sa=()=>ge(aa,{}),na={class:"row justify-start"},ia=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","cancelSuccess"],setup(n,{expose:c,emit:g}){const P=n,C=v(),{t:V}=Ne(),{notifyCreateSuccess:B}=Ie(),b=se({sn:null,reason:""}),s=sa(),Q=X({get(){return P.modelValue},set(R){g("update:modelValue",R)}}),A=()=>{var R;(R=C.value)==null||R.validate().then(H=>{if(H)s.mutate(b,{onSuccess:f=>{f&&(B(),g("cancelSuccess"))}});else return!1})},q=async R=>{b.sn=R},G=()=>{b.sn=null,b.reason=""};return c({setupCancelReservationDialog:q}),(R,H)=>(w(),J(Se,{modelValue:e(Q),"onUpdate:modelValue":H[1]||(H[1]=f=>ae(Q)?Q.value=f:null),onHide:G},{default:l(()=>[o(ke,{class:"q-pa-lg text-body1",style:{width:"580px"}},{default:l(()=>[it(` <q-bar class="bg-white q-my-md q-mr-sm q-pa-none">
        <div class="text-h5 text-bold">Cancel booking</div>
        <q-space />
        <q-btn v-close-popup dense flat icon="close"> </q-btn>
      </q-bar>
      <q-separator /> `),t("div",na,a(e(V)("are_you_sure_cancel_booking")),1),o(ce,{class:"q-pa-none q-pt-md"},{default:l(()=>[o(we,{ref_key:"cancelReservationFomRef",ref:C,class:"q-gutter-md"},{default:l(()=>[o(he,{modelValue:e(b).reason,"onUpdate:modelValue":H[0]||(H[0]=f=>e(b).reason=f),placeholder:e(V)("reason_placeholder"),class:"col q-mr-md",filled:"",rules:[f=>!!f||e(V)("reason_cancel_booking_valid_require"),f=>f.length<=200||e(V)("reason_cancel_booking_valid_max")],type:"textarea","input-style":"height: 100px;",style:{"min-height":"100px"}},null,8,["modelValue","placeholder","rules"])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal row justify-end"},{default:l(()=>[Y((w(),J(T,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[z(a(e(V)("cancel")),1)]),_:1})),[[le]]),o(T,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:A},{default:l(()=>[z(a(e(V)("confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var $s=Ce(ia,[["__file","D:/gopms-web/src/modules/booking/room-view/components/CancelReservation.vue"]]);const ca=async n=>{const{data:c}=await te.post("/reservation/addService",n);return c},ua=()=>{const n=rt();return ge(ca,{onSuccess:()=>{n.invalidateQueries(re.STAFF)}})},ra=async n=>{const{data:c}=await te.post("/inventory/stock/calculateAmountProduct",n);return c},da=()=>ge(ra,{}),ma=async n=>{const{data:c}=await te.get("/appendix/getStockInventory",{params:n});return c.data},pa=n=>Pe([re.PRODUCT_SERVICES,{params:n}],()=>ma(n));const Be=n=>(ct("data-v-21d09486"),n=n(),ut(),n),_a={class:"text-h5 text-bold"},va={key:0},fa={key:1},ha={class:"row items-center q-mt-md"},ga={class:"col-md-6 col-sm-6 col-xs-12"},ya={class:"col-md-3 col-sm-4 col-xs-12 q-ma-xs"},ba={class:"row"},xa={class:"col-md-6 col-sm-12 col-xs-12 q-pt-md style-bd-r"},ka={class:"card-product"},Sa={class:"card-product__header-left q-card__section q-card__section--vert bg-negative q-pa-sm"},wa={class:"text-subtitle1 text-white text-bold q-pl-md"},qa=Be(()=>t("div",{class:"item-product row items-baseline justify-between"},null,-1)),Va={class:"height-product"},Da={key:0,class:"style-scroll-product"},Ca={lass:"full-width full-height q-mt-md row justify-center"},Ra={class:"row items-center"},$a={class:"text-bold"},Pa=Be(()=>t("br",null,null,-1)),Ia={class:"text-bold"},Na={class:"col-md-6 col-sm-12 col-xs-12 q-pt-md"},Oa={class:"card-product"},Ta={class:"card-product__header-right q-card__section q-card__section--vert bg-negative q-pa-sm"},Qa={class:"is-text-header text-subtitle1 text-white text-bold q-pl-md"},Fa={class:"height-product"},Ma={class:"style-scroll-product"},Aa={class:"q-card__section col-md-5 col-sm-5 col-xs-12"},Ua={class:"q-pa-sm text-weight-500"},La={class:"row justify-between"},Ea={class:"limit-text",style:{"font-size":"14px"}},Ba=Be(()=>t("br",null,null,-1)),ja={class:"row q-card__section col-md-7 col-sm-7 col-xs-12 justify-end"},za={class:"q-pa-sm text-weight-500 col-md-6 col-sm-7 col-xs-12 items-end",style:{"text-align":"right"}},Ha=Be(()=>t("div",{class:"col-md-6 col-sm-12 col-xs-12"},null,-1)),Ja={class:"col-md-6 col-sm-12 col-xs-12"},Ya={class:"row style-input-total text-bold q-mb-md"},Ka={class:"col-md-6 col-sm-6 col-xs-6"},Xa={style:{float:"left"}},Ga={class:"col-md-6 col-sm-6 col-xs-6"},Wa=Re({props:{modelValue:{type:Boolean,required:!0},isRoomView:{type:Boolean,required:!0},bookingProductSnDeleteList:{type:null,required:!0},roomName:{type:String,required:!0}},emits:["update:modelValue","addServices","changeSuccess","closeDialog"],setup(n,{expose:c,emit:g}){const P=n,{notifyUpdateSuccess:C}=Ie(),V=se({sn:0,checkIn:"",checkOut:"",number:0,totalPrice:0}),B=dt(),b=v(),s=v(),Q=se({categorySn:"",keyword:"",bookingProductSnExceptList:"",isProductActive:1,isAddServiceOrderBy:1,limit:-1,notDeletedYet:1,bookingProductSnDeleteList:JSON.stringify(P.bookingProductSnDeleteList)}),A=ua(),q=da();let{data:G,isLoading:R,refetch:H}=pa(Q);const f=v(""),{t:u}=Ne(),$=X({get(){return P.modelValue},set(S){g("update:modelValue",S)}}),j=async(S,p)=>{H.value(),V.sn=S,f.value=p},k=v([]),N=S=>{var O;let p={exportQuantity:S.exportQuantity,importQuantity:S.importQuantity,lastInventory:S.lastInventory,productName:S.productName,productPrice:S.productPrice,productUnitName:S.productUnitName,sn:S.sn,startInventory:S.startInventory,quantity:1};if(H.value(),S.quantity=1,!S)return;let d=0;k.value.forEach(U=>{p.sn===U.sn&&(d=1)}),d===0&&(((O=k==null?void 0:k.value)==null?void 0:O.length)>0?k.value=[...k.value,ie({},p)]:k.value=[ie({},p)]),ee()},{data:x,refetch:F}=pt(),m=v([]);m.value=x.value,Ve(x,()=>{var S,p,d,O;m.value=x.value,((S=m==null?void 0:m.value)==null?void 0:S.length)>0?m.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1}):((d=(p=x==null?void 0:x.value)==null?void 0:p.pages[0])==null?void 0:d.length)>0?(m.value=(O=x==null?void 0:x.value)==null?void 0:O.pages[0],m.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})):m.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}]}),Ot(()=>{var S,p,d,O;if(F.value(),((S=m==null?void 0:m.value)==null?void 0:S.length)>0){if(!x.value){m.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}];return}m.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})}else if(((d=(p=x==null?void 0:x.value)==null?void 0:p.pages[0])==null?void 0:d.length)>0){if(!x.value){m.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}];return}m.value=(O=x==null?void 0:x.value)==null?void 0:O.pages[0],m.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})}else m.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}]});const h=v("");Ve(()=>Tt.global.locale.value,S=>{h.value=S,m.value[0]={isProduct:!1,name:u("all_categories"),sn:"",status:1}});const D=()=>{k.value=[],Q.keyword="",Q.categorySn="",V.totalPrice=0,g("closeDialog")},ye=S=>{var p,d;k.value=(p=k==null?void 0:k.value)==null?void 0:p.filter(function(O){return O.sn!==S.sn}),((d=k.value)==null?void 0:d.length)>0?ee():V.totalPrice=0},qe=S=>{var d;let p={bookingSn:S,addService:k.value};g("closeDialog"),((d=p==null?void 0:p.addService)==null?void 0:d.length)>0&&A.mutate(p,{onSuccess:O=>{(O==null?void 0:O.code)===1&&(C(),setTimeout(()=>{g("changeSuccess")},600))}})},be=()=>{var d,O;const S=(O=(d=JSON.parse(localStorage.getItem(Ut)||"{}"))==null?void 0:d.value)==null?void 0:O.fullName,p=v(Date.now());k.value.map(function(U){U.createTime=v(Number(me.formatDate(p.value,"X"))),U.createBy=S,U.sn=null,U.unitPrice=U.productPrice,U.totalPrice=U.productPrice*U.quantity}),g("addServices",k.value),B.notify({message:u("create_success"),position:"top",type:"positive",actions:[{color:"white"}]}),setTimeout(()=>{g("changeSuccess")},600)},je=S=>{var p;(p=s.value)==null||p.validate().then(d=>{if(d)P.isRoomView===!0?qe(S):be();else return!1})},ee=()=>{const S={service:[...k.value]};S.service.forEach(p=>{p.productSn=Number(p.sn),p.quantity=Number(p.quantity)}),S.service.length>0?q.mutate(S,{onSuccess:p=>{V.totalPrice=p.data.totalPrice?p.data.totalPrice:0,k.value=p.data.serviceList}}):k.value.importStock.totalPrice=0},ze=S=>{!S||ee()};return c({setupAddServiceDialog:j}),(S,p)=>(w(),J(Se,{modelValue:e($),"onUpdate:modelValue":p[3]||(p[3]=d=>ae($)?$.value=d:null),"full-width":"",onHide:D},{default:l(()=>[o(ke,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",_a,[z(a(e(u)("add_services"))+" ",1),P.isRoomView?(w(),E("span",va,"- "+a(f.value),1)):(w(),E("span",fa,"- "+a(P.roomName),1))]),o(Ue),Y(o(T,{dense:"",flat:"",icon:"close"},null,512),[[le]])]),_:1}),o(we,{ref_key:"addServicesRef",ref:s},{default:l(()=>[o(ce,{class:"q-pa-none q-py-md"},{default:l(()=>[t("div",ha,[t("div",ga,[o(he,{modelValue:e(Q).keyword,"onUpdate:modelValue":p[0]||(p[0]=d=>e(Q).keyword=d),outlined:"",dense:"",class:"col-5 rounded-borders q-ma-xs",debounce:"300",placeholder:e(u)("search_by_products_name")},{prepend:l(()=>[o(ve,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),t("div",ya,[o(_e,{ref:"country",modelValue:e(Q).categorySn,"onUpdate:modelValue":p[1]||(p[1]=d=>e(Q).categorySn=d),dense:"","emit-value":"",class:"q-pl-sm custom-select-category",options:m.value,filled:"","map-options":"","option-value":"sn","option-label":"name"},null,8,["modelValue","options"])])]),t("div",ba,[t("div",xa,[t("div",ka,[t("div",Sa,[t("div",wa,a(e(u)("product")),1)])]),qa,t("div",Va,[e(R)?(w(),E("div",Da,[o(Ht,{showing:e(R)},{default:l(()=>[t("div",Ca,[o(nt,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"])])):(w(),J(Yt,{key:1,bordered:"",padding:"",class:"style-scroll-product"},{default:l(()=>[(w(!0),E(Ae,null,Me(e(G),(d,O)=>(w(),J(Jt,{key:O,clickable:d.lastInventory>0,active:b.value===d.sn,class:"custom-list-section",onClick:U=>(b.value=d.sn,N(d))},{default:l(()=>[o(st,null,{default:l(()=>[t("div",Ra,[t("div",{class:Xe(["limit-text text-bold",d.lastInventory>0?"":"custom-disable"])},[z(a(d.productName)+" ",1),o(Qe,{anchor:"bottom middle",self:"top middle"},{default:l(()=>[t("div",$a,[z(a(d.productName)+" ",1),Pa,z(" "+a(e(u)("quantity"))+" : "+a(d.lastInventory),1)])]),_:2},1024)],2),t("div",null,[Y(o(ve,{name:"warning",color:"deep-orange-10",size:"1rem"},{default:l(()=>[o(Qe,{anchor:"bottom middle",self:"top middle"},{default:l(()=>[t("div",Ia,[t("b",null,a(e(u)("out_of_stock")),1)])]),_:1})]),_:2},1536),[[Fe,!(d.lastInventory>0)]])])])]),_:2},1024),o(st,null,{default:l(()=>[t("div",{class:Xe(["q-card__section text-bold text-right",d.lastInventory>0?"":"custom-disable"])},a(e(Z)(d.productPrice))+" VND ",3)]),_:2},1024)]),_:2},1032,["clickable","active","onClick"]))),128))]),_:1}))])]),t("div",Na,[t("div",Oa,[t("div",Ta,[t("div",Qa,a(e(u)("selected_products")),1)]),t("div",Fa,[t("div",Ma,[(w(!0),E(Ae,null,Me(k.value,(d,O)=>(w(),E("div",{key:O,class:"row justify-between"},[t("div",Aa,[t("div",Ua,[t("div",La,[t("div",Ea,[z(a(d.productName)+" ",1),o(Qe,null,{default:l(()=>[z(a(d.productName)+" ",1),Ba,z(" "+a(e(u)("quantity"))+" : "+a(d.lastInventory),1)]),_:2},1024)])])])]),t("div",ja,[o(he,{ref_for:!0,ref:"quantity",modelValue:d.quantity,"onUpdate:modelValue":[U=>d.quantity=U,U=>ze(d.quantity)],modelModifiers:{number:!0},class:"custom-input-readonly col-md-6 col-sm-12 col-xs-12",rules:[U=>U>0||e(u)("min_0"),U=>U<=d.lastInventory||"max <= "+d.lastInventory],type:"number"},null,8,["modelValue","onUpdate:modelValue","rules"]),t("div",za,a(e(Z)(d.total))+" VND ",1),o(T,{dense:"",round:"",flat:"",color:"grey",class:"q-mb-md",icon:"delete",onClick:U=>ye(d)},{default:l(()=>[o(Qe,null,{default:l(()=>[z(a(e(u)("delete")),1)]),_:1})]),_:2},1032,["onClick"])])]))),128))])])])])])]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[Ha,t("div",Ja,[t("div",Ya,[t("div",Ka,[t("p",Xa,a(e(u)("total_amount")),1)]),t("div",Ga,[t("p",null,a(e(Z)(e(V).totalPrice))+" VND",1)])]),o(T,{style:{width:"100%","border-radius":"12px"},class:"float-right",color:"negative",label:e(u)("add_to_the_booking"),rounded:"",icon:"add_circle",onClick:p[2]||(p[2]=d=>je(e(V).sn))},null,8,["label"])])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}});var Ps=Ce(Wa,[["__scopeId","data-v-21d09486"],["__file","D:/gopms-web/src/modules/booking/room-view/components/ChangeAddServiceDialog.vue"]]);function Is(){const n=v(null),c=v(null),g=v(null),P=v(null),C=v(null),V=v(null),B=v(null),b=se({reservationDialogVisible:!1,changeStayDateVisible:!1,checkOutDialogVisible:!1,reservationListDialogVisible:!1,cancelReservationVisible:!1,changeRoomVisible:!1,changeAddServiceVisible:!1});return{ui:b,reservationDialogRef:n,reservationListDialogRef:c,cancelReservationDialogRef:g,changeStayDateDialogRef:P,changeAddServiceDialogRef:C,changeRoomDialogRef:V,checkOutDialogRef:B,openChangeStayDate:(f,u,$,j,k,N)=>{var x;b.changeStayDateVisible=!0,(x=P.value)==null||x.setupChangeStayDateDialog(f,u,$,j,k,N)},openChangeAddService:(f,u)=>{var $;b.changeAddServiceVisible=!0,($=C.value)==null||$.setupAddServiceDialog(f,u)},openReservationListDialog:(f,u)=>{var $;b.reservationListDialogVisible=!0,($=c.value)==null||$.setupReservationListDialog(f,u)},openCancelReservationDialog:f=>{var u;b.cancelReservationVisible=!0,(u=g.value)==null||u.setupCancelReservationDialog(f)},openChangeRoomDialog:(f,u,$,j,k)=>{var N;b.changeRoomVisible=!0,(N=V.value)==null||N.setupChangeRoomDialog(f,u,$,j,k)},openReservationDialog:(f,u)=>{var $;b.reservationDialogVisible=!0,($=n.value)==null||$.setupReservationDialog(f,u)},openCheckOutDialog:f=>{var u;b.checkOutDialogVisible=!0,(u=B.value)==null||u.setupCheckOutDialog(f)}}}function Ns(){const n=Qt(),c=v(""),g=v(null);c.value=n.params.sn||"";const P=v(!1),C=v({bookingNo:"",bookingSourceSn:null,bookingStatusSn:null,bookingTypeSn:null,checkIn:"",checkInActual:"",checkOut:"",checkOutActual:"",note:"",pricingPlanName:"",roomTypeSn:null,pricingPlanSn:null,roomName:"",roomPrice:null,roomSn:null,roomTypeCode:"",sn:null,guest:[],roomStatusSn:null}),V=v({amountRoomPrice:0,amountDeposit:0,balance:0,discount:0,earlyCheckIn:"",servicesPrice:0,extraFee:0,lateCheckOut:"",paid:0,roomPrice:"",total:0,amountEarlyCheckIn:0,amountLateCheckOut:0,depositMethodSn:0,paymentMethodSn:0}),B=v([]),{data:b,isFetching:s,refetch:Q}=mt(c,g,{enabled:!!n.params.sn});return Ft(()=>{var A,q,G,R;b!=null&&b.value&&(P.value=(A=b.value)==null?void 0:A.isDisplayEarlyCheckIn,V.value=(q=b.value)==null?void 0:q.payment,C.value=(G=b==null?void 0:b.value)==null?void 0:G.roomInformation,B.value=(R=b==null?void 0:b.value)==null?void 0:R.service)}),{bookingDetailsFetching:s,refetchBookingDetails:Q,formRoomInfo:C,formPayment:V,serviceInfo:B,isDisplayEarlyCheckIn:P}}const Za=async n=>{if(!n.bookingSn)return!1;const{data:c}=await te.post("reservation/checkInReservation",n);return c},Os=()=>ge(Za);export{Rs as C,Ns as a,Is as b,$s as c,Cs as d,Ds as e,Ps as f,Os as u};
