import{Q as I}from"./QSelect.8edab530.js";import{Q as A}from"./QDate.804040fd.js";import{Q as M}from"./QPopupProxy.9996c4ad.js";import{av as P,_ as U,r as _,C as B,a as S,w as V,K as Q,F as h,L as O,M as n,I as d,R as m,N as a,G as N,U as T,T as q,bo as C,aF as g}from"./index.7efcbe86.js";import{a as X}from"./QMenu.b19dfcca.js";import{Q as K}from"./QInnerLoading.5fef3982.js";import{a as L,c as b,Q as Y}from"./QTable.4cc8e1c9.js";import{Q as j}from"./QPagination.a48c1bef.js";import{u as z}from"./useI18n.6b7b36de.js";import{u as J}from"./useAppendixQuery.039c05de.js";import{b as G,e as x,c as H,d as W}from"./axiosClient.a0ee23b9.js";import{Q as Z}from"./queryKeys.832af9fa.js";import{a as $,f as ee}from"./useFormat.349e799c.js";import{d as i}from"./date.2d51ed98.js";import"./selection.6afffe69.js";import"./QItemLabel.938a9258.js";import"./rtl.4b414a6d.js";import"./use-cache.b0833c75.js";import"./position-engine.4a23d733.js";import"./QList.e5651779.js";const oe=async({queryKey:r})=>{const[,o]=r;if((o==null?void 0:o.startDate)&&(o==null?void 0:o.endDate)){const{data:u}=await G.get("/report/getDebtSummaryList",{params:o});return u.data}},te=(r,o)=>{const u=[Z.DEBT_SUMMARY_REPORT,r];return P(u,oe,{enabled:o,select:e=>e})};const ae={setup(){const{t:r,locale:o}=z(),{data:u,isFetching:e}=J({enabled:!0}),D=_(Date.now()),s=B({page:1,limit:10,bookingSourceSn:null,startDate:Number(i.formatDate(D.value,"X")),endDate:Number(i.formatDate(D.value,"X"))}),{data:y,isFetching:w}=te(s,!0),l=_(null),f=_(0),t=()=>{l==null||l.value.show()},p=S({get:()=>({from:s.startDate?i.formatDate(new Date(s.startDate*1e3),x):"",to:s.endDate?i.formatDate(new Date(s.endDate*1e3),x):""}),set:c=>{f.value=0,c?(s.startDate=Number(i.formatDate(new Date(c.from),"X"))||Number(i.formatDate(new Date(c),"X")),s.endDate=Number(i.formatDate(new Date(c.to),"X"))||Number(i.formatDate(new Date(c),"X"))):s.startDate=s.endDate=null,k()}}),R=S(()=>[{name:"no",label:r("no"),align:"left",field:""},{name:"bookingSourceName",label:r("booking_sources"),align:"left",field:"bookingSourceName"},{name:"debtStarting",align:"right",label:r("debt_starting_balance"),field:"debtStarting"},{name:"debtPeriod",align:"right",label:r("debt_in_the_period"),field:"debtPeriod"},{name:"debtEnd",align:"right",label:r("debt_end_balance"),field:"debtEnd"}]),k=()=>{s.page=1},v=_([]);V(e,()=>{F()});const F=()=>{v.value.push({name:r("all_booking_sources"),sn:null},...JSON.parse(JSON.stringify(u.value)))},E=_("");return V(()=>o.value,c=>{E.value=c,v.value[0]={name:r("all_booking_sources"),sn:null}}),{t:r,columns:R,data:y,isFetching:w,formatIndexTable:$,dateRangeType:f,onOpenDatePopUp:t,qDateRef:l,dateRange:p,formValues:s,useBookingSourcesFetching:e,FORMAT_DATE_TIME_UI:H,FORMAT_DATE_UI:W,date:i,onApply:k,arrayBookingSources:v,formatMoney:ee}}},ne={class:"row q-mb-md"},re={class:"text-h5 text-bold"},se={class:"row q-mb-md q-gutter-md"},le={style:{"min-width":"16%"}},ie={style:{"min-width":"16%"}},de={key:0,class:"self-center full-width no-outline",tabindex:"0"},me={class:"relative-position"},ce={lass:"full-width","full-height":"",class:"q-mt-md row justify-center"},ue={key:0},fe={class:"q-mt-md row justify-end"};function _e(r,o,u,e,D,s){const y=Q("router-link"),w=Q("pms-sections");return h(),O(w,null,{header:n(()=>[d("div",ne,[d("div",re,m(e.t("debt_summary_report")),1)]),d("div",se,[d("div",le,[a(I,{modelValue:e.formValues.bookingSourceSn,"onUpdate:modelValue":[o[0]||(o[0]=l=>e.formValues.bookingSourceSn=l),o[1]||(o[1]=l=>e.onApply())],loading:e.useBookingSourcesFetching,filled:"",dense:"",options:e.arrayBookingSources,"option-value":"sn","option-label":"name","map-options":"","emit-value":""},null,8,["modelValue","loading","options"])]),d("div",ie,[a(X,{placeholder:e.t("select_date_time"),dense:"","stack-label":"",filled:"",onFocus:e.onOpenDatePopUp},{control:n(()=>[e.dateRange.from&&e.dateRange.to?(h(),N("div",de,m(e.date.formatDate(e.dateRange.from,e.FORMAT_DATE_UI))+" - "+m(e.date.formatDate(e.dateRange.to,e.FORMAT_DATE_UI)),1)):T("v-if",!0)]),prepend:n(()=>[a(q,{name:"event",class:"no-pointer-events"},{default:n(()=>[a(M,{ref:"qDateRef","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[a(A,{modelValue:e.dateRange,"onUpdate:modelValue":o[2]||(o[2]=l=>e.dateRange=l),range:""},null,8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["placeholder","onFocus"])])])]),default:n(()=>{var l,f;return[d("div",me,[a(K,{showing:e.isFetching,label:"Please","label-class":"text-teal","label-style":"font-size:1.1em"},{default:n(()=>[d("div",ce,[a(C,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"]),e.isFetching?T("v-if",!0):(h(),N("div",ue,[a(Y,{"rows-per-page-options":[0],rows:(l=e.data)==null?void 0:l.debtSummaryList,columns:e.columns,"hide-pagination":"","hide-bottom":"","row-key":"no"},{body:n(t=>[a(L,{props:t},{default:n(()=>[a(b,{key:"no",props:t},{default:n(()=>[g(m(e.formatIndexTable(e.formValues.page,t.rowIndex)),1)]),_:2},1032,["props"]),a(b,{key:"bookingSourceName",props:t},{default:n(()=>{var p;return[a(y,{style:{"text-decoration":"none"},class:"custom-link text-negative",to:{name:"debt-detail-report",params:{sn:(p=t.row)==null?void 0:p.bookingSourceSn},query:e.formValues}},{default:n(()=>[g(m(t.row.bookingSourceName),1)]),_:2},1032,["to"])]}),_:2},1032,["props"]),a(b,{key:"debtStarting",props:t},{default:n(()=>[g(m(e.formatMoney(t.row.debtStarting))+" VND ",1)]),_:2},1032,["props"]),a(b,{key:"debtPeriod",props:t},{default:n(()=>[g(m(e.formatMoney(t.row.debtPeriod))+" VND ",1)]),_:2},1032,["props"]),a(b,{key:"debtEnd",props:t},{default:n(()=>[g(m(e.formatMoney(t.row.debtEnd))+" VND ",1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),d("div",fe,[a(j,{modelValue:e.formValues.page,"onUpdate:modelValue":o[3]||(o[3]=t=>e.formValues.page=t),color:"negative",max:((f=e.data)==null?void 0:f.meta.lastPage)||1,"max-pages":5,"boundary-numbers":"","direction-links":"",push:""},null,8,["modelValue","max"])])]))])]}),_:1})}var Me=U(ae,[["render",_e],["__scopeId","data-v-73243be9"],["__file","D:/gopms-web/src/modules/report/debt-summary-report/view.vue"]]);export{Me as default};
