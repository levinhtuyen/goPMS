var Le=Object.defineProperty;var me=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var fe=(e,t,o)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,X=(e,t)=>{for(var o in t||(t={}))Ve.call(t,o)&&fe(e,o,t[o]);if(me)for(var o of me(t))De.call(t,o)&&fe(e,o,t[o]);return e};import{Q as _e,a as M}from"./selection.cdf30163.js";import{c as Pe,a as j,b as Me,t as je,bN as Be,bO as Ae,r as V,w as Ke,P as s,n as ze,aF as re,bj as ie,_ as ke,J as Se,bz as Fe,F as p,G as k,I as n,L as S,O as h,bB as O,aM as R,aI as Ee,R as y,N as f,T as Z,q as pe,W as se,V as le,aO as x,M as m,U as B,bP as A,i as Ue,p as We,K as ve,Q as ee,aS as Ye,aT as Ge}from"./index.4bd8ab7e.js";import{Q as He}from"./QToolbarTitle.dfdc5985.js";import{Q as L}from"./QTooltip.a00a2acf.js";import{Q as he}from"./QItemLabel.0748896a.js";import{Q as Je}from"./QList.550b5ccf.js";import{u as $e}from"./useI18n.96209f4d.js";import{u as Qe}from"./useNotify.6f32b3a1.js";import{b as ce,u as Re}from"./axiosClient.ad61c203.js";import{Q as I}from"./queryKeys.832af9fa.js";import{u as Oe}from"./useRoomTypeFloorInfoQuery.36bc7af8.js";import{u as Xe}from"./useRoomTypeListQuery.6ae8a4aa.js";import{C as ye}from"./ClosePopup.34597da2.js";import{u as Ze}from"./use-quasar.fa06306f.js";import"./position-engine.e365a736.js";const et=["top","middle","bottom"];var ge=Pe({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>et.includes(e)}},setup(e,{slots:t}){const o=j(()=>e.align!==void 0?{verticalAlign:e.align}:null),r=j(()=>{const l=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(l!==void 0?` text-${l}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>Me("div",{class:r.value,style:o.value,role:"alert","aria-label":e.label},e.label!==void 0?e.label:je(t.default))}});function tt(e){return Be()?(Ae(e),!0):!1}const D=typeof window!="undefined",ot=e=>typeof e=="string",te=()=>{};function oe(e){var t;const o=s(e);return(t=o==null?void 0:o.$el)!=null?t:o}const Ie=D?window:void 0;D&&window.document;D&&window.navigator;D&&window.location;function we(...e){let t,o,r,l;if(ot(e[0])?([o,r,l]=e,t=Ie):[t,o,r,l]=e,!t)return te;let v=te;const q=Ke(()=>s(t),i=>{v(),i&&(i.addEventListener(o,r,l),v=()=>{i.removeEventListener(o,r,l),v=te})},{immediate:!0,flush:"post"}),_=()=>{q(),v()};return tt(_),_}function st(e,t,o={}){const{window:r=Ie,ignore:l}=o;if(!r)return;const v=V(!0),_=[we(r,"click",g=>{const w=oe(e),C=g.composedPath();!w||w===g.target||C.includes(w)||!v.value||l&&l.length>0&&l.some(b=>{const F=oe(b);return F&&(g.target===F||C.includes(F))})||t(g)},{passive:!0,capture:!0}),we(r,"pointerdown",g=>{const w=oe(e);v.value=!!w&&!g.composedPath().includes(w)},{passive:!0})];return()=>_.forEach(g=>g())}const ne=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ae="__vueuse_ssr_handlers__";ne[ae]=ne[ae]||{};ne[ae];var be,xe;D&&(window==null?void 0:window.navigator)&&((be=window==null?void 0:window.navigator)==null?void 0:be.platform)&&/iP(ad|hone|od)/.test((xe=window==null?void 0:window.navigator)==null?void 0:xe.platform);var lt=Object.defineProperty,qe=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,Ce=(e,t,o)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,rt=(e,t)=>{for(var o in t||(t={}))nt.call(t,o)&&Ce(e,o,t[o]);if(qe)for(var o of qe(t))at.call(t,o)&&Ce(e,o,t[o]);return e};const it={top:0,left:0,bottom:0,right:0,height:0,width:0};rt({text:""},it);const Ne=e=>{const t=V(!1),o=V(null),r=async()=>{var v;t.value=!0,await ze(),(v=o.value)==null||v.focus()},l=()=>{t.value=!1,e==null||e.onFinishEdit()};return st(o,()=>l()),{inputElementRef:o,isEditMode:t,startEdit:r,finishEdit:l}},ct=async e=>{const{data:t}=await ce.post("/configuration/room/createFloor",e);return t},dt=()=>{const e=ie(),t=(o,r)=>{const l=e.getQueryData(I.FLOORS);!l||e.setQueryData(I.FLOORS,()=>!l||!o?l:[...l,{sn:o.sn,name:r.name,roomList:[]}])};return re(ct,{onSuccess:(o,r)=>{t(o,r)}})},ut=async e=>{await ce.post("/configuration/room/deleteFloor",e)},mt=()=>{const e=ie();return re(ut,{onSuccess:(t,o)=>{const r=e.getQueryData(I.FLOORS);!r||e.setQueryData(I.FLOORS,()=>r.filter(l=>l.sn!==o.sn))}})},ft=async e=>{const{data:t}=await ce.post("/configuration/room/updateFloor",e);return t},_t=()=>{const e=ie();return re(ft,{onSuccess:(t,o)=>{const r=e.getQueryData(I.FLOORS);!r||e.setQueryData(I.FLOORS,()=>r.map(l=>l.sn!==o.sn?l:X(X({},l),o)))}})};const pt={class:"q-pl-md"},vt={class:"q-table__grid-item col-12"},ht={class:"block-floor"},yt={class:"row"},gt={class:"col-11"},wt={class:"cursor-pointer q-px-sm q-py-md"},bt={key:1},xt={class:"is-floor-name"},qt={class:"row"},Ct=["onClick"],kt={class:"is-code color-text-block row justify-center"},St={class:"q-mb-none full-height limit-text"},Ft={class:"is-name color-text-block row justify-center"},Et={class:"full-height limit-text"},$t={class:"col-lg-2 col-xl-2 col-md-3 col-sm-3 col-xs-12 q-pa-sm"},Qt={class:"block-code"},Rt={class:"q-mb-none full-height color-text-add-block"},Ot={class:"block-name"},It={class:"full-height color-text-add-block"},Nt=Se({props:{floorName:{type:String,required:!0},floorSn:{type:Number,required:!0},rooms:{type:Array,required:!0}},setup(e){const t=e,{hasPermission:o}=Re(),{data:r}=Oe(),{notifySaveSuccess:l,notifySaveFailed:v}=Qe(),q=Ze(),_=Fe(),{t:i}=$e(),g=j(()=>{const{code:a}=_.query;return!a||Array.isArray(a)?t.rooms:t.rooms.filter(({roomTypeCode:d})=>d===a.replaceAll("_"," "))}),w=_t(),C=mt(),b=V(t.floorName),{inputElementRef:F,isEditMode:P,startEdit:K,finishEdit:$}=Ne({onFinishEdit:()=>b.value=t.floorName}),z=[a=>!!a.trim()||i("this_is_invalid_value"),a=>a.trim().length<=10||i("the_length_is_from_1_to_10_characters"),a=>{var d;return!((d=r.value)!=null&&d.some(({name:u,sn:E})=>t.floorSn!==E&&u.toLowerCase()===a.trim().toLowerCase()))||i("this_is_invalid_value")}],U=async a=>{var E;if(!((E=F.value)==null?void 0:E.validate()))return;const{value:u}=a.currentTarget;w.mutate({sn:t.floorSn,name:u.trim()},{onSuccess:()=>{l(),$()},onError:()=>{v()}})},W=()=>{if(t.rooms.length!==0){q.notify({message:i("please_remove_all_rooms_of_this_floor"),position:"top",type:"negative",color:"red-1",textColor:"negative"});return}q.dialog({message:i("are_you_sure_you_want_to_delete_this_floor"),cancel:{color:"grey-8",label:i("cancel"),noCaps:!0,dense:!0,outline:!0},ok:{color:"negative",label:i("confirm"),dense:!0,noCaps:!0},persistent:!0}).onOk(()=>{C.mutate({sn:t.floorSn},{onSuccess:()=>{l()},onError:()=>{v()}})})},Y=a=>{o("add-edit-room")!==!1&&A.replace({path:`/settings/room-settings/rooms/${a.sn}`,state:{roomName:a.name,floorId:t.floorSn},query:_.query})},G=()=>{A.replace({path:"/settings/room-settings/rooms/new",state:{roomName:null,floorId:t.floorSn},query:_.query})};return(a,d)=>(p(),k("div",pt,[n("div",vt,[n("div",ht,[n("div",yt,[n("div",gt,[n("div",wt,[s(P)?(p(),S(Ee,{key:0,ref_key:"inputElementRef",ref:F,modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=u=>b.value=u),class:h([s(o)("add-edit-delete-floor")===!1?"hidden":"","is-floor-name"]),rules:z,placeholder:s(i)("input_floor_name"),borderless:"",dense:"",onKeydown:[O(R(U,["prevent"]),["enter"]),O(R(s($),["prevent"]),["esc"]),O(R(s($),["prevent"]),["tab"])]},null,8,["modelValue","class","placeholder","onKeydown"])):(p(),k("div",bt,[n("span",xt,y(t.floorName),1),f(Z,{class:h(["q-px-sm q-pb-sm",s(o)("add-edit-delete-floor")===!1?"hidden":""]),name:"create",size:"sm",onClick:s(K)},null,8,["class","onClick"])]))])]),pe((p(),k("div",{class:h(["col-1 justify-end flex items-center cursor-pointer",s(o)("add-edit-delete-floor")===!1?"hidden":""]),clickable:"",onClick:W},[f(Z,{class:"float-right q-mb-sm",name:"delete",size:"sm"})],2)),[[ye]])]),n("div",qt,[(p(!0),k(se,null,le(s(g),(u,E)=>(p(),k("div",{key:E,class:"col-lg-2 col-xl-2 col-md-3 col-sm-3 col-xs-12 cursor-pointer q-pa-sm"},[n("div",{class:"item-floor row justify-center full-width full-height items-center",onClick:H=>s(o)("add-edit-room")===!1?"":Y(u)},[n("div",kt,[n("p",St,[x(y(u.name)+" ",1),u.name?(p(),S(L,{key:0},{default:m(()=>[x(y(u.name),1)]),_:2},1024)):B("v-if",!0)])]),n("div",Ft,[n("p",Et,[x(y(u.roomTypeCode)+" ",1),u.roomTypeCode?(p(),S(L,{key:0},{default:m(()=>[x(y(u.roomTypeCode),1)]),_:2},1024)):B("v-if",!0)])])],8,Ct)]))),128)),n("div",$t,[pe((p(),k("div",{class:h(["item-add-floor row justify-center full-width full-height items-center cursor-pointer",s(o)("add-edit-room")===!1?"hidden":""]),clickable:"",onClick:G},[n("div",Qt,[n("p",Rt,y(s(i)("new_room")),1)]),n("div",Ot,[n("p",It,[f(Z,{name:"add",size:"sm"})])])],2)),[[ye]])])])])])]))}});var Tt=ke(Nt,[["__scopeId","data-v-0c002024"],["__file","D:/project_learn/goPMS/src/modules/room-settings/components/floor.vue"]]);const Te=e=>(Ye("data-v-29b91f26"),e=e(),Ge(),e),Lt={class:"row"},Vt={class:"col-12"},Dt={class:"custom-title-room"},Pt={class:"col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12"},Mt={style:{"margin-top":"-12px"}},jt={class:"col-xl-9 col-lg-9 col-md-9 col-sm-12 col-xs-12"},Bt={class:"q-pl-md"},At={class:"q-table__grid-item col-12"},Kt={key:0,class:"custom-input-add-floor full-width justify-center items-center"},zt=Te(()=>n("div",{class:"q-px-sm"},null,-1)),Ut=Te(()=>n("div",null,null,-1)),Wt=Se({setup(e){const{data:t,refetch:o}=Xe();let{data:r,refetch:l}=Oe();const v=dt(),q=Ue("emitter");We(()=>{q.on("addRoomType",async()=>{o.value()}),q.on("changeHotelInfo",async()=>{o.value()}),q.on("refetchListRoomSetting",async()=>{l.value()}),t.value&&o.value()});const _=Fe(),{t:i}=$e(),{notifySaveSuccess:g,notifySaveFailed:w}=Qe(),{hasPermission:C}=Re(),b=V(""),F=[a=>!!a.trim()||i("this_field_is_required"),a=>a.trim().length<=10||i("the_length_is_from_1_to_10_characters"),a=>{var d;return!((d=r.value)!=null&&d.some(({name:u})=>u===a.trim()))||i("this_is_invalid_value")}],{inputElementRef:P,isEditMode:K,finishEdit:$,startEdit:z}=Ne({onFinishEdit:()=>b.value=""}),U=j(()=>{var d;let a=0;return(d=t.value)==null||d.forEach(({numOfRoom:u})=>a+=u),a}),W=async()=>{var d;!((d=P.value)!=null&&d.validate())||v.mutate({name:b.value.trim()},{onSuccess:()=>{g(),$(),l.value()},onError:()=>{w()}})},Y=()=>{A.replace({path:"/settings/room-settings/room-types/new",query:_.query,state:{code:null}})},G=(a,d)=>{A.replace({path:`/settings/room-settings/room-types/${a}`,query:_.query,state:{code:d}})};return(a,d)=>{const u=ve("router-view"),E=ve("pms-sections");return p(),S(E,null,{default:m(()=>{var H;return[n("div",Lt,[n("div",Vt,[n("p",Dt,y(s(i)("room_configuration")),1)]),n("div",Pt,[f(Je,{separator:"",class:"room-types-list border-all-top",style:{border:"1px solid #dee2e6",margin:"0 -1px"}},{default:m(()=>[f(_e,{to:"/settings/room-settings",replace:"",class:h(["text-white border-all-top q-py-sm",[s(_).query.code?"item-no-active":" item-active"]])},{default:m(()=>[f(He,{class:"row justify-center no-padding text-weight-bold"},{default:m(()=>[f(M,{class:h([s(_).query.code?"text-black":"text-white"])},{default:m(()=>[x(y(s(i)("all")),1)]),_:1},8,["class"]),f(M,{side:""},{default:m(()=>[f(ge,{class:h(["custom-p-badge",[s(_).query.code?"item-active":"item-no-active"]]),label:s(U),rounded:""},null,8,["class","label"])]),_:1})]),_:1})]),_:1},8,["class"]),(p(!0),k(se,null,le(s(t),({numOfRoom:Q,code:c,name:N,sn:de})=>{var ue;return p(),S(_e,{key:de,style:{"min-height":"60px"},to:`/settings/room-settings?code=${c==null?void 0:c.replaceAll(" ","_")}`,replace:"",class:h([((ue=s(_).query)==null?void 0:ue.code)===(c==null?void 0:c.replaceAll(" ","_"))?"item-active":" item-no-active"])},{default:m(()=>[f(M,null,{default:m(()=>{var T;return[f(he,{class:h(["limit-text style-code",[((T=s(_).query)==null?void 0:T.code)===(c==null?void 0:c.replaceAll(" ","_"))?"text-white":"text-black"]])},{default:m(()=>[x(y(c)+" ",1),c?(p(),S(L,{key:0},{default:m(()=>[x(y(c),1)]),_:2},1024)):B("v-if",!0)]),_:2},1032,["class"]),f(he,{caption:""},{default:m(()=>{var J;return[n("div",{class:h(["limit-text style-name",[((J=s(_).query)==null?void 0:J.code)===(c==null?void 0:c.replaceAll(" ","_"))?"text-white":"text-black"]])},[x(y(N)+" ",1),N?(p(),S(L,{key:0},{default:m(()=>[x(y(N),1)]),_:2},1024)):B("v-if",!0)],2)]}),_:2},1024)]}),_:2},1024),f(M,{side:"",class:h(s(C)("add-edit-room-type")===!1?"hidden":"")},{default:m(()=>{var T;return[n("div",Mt,[f(ee,{icon:"create",flat:"",round:"",onClick:R(J=>G(de,c),["prevent"])},{default:m(()=>[f(L,null,{default:m(()=>[x(y(s(i)("edit_room_type")),1)]),_:1})]),_:2},1032,["onClick"]),f(ge,{class:h(["custom-p-badge",[((T=s(_).query)==null?void 0:T.code)===(c==null?void 0:c.replaceAll(" ","_"))?"q-badge-active":"q-badge-no-active"]]),label:Q,rounded:""},null,8,["class","label"])])]}),_:2},1032,["class"])]),_:2},1032,["to","class"])}),128))]),_:1}),n("div",null,[f(ee,{style:{width:"100%"},class:h([s(C)("add-edit-room-type")===!1?"hidden":"","q-my-md text-weight-bold custom-btn-add-room-type custom-block-add-room-type"]),label:s(i)("new_room_type"),icon:"add_circle",onClick:Y},null,8,["class","label"])])]),n("div",jt,[(p(!0),k(se,null,le((H=s(r))==null?void 0:H.slice().sort((Q,c)=>Q.name.localeCompare(c.name)),({name:Q,sn:c,roomList:N})=>(p(),S(Tt,{key:c,"floor-name":Q,"floor-sn":c,rooms:N},null,8,["floor-name","floor-sn","rooms"]))),128)),n("div",Bt,[n("div",At,[s(K)?(p(),k("div",Kt,[f(Ee,{ref_key:"inputElementRef",ref:P,modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=Q=>b.value=Q),class:h(s(C)("add-edit-delete-floor")===!1?"hidden":""),borderless:"",color:"none",style:{"font-size":"22px"},rules:F,placeholder:s(i)("input_floor_name"),maxlength:"10",onKeydown:[O(R(W,["prevent"]),["enter"]),O(R(s($),["prevent"]),["esc"]),O(R(s($),["prevent"]),["tab"])]},{prepend:m(()=>[zt]),append:m(()=>[Ut]),_:1},8,["modelValue","class","placeholder","onKeydown"])])):(p(),S(ee,{key:1,class:h([s(C)("add-edit-delete-floor")===!1?"hidden":"","custom-block-add-floor full-width q-py-md"]),label:s(i)("new_floor"),icon:"add_circle",onClick:s(z)},null,8,["class","label","onClick"]))])]),f(u)])])]}),_:1})}}});var uo=ke(Wt,[["__scopeId","data-v-29b91f26"],["__file","D:/project_learn/goPMS/src/modules/room-settings/views/index.vue"]]);export{uo as default};
