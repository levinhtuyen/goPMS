var Vt=Object.defineProperty,Dt=Object.defineProperties;var Ct=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var Rt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Ze=(n,r,f)=>r in n?Vt(n,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):n[r]=f,se=(n,r)=>{for(var f in r||(r={}))Rt.call(r,f)&&Ze(n,f,r[f]);if(We)for(var f of We(r))$t.call(r,f)&&Ze(n,f,r[f]);return n},et=(n,r)=>Dt(n,Ct(r));import{Q as Ue}from"./QSpace.196a214e.js";import{aF as ge,_ as Ce,J as Re,r as g,C as le,a as Y,F as q,L as j,M as l,N as o,I as t,R as a,P as e,q as z,Q,am as ce,aH as ne,aQ as oe,T as ve,O as Ke,aN as $e,aO as E,aP as be,aR as xe,bz as nt,aE as Pe,bI as Pt,w as Ve,aD as It,G as U,bq as it,V as Fe,W as Ae,U as ct,aI as he,aM as Nt,aS as ut,aT as rt,an as Me,bj as dt,p as Ot,aC as Tt,bA as Qt}from"./index.4bd8ab7e.js";import{Q as Le}from"./QBar.f39aa7c3.js";import{Q as tt}from"./QDate.20311372.js";import{Q as Te}from"./QPopupProxy.0d4ba934.js";import{Q as ot}from"./QTime.12b67e2f.js";import{a as De}from"./QMenu.d60d439b.js";import{Q as Se}from"./QForm.8a0c543d.js";import{C as ee}from"./ClosePopup.34597da2.js";import{u as Ie}from"./useNotify.6f32b3a1.js";import{c as Mt}from"./useCreateDate.f74931c4.js";import{b as lt}from"./useValidate.94ac08ef.js";import{d as pe}from"./date.525ad423.js";import{b as G,c as ue,F as ye,L as Ft}from"./axiosClient.ad61c203.js";import{u as Ne}from"./useI18n.96209f4d.js";import{Q as _e}from"./QSelect.2521a28c.js";import{Q as At,a as at,c as fe,b as Ut}from"./QTable.87be80e4.js";import{f as K,a as Lt,c as Je}from"./useFormat.349e799c.js";import{u as mt}from"./use-quasar.fa06306f.js";import{u as Et}from"./useAppendixQuery.627eefb9.js";import{Q as re}from"./queryKeys.832af9fa.js";import{u as Bt}from"./useCalculateBookingAmountMutation.f3b5a254.js";import{Q as jt}from"./QInnerLoading.36fa411b.js";import{Q as Qe}from"./QTooltip.a00a2acf.js";import{Q as zt,a as st}from"./selection.cdf30163.js";import{Q as Ht}from"./QList.550b5ccf.js";const Yt=async n=>{if(!n.sn)return!1;const{data:r}=await G.post("reservation/updateStayDate",n);return r},Jt=()=>ge(Yt,{});const Kt={class:"text-h5 text-bold"},Xt={class:"row items-center justify-between q-mt-md"},Gt={class:"text-bold text-body1"},Wt={class:"text-bold text-body1"},Zt={class:"col"},eo={class:"q-mb-xs"},to={class:"row items-center justify-end"},oo={class:"self-center full-width no-outline",tabindex:"0"},lo={class:"row items-center justify-end"},ao={class:"col"},so={class:"q-mb-xs"},no={class:"row items-center justify-end"},io={class:"self-center full-width no-outline",tabindex:"0"},co={class:"row items-center justify-end"},uo=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","changeSuccess"],setup(n,{expose:r,emit:f}){const $=n,{t:C}=Ne(),V=g(null),{notifyUpdateSuccess:L}=Ie(),x=Jt(),s=g(""),M=g(""),A=g(),{formatDate:k,subtractFromDate:X}=pe,R=le({sn:null,checkIn:Date.now()/1e3,checkOut:Date.now()/1e3}),B=Y({get(){return $.modelValue},set(v){f("update:modelValue",v)}}),m=Y({get:()=>k(new Date(R.checkIn*1e3),ye),set:v=>{R.checkIn=Number(k(new Date(v),"X"))}}),u=Y({get:()=>k(new Date(R.checkOut*1e3),ye),set:v=>{R.checkOut=Number(k(new Date(v),"X"))}}),N=Y(()=>{const v=nt();return(v.name==="BookingDetails"||v.name==="RoomView")&&V.value===3||(v.name==="BookingDetails"||v.name==="RoomView")&&V.value===5?!0:(v.name==="BookingDetails"||v.name==="RoomView")&&V.value===6}),W=v=>new Date(v)>=X(new Date,{day:1}),D=v=>{const i=m.value?Mt(k(m.value,ue)):"";return i&&i.setHours(0,0,0),i?new Date(v)>=i:new Date(v)>=new Date},O=()=>{var v;(v=A.value)==null||v.validate().then(i=>{if(i)x.mutate({sn:R.sn,checkIn:R.checkIn,checkOut:R.checkOut},{onSuccess:P=>{P&&(L(),f("changeSuccess"))}});else return!1})};return r({setupChangeStayDateDialog:async(v,i,P,ke,de,we)=>{R.sn=v,s.value=P,M.value=i,R.checkIn=ke,R.checkOut=de,V.value=we}}),(v,i)=>(q(),j(xe,{modelValue:e(B),"onUpdate:modelValue":i[6]||(i[6]=P=>oe(B)?B.value=P:null)},{default:l(()=>[o(be,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",Kt,a(e(C)("change_stay_date")),1),o(Ue),z(o(Q,{dense:"",flat:"",icon:"close"},null,512),[[ee]])]),_:1}),o(ce),t("div",Xt,[t("p",Gt,a(M.value),1),t("p",Wt,a(s.value),1)]),o(ne,{class:"q-pa-none q-py-md"},{default:l(()=>[o(Se,{ref_key:"changeStayDateFomRef",ref:A,class:"q-gutter-md"},{default:l(()=>[t("div",Zt,[t("p",eo,a(e(C)("arrival_date_time"))+"*",1),o(De,{modelValue:e(m),"onUpdate:modelValue":i[2]||(i[2]=P=>oe(m)?m.value=P:null),placeholder:e(C)("select_date_time"),filled:"",dense:"",class:"custom-input-readonly",debounce:"500",rules:[P=>!!P||"Please input Arrival date time",()=>e(lt)(e(k)(new Date,"DD/MM/YYYY HH:mm"),e(k)(e(m),e(ue)))||e(C)("the_time_must_be_greater_than_current_time")],"bg-color":e(N)?"grey-5":"",readonly:e(N),disable:e(N)},{prepend:l(()=>[o(ve,{name:"event",class:Ke(e(N)?"":"cursor-pointer")},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(tt,{modelValue:e(m),"onUpdate:modelValue":i[0]||(i[0]=P=>oe(m)?m.value=P:null),mask:e(ye),options:W},{default:l(()=>[t("div",to,[z(o(Q,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1},8,["class"])]),control:l(()=>[t("div",oo,a(e(k)(e(m),e(ue))),1)]),append:l(()=>[o(ve,{name:"access_time",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(ot,{modelValue:e(m),"onUpdate:modelValue":i[1]||(i[1]=P=>oe(m)?m.value=P:null),mask:e(ye),format24h:""},{default:l(()=>[t("div",lo,[z(o(Q,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder","rules","bg-color","readonly","disable"])]),t("div",ao,[t("p",so,a(e(C)("departure_date_time"))+"*",1),o(De,{modelValue:e(u),"onUpdate:modelValue":i[5]||(i[5]=P=>oe(u)?u.value=P:null),placeholder:"Select date time",filled:"",dense:"",debounce:"500",rules:[P=>!!P||"Please input Departure date time",P=>e(lt)(e(k)(e(m),e(ue)),e(k)(e(u),e(ue)))||e(C)("the_time_must_be_greater_than_arrival_date_time")]},{prepend:l(()=>[o(ve,{name:"event",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(tt,{modelValue:e(u),"onUpdate:modelValue":i[3]||(i[3]=P=>oe(u)?u.value=P:null),mask:e(ye),options:D},{default:l(()=>[t("div",no,[z(o(Q,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),control:l(()=>[t("div",io,a(e(k)(e(u),e(ue))),1)]),append:l(()=>[o(ve,{name:"access_time",class:"cursor-pointer"},{default:l(()=>[o(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(ot,{modelValue:e(u),"onUpdate:modelValue":i[4]||(i[4]=P=>oe(u)?u.value=P:null),mask:e(ye),format24h:""},{default:l(()=>[t("div",co,[z(o(Q,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[z((q(),j(Q,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[E(a(e(C)("cancel")),1)]),_:1})),[[ee]]),o(Q,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:O},{default:l(()=>[E(a(e(C)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var qs=Ce(uo,[["__scopeId","data-v-893a37ce"],["__file","D:/project_learn/goPMS/src/modules/booking/room-view/components/ChangeStayDateDialog.vue"]]);const ro=async n=>{if(n.keyword||n.categorySn){const{data:r}=await G.get("/inventory/extraProperty/getProductAvailableList",{params:{keyword:n.keyword,categorySn:n.categorySn}});return r.data}return!1},mo=n=>Pe([re.PRODUCT_SERVICES,n],()=>ro(n)),po=async n=>{if(!n.bookingSn)return!1;const{data:r}=await G.post("reservation/checkOutReservation",n);return r},_o=()=>ge(po),vo=async({queryKey:n})=>{const[,r,f]=n;if(!r)return;const{data:$}=await G.get("reservation/getBookingDetail",{params:{bookingSn:r,serviceAvailable:f}});return $.data},pt=(n,r,{enabled:f})=>{const $=[re.BOOKING_DETAILS,n,r];return Pe($,vo,{enabled:f,select:C=>C})},fo=async()=>{const{data:n}=await G.get("/appendix/getCategoryList?limit=-1");return n.data},_t=()=>Pt(re.CATEGORY_SERVICES,fo,{});const Ee=n=>(ut("data-v-27d07e88"),n=n(),rt(),n),ho={class:"custom-title-dialog text-bold"},go={key:0,class:"full-width full-height q-mt-md column justify-center items-center q-py-md"},yo=Ee(()=>t("span",{class:"text-negative q-mt-md"},"Fetching booking details...",-1)),bo={class:"row q-my-sm"},xo={class:"col-md-6 col-sm-6 col-xs-12 row"},So={class:"col-md-4 col-xs-4"},ko={class:"col-md-8 col-xs-8"},wo={class:"text-bold"},qo={class:"col-md-4 col-xs-4"},Vo={class:"col-md-8 col-xs-8"},Do={class:"text-weight-bold"},Co={class:"col-md-4 col-xs-4"},Ro={class:"col-md-8 col-xs-8"},$o={class:"text-weight-bold"},Po={class:"col-md-4 col-xs-4"},Io={class:"col-md-8 col-xs-8"},No={class:"text-bold"},Oo={class:"col-md-6 col-sm-6 col-xs-12 row"},To={class:"col-md-4 col-xs-4"},Qo={class:"col-md-8 col-xs-8"},Mo={class:"text-bold"},Fo={class:"col-md-4 col-xs-4"},Ao={class:"col-md-8 col-xs-8"},Uo={class:"text-bold"},Lo={class:"col-md-4 col-xs-4"},Eo={class:"col-md-8 col-xs-8"},Bo={class:"text-bold"},jo={class:"text-bold custom-font-size-title"},zo={class:"bg-grey-2 q-pa-md rounded-borders"},Ho={class:"q-ma-none q-mb-md"},Yo={class:"q-mr-sm"},Jo=Ee(()=>t("span",null,"VND",-1)),Ko={class:"row items-center justify-between text-bold text-body1"},Xo={class:"q-ma-none"},Go={class:"q-ma-none"},Wo=Ee(()=>t("span",null,"VND",-1)),Zo={class:"row"},el={class:"col-md-6 col-sm-12 text-bold custom-font-size-title inline-block"},tl={class:"col-md-6 col-sm-12"},ol={key:0,class:"ellipsis",style:{width:"300px"}},ll={key:1,style:{width:"250px"}},al={key:0},sl={key:1},nl={key:0},il={key:1},cl={key:0},ul={key:1},rl={key:0},dl={key:1},ml={class:"text-right"},pl={key:1,class:"text-center"},_l={class:"row items-center justify-between text-bold bg-grey-2 q-pa-md q-my-md"},vl={class:"q-ma-none"},fl={class:"q-mr-sm"},hl=Ee(()=>t("span",null,"VND",-1)),gl={class:"text-bold custom-font-size-title"},yl={class:"row"},bl={class:"col-md-3 col-sm-6 col-xs-12"},xl={class:"q-mb-xs"},Sl=["id","value","onChange"],kl={class:"col-md-3 col-sm-6 col-xs-12"},wl={class:"q-mb-xs"},ql=["id","value","onChange"],Vl={class:"col-md-3 col-sm-6 col-xs-12"},Dl={class:"q-mb-xs"},Cl={class:"col-md-3 col-sm-6 col-xs-12"},Rl={class:"q-mb-xs"},$l=["id","value","onChange"],Pl={class:"text-bold custom-font-size-title"},Il={class:"text-bold custom-font-size-title"},Nl={class:"row"},Ol={class:"col-md-6 col-xs-12"},Tl={class:"q-mb-none"},Ql={class:"col-md-6 col-xs-12 payment-balance"},Ml={class:"q-ma-none bg-deep-orange-1 text-negative rounded-borders q-pa-md text-weight-bold"},Fl={class:"q-mr-sm float-right"},Al={class:"q-py-md"},Ul=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","checkOutSuccess"],setup(n,{expose:r,emit:f}){const $=n,C=g(),V=g(),L=g(),x=g(!1),{t:s}=Ne(),M=pe.formatDate,A=mt(),k=le({categorySn:null,keyword:"",bookingProductSnExceptList:""}),X=g(),R={bookingNo:"",bookingSourceSn:null,bookingStatusSn:null,bookingTypeSn:null,checkIn:"",checkInActual:"",checkOut:"",checkOutActual:"",note:"",pricingPlanName:"",roomTypeSn:null,pricingPlanSn:null,roomName:"",roomPrice:null,roomSn:null,roomTypeCode:"",sn:null,guest:[],roomStatusSn:null},B={amountRoomPrice:0,amountDeposit:0,balance:0,discount:0,earlyCheckIn:"",extraFee:0,lateCheckOut:"",servicesPrice:0,paid:0,depositMethod:0,roomPrice:"",total:0,amountEarlyCheckIn:0,amountLateCheckOut:0,depositMethodSn:0,paymentMethodSn:1},m=g([]),u=le([]),N=le([]),W=le([]),D=Y(()=>[{name:"index",label:s("no"),field:"index",align:"left",style:"width: 50px",required:!0},{name:"product",label:s("products"),field:"category",style:"width: 250px",align:"left"},{name:"quantity",label:s("quantity"),field:"quantity",style:"width: 150px",align:"left"},{name:"unitPrice",label:s("unit_price"),field:"unitPrice",align:"left"},{name:"totalPrice",label:s("total_price"),field:"totalPrice",align:"left"},{name:"createTime",label:s("added_at"),field:"createTime",align:"left"},{name:"operations",field:"operations",label:" ",align:"left"}]),O=g({page:1,limit:10}),y=g(!1),v=g(se({},R)),i=g(se({},B)),P=g(!1),{notifyUpdateSuccess:ke}=Ie(),de=g(""),we=g(1),te=le({extraFee:!1,discount:!1,amountDeposit:!1}),je=_o(),{data:qe}=_t(),{data:ie,isFetching:w}=mo(k),h=Bt(),{data:p,isFetching:T}=Et({enabled:!0}),{data:S,isFetching:vt,refetch:ft}=pt(de,we,{enabled:!0});Ve(S,()=>{var b,c,F,ae;S!=null&&S.value&&(P.value=(b=S.value)==null?void 0:b.isDisplayEarlyCheckIn,i.value=se({},(c=S.value)==null?void 0:c.payment),v.value=se({},(F=S==null?void 0:S.value)==null?void 0:F.roomInformation),i.value.paymentMethodSn=1,(ae=S==null?void 0:S.value)!=null&&ae.service&&(m.value=JSON.parse(JSON.stringify(S.value.service))),He())}),Ve(w,()=>{k.categorySn&&w.value===!1&&wt()}),Ve(ie,()=>{X.value=ie.value});const ze=Y({get(){return $.modelValue},set(b){f("update:modelValue",b)}}),ht=Y(()=>{switch(v.value.bookingTypeSn){case 1:return s("hourly");case 2:return s("overnight");case 3:return s("daily");default:return s("hourly")}}),Xe=Y(()=>[{name:s("cash"),value:1},{name:s("credit_card"),value:2},{name:s("bank_transfer"),value:3},{name:s("debt"),value:4}]),Ge=Y(()=>{let b=[...m.value,...u],c=0;return b.forEach(F=>{F.unitPrice?c+=F.unitPrice*F.quantity:c+=F.product.price*F.quantity}),c}),gt=Y(()=>i.value.balance+Ge.value),yt=Y(()=>i.value.depositMethodSn===4||i.value.paymentMethodSn==4?[b=>!!b||s("booking_source_required")]:[]),bt=Y(()=>i.value.depositMethodSn==4?[b=>!!b||s("this_field_is_required"),b=>b>=1||s("the_value_is_from_1_to_100_000_000_000"),b=>b<=1e11||s("the_value_is_from_1_to_100_000_000_000")]:[b=>b>=0||s("the_value_is_from_1_to_100_000_000_000"),b=>b<=1e11||s("the_value_is_from_1_to_100_000_000_000")]),He=()=>{if(!v.value.checkInActual||!v.value.bookingTypeSn)return!1;const b={pricingPlanSn:v.value.pricingPlanSn,bookingType:v.value.bookingTypeSn,checkinDateTime:Number(v.value.checkInActual),checkoutDateTime:Number(pe.formatDate(new Date,"X")),discount:i.value.discount||0,extraFee:i.value.extraFee||0,amountDeposit:i.value.amountDeposit||0};h.mutate(b,{onSuccess:c=>{v.value.roomPrice=c.roomPrice,i.value.total=c.totalCharge,i.value.balance=c.balance,i.value.amountRoomPrice=c.roomPrice,C.value=c.priceAdjustmentList}})},xt=async b=>{y.value=!1,u.splice(0,u.length),b===de.value&&(ft.value(),He()),de.value=b},St=()=>{var b,c,F;S!=null&&S.value&&(P.value=(b=S.value)==null?void 0:b.isDisplayEarlyCheckIn,i.value=se({},(c=S.value)==null?void 0:c.payment),v.value=se({},(F=S==null?void 0:S.value)==null?void 0:F.roomInformation))},kt=()=>{var b;(b=V.value)==null||b.validate().then(c=>{if(c)A.dialog({style:"text-align: left",message:s("are_you_sure_check_out"),persistent:!0,cancel:{color:"grey-8",label:s("cancel"),noCaps:!0,dense:!0,outline:!0},color:"negative",ok:{color:"negative",label:s("confirm"),noCaps:!0,dense:!0}}).onOk(()=>{const F=g([]);u.forEach(H=>{var me;F.value.push({productSn:(me=H.product)==null?void 0:me.sn,quantity:H.quantity,createTime:H.createTime})}),N.forEach(H=>{F.value.push({bookingProductSn:H.bookingProductSn,deleteReason:H.deleteReason,quantity:H.quantity,productSn:H.productSn})});const ae={bookingSn:de.value,bookingSourceSn:v.value.bookingSourceSn,note:v.value.note,extraFee:i.value.extraFee,depositMethodSn:i.value.depositMethodSn,paymentMethodSn:i.value.paymentMethodSn,amountDeposit:i.value.amountDeposit,discount:i.value.discount,services:F.value};je.mutate(ae,{onSuccess:H=>{H&&(ke(),f("checkOutSuccess"))}})});else return!1})},wt=async()=>{if(ie.value){await u.push({product:JSON.parse(JSON.stringify(ie==null?void 0:ie.value[0])),productList:JSON.parse(JSON.stringify(ie.value)),quantity:1,createTime:Number(pe.formatDate(Date.now(),"X"))});const b=document.querySelector(".q-table__middle");b&&b.scrollTo(0,b==null?void 0:b.scrollHeight)}else It.create({message:s("not_ser_yet"),position:"top",type:"negative",actions:[{label:"Dismiss",color:"white"}]})},qt=(b,c,F,ae,H)=>{var me;(me=L.value)==null||me.validate().then(Oe=>{if(Oe)N.push({bookingProductSn:ae,deleteReason:F,productSn:b,quantity:c}),u.forEach(_=>{_.productList.forEach(Z=>{Z.sn===b&&(_.product.stock+=c)})}),W.push(ae),k.bookingProductSnExceptList=JSON.stringify(W),m.value.splice(H,1),x.value=!1;else return!1})},Ye=()=>{var b;(b=V.value)==null||b.validate().then(c=>{if(c)He();else return!1})};return r({setupCheckOutDialog:xt}),(b,c)=>(q(),j(xe,{modelValue:e(ze),"onUpdate:modelValue":c[21]||(c[21]=F=>oe(ze)?ze.value=F:null),"full-width":"","full-height":"",onHide:St},{default:l(()=>[o(be,{style:{padding:"3px 0px 27px 27px"},class:"no-scroll custom-dialog-checkout"},{default:l(()=>[o(Le,{class:"bg-white q-mt-md q-mr-lg q-pa-none",style:{"padding-bottom":"11px"}},{default:l(()=>[t("div",ho,a(e(s)("check_out")),1),o(Ue),z(o(Q,{dense:"",flat:"",icon:"close"},null,512),[[ee]])]),_:1}),o(ce,{style:{"margin-right":"27px"}}),o(ne,{class:"q-pa-none q-pb-md scroll q-pr-md",style:{height:"calc(100% - 97px)","padding-top":"11px"}},{default:l(()=>[e(vt)?(q(),U("div",go,[o(it,{color:"negative",thickness:2,size:"2em"}),yo])):(q(),j(Se,{key:1,ref_key:"checkOutFormRef",ref:V,class:"q-gutter-y-md q-ma-none q-mb-md"},{default:l(()=>{var F,ae,H,me,Oe;return[t("div",bo,[t("div",xo,[t("div",So,[t("p",null,a(e(s)("guest_make"))+":",1)]),t("div",ko,[t("p",wo,a((ae=(F=v.value)==null?void 0:F.guest[0])==null?void 0:ae.fullName),1)]),t("div",qo,[t("p",null,a(e(s)("arrival_date_time"))+":",1)]),t("div",Vo,[t("p",Do,a(e(pe).formatDate(new Date(Number((H=v.value)==null?void 0:H.checkInActual)*1e3),e(ue))),1)]),t("div",Co,[t("p",null,a(e(s)("departure_date_time"))+":",1)]),t("div",Ro,[t("p",$o,a(e(pe).formatDate(new Date,"DD/MM/YYYY HH:mm")),1)]),t("div",Po,[t("p",null,a(e(s)("booking_type"))+":",1)]),t("div",Io,[t("p",No,a(e(ht)),1)])]),t("div",Oo,[t("div",To,[t("p",null,a(e(s)("booking_number"))+":",1)]),t("div",Qo,[t("p",Mo,a((me=v.value)==null?void 0:me.bookingNo),1)]),t("div",Fo,[t("p",null,a(e(s)("room"))+":",1)]),t("div",Ao,[t("p",Uo,a(v.value.roomTypeCode)+" - "+a((Oe=v.value)==null?void 0:Oe.roomName),1)]),t("div",Lo,[t("p",null,a(e(s)("booking_source"))+":",1)]),t("div",Eo,[t("p",Bo,[o(_e,{modelValue:v.value.bookingSourceSn,"onUpdate:modelValue":c[0]||(c[0]=_=>v.value.bookingSourceSn=_),loading:e(T),filled:"",dense:"",options:e(p),"option-value":"sn","option-label":"name","map-options":"","emit-value":"",label:e(s)("select_source"),clearable:"",behavior:"menu","input-class":"overflow-hidden",class:"q-field--with-bottom custom-input-readonly","input-style":"overflow: hidden;",rules:e(yt)},null,8,["modelValue","loading","options","label","rules"])])])])]),o(ce),o(ne,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",jo,a(e(s)("room_price")),1),t("div",zo,[(q(!0),U(Ae,null,Fe(C.value,(_,Z)=>(q(),U("div",{key:Z,class:"row items-center justify-between text-body1"},[t("p",Ho,a(_.title),1),t("div",null,[t("span",Yo,a(e(K)(_.roomPrice)),1),Jo])]))),128)),o(ce,{class:"q-my-md"}),t("div",Ko,[t("p",Xo,a(e(s)("total_room_price")),1),t("p",Go,[E(a(e(K)(i.value.amountRoomPrice))+" ",1),Wo])])])]),_:1}),o(ce),o(ne,{class:"q-pa-none q-my-md"},{default:l(()=>{var _,Z,J;return[t("div",Zo,[t("p",el,a(e(s)("service")),1),t("div",tl,[y.value?(q(),j(_e,{key:1,modelValue:e(k).categorySn,"onUpdate:modelValue":c[2]||(c[2]=d=>e(k).categorySn=d),filled:"","fill-input":"",class:"ellipsis inline-block float-right",label:e(s)("category_placeholder"),"input-debounce":"200",options:(_=e(qe))==null?void 0:_.pages[0],dense:"",outlined:"","option-label":"name","option-value":"sn","emit-value":"",clearable:"","map-options":"",style:{width:"220px"}},null,8,["modelValue","label","options"])):(q(),j(Q,{key:0,outline:"","no-caps":"",color:"deep-orange-12",class:"bg-grey-1 float-right",label:e(s)("add_new"),icon:"add_circle",style:{"font-size":"12px"},onClick:c[1]||(c[1]=d=>y.value=!0)},null,8,["label"]))])]),((Z=m.value)==null?void 0:Z.length)>0||((J=e(u))==null?void 0:J.length)>0?(q(),j(At,{key:0,rows:[...m.value,...e(u)],columns:e(D),"table-colspan":9,"row-key":"index",class:"scroll-table",dense:"","no-data-label":"t('not_ser_yet')","virtual-scroll-item-size":48,"rows-per-page-options":[0],"hide-bottom":""},{header:l(d=>[o(at,{props:d},{default:l(()=>[(q(!0),U(Ae,null,Fe(d.cols,I=>(q(),j(Ut,{key:I.name,props:d,style:{"font-size":"14px","font-weight":"bold",height:"42px"}},{default:l(()=>[E(a(e(s)(I.label)),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:l(d=>[o(at,{class:"vertical-top custom-table",props:d},{default:l(()=>[o(fe,{key:"index",props:d},{default:l(()=>[t("p",null,a(e(Lt)(O.value.page,d.pageIndex)),1)]),_:2},1032,["props"]),o(fe,{key:"product",props:d},{default:l(()=>[d.row.productName?(q(),U("p",ol,a(d.row.productName),1)):(q(),U("div",ll,[o(_e,{modelValue:d.row.product,"onUpdate:modelValue":[I=>d.row.product=I,I=>d.row.quantity=1],class:"q-mr-md",label:e(s)("select_product"),options:d.row.productList,dense:"",filled:"",outlined:"","map-options":"","option-label":"name","option-value":"sn"},null,8,["modelValue","onUpdate:modelValue","label","options"]),ct(` <q-select
                        v-model="props.row.product"
                        class="q-mr-md"
                        label="Select product"
                        :options="props.row.productList"
                        dense
                        filled
                        use-chips
                        behavior="menu"
                        outlined
                        map-options
                        option-label="name"
                        option-value="sn"
                        fill-input
                        use-input
                        hide-selected
                        @filter="
                          (val, update) => {
                            filterProduct(val, update, Number(props.pageIndex - rows.length));
                          }
                        "
                        @input-value="setKeySearchCategoryModel"
                        @update:model-value="props.row.quantity = 1"
                      /> `)]))]),_:2},1032,["props"]),o(fe,{key:"quantity",props:d},{default:l(()=>[d.row.productName?(q(),U("p",al,a(d.row.quantity),1)):(q(),U("div",sl,[o(he,{modelValue:d.row.quantity,"onUpdate:modelValue":I=>d.row.quantity=I,outlined:"",dense:"",style:{width:"150px"},"input-class":"text-center"},{prepend:l(()=>[o(Q,{flat:"",round:"",color:"grey-6",icon:"remove",style:{"max-height":"10px"},disable:d.row.quantity===1,onClick:I=>d.row.quantity--},null,8,["disable","onClick"])]),append:l(()=>[o(Q,{flat:"",round:"",color:"grey-6",icon:"add",style:{"max-height":"10px"},disable:d.row.quantity===d.row.product.stock,onClick:I=>d.row.quantity++},null,8,["disable","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))]),_:2},1032,["props"]),o(fe,{key:"unitPrice",props:d},{default:l(()=>[d.row.productName?(q(),U("p",il,a(e(K)(d.row.unitPrice))+" VND",1)):(q(),U("p",nl,a(e(K)(d.row.product.price))+" VND ",1))]),_:2},1032,["props"]),o(fe,{key:"totalPrice",props:d},{default:l(()=>[d.row.productName?(q(),U("p",ul,a(e(K)(d.row.quantity*d.row.unitPrice))+" VND",1)):(q(),U("p",cl,a(e(K)(d.row.quantity*d.row.product.price))+" VND ",1))]),_:2},1032,["props"]),o(fe,{key:"createTime",props:d},{default:l(()=>[d.row.productName?(q(),U("p",rl,a(e(pe).formatDate(new Date(Number(d.row.createTime)*1e3),e(ue))),1)):(q(),U("p",dl,a(e(M)(new Date(Number(d.row.createTime)*1e3),e(ue))),1))]),_:2},1032,["props"]),o(fe,{key:"operations",props:d},{default:l(()=>[d.row.productList?(q(),j(ve,{key:0,name:"delete",color:"grey-6",icon:"delete",size:"1.8em",onClick:I=>e(u).splice(Number(d.pageIndex-m.value.length),1)},null,8,["onClick"])):(q(),j(ve,{key:1,name:"delete",color:"grey-6",size:"1.8em",class:"cursor-pointer",onClick:c[5]||(c[5]=I=>x.value=!0)},{default:l(()=>[o(xe,{modelValue:x.value,"onUpdate:modelValue":c[4]||(c[4]=I=>x.value=I),"transition-show":"scale","transition-hide":"scale"},{default:l(()=>[o(be,{class:"q-pa-md"},{default:l(()=>[o(Se,{ref_key:"delReasonFormRef",ref:L,onSubmit:Nt(I=>qt(d.row.productSn,d.row.quantity,d.row.deleteReason,d.row.sn,d.pageIndex-m.value.length),["prevent","stop"])},{default:l(()=>[t("p",null,a(e(s)("delete_label_product")),1),o(he,{modelValue:d.row.deleteReason,"onUpdate:modelValue":I=>d.row.deleteReason=I,class:"q-mb-sm",outlined:"",dense:"",placeholder:e(s)("reason_placeholder"),rules:[I=>!!I||e(s)("please_select_one_value"),I=>I.length<=200||e(s)("the_length_is_from_0_to_200_characters")]},null,8,["modelValue","onUpdate:modelValue","placeholder","rules"]),t("div",ml,[o(Q,{class:"q-mr-sm",outline:"","no-caps":"",color:"grey-8",label:e(s)("cancel"),onClick:c[3]||(c[3]=I=>x.value=!1)},null,8,["label"]),o(Q,{type:"submit","no-caps":"",color:"negative",label:e(s)("confirm")},null,8,["label"])])]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024))]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])):(q(),U("div",pl,a(e(s)("not_ser_yet")),1)),t("div",_l,[t("p",vl,a(e(s)("total_services_amount")),1),t("div",null,[t("span",fl,a(e(K)(e(Ge))),1),hl])])]}),_:1}),o(ce),o(ne,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",gl,a(e(s)("other_fees")),1),t("div",yl,[t("div",bl,[t("p",xl,a(e(s)("extra_fee")),1),o(De,{modelValue:i.value.extraFee,"onUpdate:modelValue":[c[6]||(c[6]=_=>i.value.extraFee=_),c[9]||(c[9]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col q-pr-md",suffix:"VND",debounce:"500",rules:[_=>_>=0||e(s)("the_value_is_from_1_to_100_000_000_000"),_=>_<=1e11||e(s)("the_value_is_from_1_to_100_000_000_000")],type:"number",onBlur:c[7]||(c[7]=_=>e(te).extraFee=!1),onFocus:c[8]||(c[8]=_=>e(te).extraFee=!0)},{control:l(({id:_,floatingLabel:Z,modelValue:J,emitValue:d})=>[z(t("input",{id:_,class:"q-field__input text-right",value:e(te).extraFee?J:e(K)(J),onChange:I=>e(Je)(I,J,d)},null,40,Sl),[[Me,Z]])]),_:1},8,["modelValue","rules"])]),t("div",kl,[t("p",wl,a(e(s)("discount")),1),o(De,{modelValue:i.value.discount,"onUpdate:modelValue":[c[10]||(c[10]=_=>i.value.discount=_),c[13]||(c[13]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col q-pr-md",suffix:"VND",debounce:"500",rules:[_=>_>=0||e(s)("the_value_is_from_1_to_100_000_000_000"),_=>_<=1e11||e(s)("the_value_is_from_1_to_100_000_000_000")],onBlur:c[11]||(c[11]=_=>e(te).discount=!1),onFocus:c[12]||(c[12]=_=>e(te).discount=!0)},{control:l(({id:_,floatingLabel:Z,modelValue:J,emitValue:d})=>[z(t("input",{id:_,class:"q-field__input text-right",value:e(te).discount?J:e(K)(J),onChange:I=>e(Je)(I,J,d)},null,40,ql),[[Me,Z]])]),_:1},8,["modelValue","rules"])]),t("div",Vl,[t("p",Dl,a(e(s)("deposit_method")),1),o(_e,{modelValue:i.value.depositMethodSn,"onUpdate:modelValue":c[14]||(c[14]=_=>i.value.depositMethodSn=_),class:"q-mr-md q-mb-md",label:e(s)("select_method"),options:e(Xe),dense:"",filled:"",outlined:"",clearable:"","map-options":"","option-label":"name","option-value":"value","emit-value":""},null,8,["modelValue","label","options"])]),t("div",Cl,[t("p",Rl,a(e(s)("deposit_amount")),1),o(De,{modelValue:i.value.amountDeposit,"onUpdate:modelValue":[c[15]||(c[15]=_=>i.value.amountDeposit=_),c[18]||(c[18]=_=>Ye())],modelModifiers:{number:!0},filled:"",dense:"",class:"col",suffix:"VND",debounce:"500",rules:e(bt),onBlur:c[16]||(c[16]=_=>e(te).amountDeposit=!1),onFocus:c[17]||(c[17]=_=>e(te).amountDeposit=!0)},{control:l(({id:_,floatingLabel:Z,modelValue:J,emitValue:d})=>[z(t("input",{id:_,class:"q-field__input text-right",value:e(te).amountDeposit?J:e(K)(J),onChange:I=>e(Je)(I,J,d)},null,40,$l),[[Me,Z]])]),_:1},8,["modelValue","rules"])])])]),_:1}),o(ce),o(ne,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",Pl,a(e(s)("booking_note")),1),o(he,{modelValue:v.value.note,"onUpdate:modelValue":c[19]||(c[19]=_=>v.value.note=_),filled:"",dense:"",placeholder:e(s)("input_booking_note"),behavior:"menu",rules:[_=>!_||_.length<=200||e(s)("the_length_is_from_0_to_200_characters")]},null,8,["modelValue","placeholder","rules"])]),_:1}),o(ce),o(ne,{class:"q-pa-none q-my-md"},{default:l(()=>[t("p",Il,a(e(s)("payment")),1),t("div",Nl,[t("div",Ol,[t("p",Tl,a(e(s)("payment_method")),1),o(_e,{modelValue:i.value.paymentMethodSn,"onUpdate:modelValue":c[20]||(c[20]=_=>i.value.paymentMethodSn=_),class:"q-mr-md",label:e(s)("select_payment_method"),options:e(Xe),dense:"",filled:"",outlined:"",clearable:"","map-options":"","option-label":"name","option-value":"value","emit-value":"",rules:[_=>!!_||e(s)("please_select_one_value")]},null,8,["modelValue","label","options","rules"])]),t("div",Ql,[t("p",Ml,[E(a(e(s)("balance"))+" ",1),t("span",Fl,a(e(K)(e(gt)))+" VND",1)])])]),t("p",Al," (*) "+a(e(s)("balance"))+" = "+a(e(s)("total_room_price"))+" + "+a(e(s)("total_services_amount"))+" + "+a(e(s)("extra_fee"))+" - "+a(e(s)("discount"))+" - "+a(e(s)("deposit_amount")),1)]),_:1})]}),_:1},512))]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right",style:{"padding-right":"27px"}},{default:l(()=>[z((q(),j(Q,{dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[E(a(e(s)("cancel")),1)]),_:1})),[[ee]]),o(Q,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:kt},{default:l(()=>[E(a(e(s)("confirm_check_out")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Vs=Ce(Ul,[["__scopeId","data-v-27d07e88"],["__file","D:/project_learn/goPMS/src/modules/booking/room-view/components/CheckOutDialog.vue"]]);const Ll=async n=>{if(!n.roomSn||!n.bookingSn)return!1;const{data:r}=await G.post("reservation/updateRoom",n);return r},El=()=>ge(Ll,{}),Bl=async({queryKey:n})=>{const[,r]=n;if(!r)return;const{data:f}=await G.get(`/appendix/getRoomList?roomTypeSn=${r}`);return f.data},jl=(n,{enabled:r})=>{const f=[re.ROOM_LIST,n];return Pe(f,Bl,{enabled:r,select:$=>$})},zl=async()=>{const{data:n}=await G.get("/appendix/getRoomTypeList");return n.data},Hl=()=>{const n=dt(),r=Pe(re.ROOM_TYPES,zl,{staleTime:1e4}),f=C=>{const V=n.getQueryData(re.ROOM_TYPES);return V==null?void 0:V.find(L=>L.sn===C)},$=C=>{if(!C)return;const V=n.getQueryData(re.ROOM_TYPES);return V==null?void 0:V.find(L=>L.code===C)};return et(se({},r),{findRoomTypeBySn:f,findRoomTypeByCode:$})};const Yl={class:"text-h5 text-bold"},Jl={class:"row items-center justify-between q-mt-md"},Kl={class:"text-bold text-body1"},Xl={class:"text-bold text-body1"},Gl={class:"col"},Wl={class:"q-mb-xs"},Zl={class:"col"},ea={class:"q-mb-xs"},ta=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","changeSuccess"],setup(n,{expose:r,emit:f}){const $=n,C=g(null),{notifyUpdateSuccess:V}=Ie(),L=El(),x=g(""),s=g(""),M=g(),{t:A}=Ne(),k=le({bookingSn:null,roomSn:null,reason:"",roomTypeSn:null}),{data:X}=Hl(),R=Y({get(){return $.modelValue},set(D){f("update:modelValue",D)}}),{data:B,isFetching:m}=jl(C,{enabled:!0}),u=()=>{var D;(D=M.value)==null||D.validate().then(O=>{if(O)L.mutate(k,{onSuccess:y=>{y&&(V(),f("changeSuccess"))}});else return!1})},N=async(D,O,y,v,i)=>{k.bookingSn=v,k.roomSn=D,k.roomTypeSn=i,C.value=i,x.value=y,s.value=O},W=()=>{k.bookingSn=null,k.roomSn=null,k.reason="",k.roomTypeSn=null};return r({setupChangeRoomDialog:N}),(D,O)=>(q(),j(xe,{modelValue:e(R),"onUpdate:modelValue":O[3]||(O[3]=y=>oe(R)?R.value=y:null),onHide:W},{default:l(()=>[o(be,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",Yl,a(e(A)("change_room")),1),o(Ue),z(o(Q,{dense:"",flat:"",icon:"close"},null,512),[[ee]])]),_:1}),o(ce),t("div",Jl,[t("p",Kl,a(s.value),1),t("p",Xl,a(x.value),1)]),o(ne,{class:"q-pa-none q-py-md"},{default:l(()=>[o(Se,{ref_key:"changeRoomFomRef",ref:M,class:"q-gutter-md"},{default:l(()=>[t("div",Gl,[t("p",Wl,a(e(A)("room_type_name")),1),o(_e,{modelValue:e(k).roomTypeSn,"onUpdate:modelValue":O[0]||(O[0]=y=>e(k).roomTypeSn=y),filled:"",dense:"",options:e(X)||[],"option-label":"name","option-value":"sn","map-options":"","emit-value":"",readonly:"",class:"custom-input-readonly","bg-color":"grey-5"},null,8,["modelValue","options"])]),t("div",Zl,[t("p",ea,a(e(A)("room_name"))+"*",1),o(_e,{modelValue:e(k).roomSn,"onUpdate:modelValue":O[1]||(O[1]=y=>e(k).roomSn=y),loading:e(m),filled:"",dense:"","map-options":"",options:e(B)||[],"emit-value":"","option-label":"name","option-value":"sn",rules:[y=>!!y||"Please select Room name"]},null,8,["modelValue","loading","options","rules"])]),o(he,{modelValue:e(k).reason,"onUpdate:modelValue":O[2]||(O[2]=y=>e(k).reason=y),placeholder:e(A)("reason_placeholder_require"),class:"col",filled:"",rules:[y=>!!y||e(A)("this_field_is_required"),y=>y.length<=200||e(A)("reason_cancel_booking_valid_max")],type:"textarea","input-style":"height: 100px;",style:{"min-height":"100px"}},null,8,["modelValue","placeholder","rules"])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[z((q(),j(Q,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[E(a(e(A)("cancel")),1)]),_:1})),[[ee]]),o(Q,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:u},{default:l(()=>[E(a(e(A)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Ds=Ce(ta,[["__scopeId","data-v-fe5a7166"],["__file","D:/project_learn/goPMS/src/modules/booking/room-view/components/ChangeRoomDialog.vue"]]);const oa=async n=>{if(!n.sn)return!1;const{data:r}=await G.post("reservation/cancelReservation",n);return r},la=()=>ge(oa,{}),aa={class:"row justify-start"},sa=Re({props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","cancelSuccess"],setup(n,{expose:r,emit:f}){const $=n,C=g(),{t:V}=Ne(),{notifyCreateSuccess:L}=Ie(),x=le({sn:null,reason:""}),s=la(),M=Y({get(){return $.modelValue},set(R){f("update:modelValue",R)}}),A=()=>{var R;(R=C.value)==null||R.validate().then(B=>{if(B)s.mutate(x,{onSuccess:m=>{m&&(L(),f("cancelSuccess"))}});else return!1})},k=async R=>{x.sn=R},X=()=>{x.sn=null,x.reason=""};return r({setupCancelReservationDialog:k}),(R,B)=>(q(),j(xe,{modelValue:e(M),"onUpdate:modelValue":B[1]||(B[1]=m=>oe(M)?M.value=m:null),onHide:X},{default:l(()=>[o(be,{class:"q-pa-lg text-body1",style:{width:"580px"}},{default:l(()=>[ct(` <q-bar class="bg-white q-my-md q-mr-sm q-pa-none">
        <div class="text-h5 text-bold">Cancel booking</div>
        <q-space />
        <q-btn v-close-popup dense flat icon="close"> </q-btn>
      </q-bar>
      <q-separator /> `),t("div",aa,a(e(V)("are_you_sure_cancel_booking")),1),o(ne,{class:"q-pa-none q-pt-md"},{default:l(()=>[o(Se,{ref_key:"cancelReservationFomRef",ref:C,class:"q-gutter-md"},{default:l(()=>[o(he,{modelValue:e(x).reason,"onUpdate:modelValue":B[0]||(B[0]=m=>e(x).reason=m),placeholder:e(V)("reason_placeholder"),class:"col q-mr-md",filled:"",rules:[m=>!!m||e(V)("reason_cancel_booking_valid_require"),m=>m.length<=200||e(V)("reason_cancel_booking_valid_max")],type:"textarea","input-style":"height: 100px;",style:{"min-height":"100px"}},null,8,["modelValue","placeholder","rules"])]),_:1},512)]),_:1}),o($e,{align:"right",class:"bg-white text-teal row justify-end"},{default:l(()=>[z((q(),j(Q,{"no-caps":"",outline:"",color:"grey-8",style:{padding:"8px 20px"}},{default:l(()=>[E(a(e(V)("cancel")),1)]),_:1})),[[ee]]),o(Q,{"no-caps":"",color:"negative",style:{padding:"8px 20px"},onClick:A},{default:l(()=>[E(a(e(V)("confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Cs=Ce(sa,[["__file","D:/project_learn/goPMS/src/modules/booking/room-view/components/CancelReservation.vue"]]);const na=async n=>{const{data:r}=await G.post("/reservation/addService",n);return r},ia=()=>{const n=dt();return ge(na,{onSuccess:()=>{n.invalidateQueries(re.STAFF)}})},ca=async n=>{const{data:r}=await G.post("/inventory/stock/calculateAmountProduct",n);return r},ua=()=>ge(ca,{}),ra=async n=>{const{data:r}=await G.get("/appendix/getStockInventory",{params:n});return r.data},da=n=>Pe([re.PRODUCT_SERVICES,{params:n}],()=>ra(n));const Be=n=>(ut("data-v-21d09486"),n=n(),rt(),n),ma={class:"text-h5 text-bold"},pa={key:0},_a={key:1},va={class:"row items-center q-mt-md"},fa={class:"col-md-6 col-sm-6 col-xs-12"},ha={class:"col-md-3 col-sm-4 col-xs-12 q-ma-xs"},ga={class:"row"},ya={class:"col-md-6 col-sm-12 col-xs-12 q-pt-md style-bd-r"},ba={class:"card-product"},xa={class:"card-product__header-left q-card__section q-card__section--vert bg-negative q-pa-sm"},Sa={class:"text-subtitle1 text-white text-bold q-pl-md"},ka=Be(()=>t("div",{class:"item-product row items-baseline justify-between"},null,-1)),wa={class:"height-product"},qa={key:0,class:"style-scroll-product"},Va={lass:"full-width full-height q-mt-md row justify-center"},Da={class:"row items-center"},Ca={class:"text-bold"},Ra=Be(()=>t("br",null,null,-1)),$a={class:"text-bold"},Pa={class:"col-md-6 col-sm-12 col-xs-12 q-pt-md"},Ia={class:"card-product"},Na={class:"card-product__header-right q-card__section q-card__section--vert bg-negative q-pa-sm"},Oa={class:"is-text-header text-subtitle1 text-white text-bold q-pl-md"},Ta={class:"height-product"},Qa={class:"style-scroll-product"},Ma={class:"q-card__section col-md-5 col-sm-5 col-xs-12"},Fa={class:"q-pa-sm text-weight-500"},Aa={class:"row justify-between"},Ua={class:"limit-text",style:{"font-size":"14px"}},La=Be(()=>t("br",null,null,-1)),Ea={class:"row q-card__section col-md-7 col-sm-7 col-xs-12 justify-end"},Ba={class:"q-pa-sm text-weight-500 col-md-6 col-sm-7 col-xs-12 items-end",style:{"text-align":"right"}},ja=Be(()=>t("div",{class:"col-md-6 col-sm-12 col-xs-12"},null,-1)),za={class:"col-md-6 col-sm-12 col-xs-12"},Ha={class:"row style-input-total text-bold q-mb-md"},Ya={class:"col-md-6 col-sm-6 col-xs-6"},Ja={style:{float:"left"}},Ka={class:"col-md-6 col-sm-6 col-xs-6"},Xa=Re({props:{modelValue:{type:Boolean,required:!0},isRoomView:{type:Boolean,required:!0},bookingProductSnDeleteList:{type:null,required:!0},roomName:{type:String,required:!0}},emits:["update:modelValue","addServices","changeSuccess","closeDialog"],setup(n,{expose:r,emit:f}){const $=n,{notifyUpdateSuccess:C}=Ie(),V=le({sn:0,checkIn:"",checkOut:"",number:0,totalPrice:0}),L=mt(),x=g(),s=g(),M=le({categorySn:"",keyword:"",bookingProductSnExceptList:"",isProductActive:1,isAddServiceOrderBy:1,limit:-1,notDeletedYet:1,bookingProductSnDeleteList:JSON.stringify($.bookingProductSnDeleteList)}),A=ia(),k=ua();let{data:X,isLoading:R,refetch:B}=da(M);const m=g(""),{t:u}=Ne(),N=Y({get(){return $.modelValue},set(w){f("update:modelValue",w)}}),W=async(w,h)=>{B.value(),V.sn=w,m.value=h},D=g([]),O=w=>{var T;let h={exportQuantity:w.exportQuantity,importQuantity:w.importQuantity,lastInventory:w.lastInventory,productName:w.productName,productPrice:w.productPrice,productUnitName:w.productUnitName,sn:w.sn,startInventory:w.startInventory,quantity:1};if(B.value(),w.quantity=1,!w)return;let p=0;D.value.forEach(S=>{h.sn===S.sn&&(p=1)}),p===0&&(((T=D==null?void 0:D.value)==null?void 0:T.length)>0?D.value=[...D.value,se({},h)]:D.value=[se({},h)]),qe()},{data:y,refetch:v}=_t(),i=g([]);i.value=y.value,Ve(y,()=>{var w,h,p,T;i.value=y.value,((w=i==null?void 0:i.value)==null?void 0:w.length)>0?i.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1}):((p=(h=y==null?void 0:y.value)==null?void 0:h.pages[0])==null?void 0:p.length)>0?(i.value=(T=y==null?void 0:y.value)==null?void 0:T.pages[0],i.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})):i.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}]}),Ot(()=>{var w,h,p,T;if(v.value(),((w=i==null?void 0:i.value)==null?void 0:w.length)>0){if(!y.value){i.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}];return}i.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})}else if(((p=(h=y==null?void 0:y.value)==null?void 0:h.pages[0])==null?void 0:p.length)>0){if(!y.value){i.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}];return}i.value=(T=y==null?void 0:y.value)==null?void 0:T.pages[0],i.value.unshift({isProduct:!1,name:u("all_categories"),sn:"",status:1})}else i.value=[{isProduct:!1,name:u("all_categories"),sn:"",status:1}]});const P=g("");Ve(()=>Tt.global.locale.value,w=>{P.value=w,i.value[0]={isProduct:!1,name:u("all_categories"),sn:"",status:1}});const ke=()=>{D.value=[],M.keyword="",M.categorySn="",V.totalPrice=0,f("closeDialog")},de=w=>{var h,p;D.value=(h=D==null?void 0:D.value)==null?void 0:h.filter(function(T){return T.sn!==w.sn}),((p=D.value)==null?void 0:p.length)>0?qe():V.totalPrice=0},we=w=>{var p;let h={bookingSn:w,addService:D.value};f("closeDialog"),((p=h==null?void 0:h.addService)==null?void 0:p.length)>0&&A.mutate(h,{onSuccess:T=>{(T==null?void 0:T.code)===1&&(C(),setTimeout(()=>{f("changeSuccess")},600))}})},te=()=>{var p,T;const w=(T=(p=JSON.parse(localStorage.getItem(Ft)||"{}"))==null?void 0:p.value)==null?void 0:T.fullName,h=g(Date.now());D.value.map(function(S){S.createTime=g(Number(pe.formatDate(h.value,"X"))),S.createBy=w,S.sn=null,S.unitPrice=S.productPrice,S.totalPrice=S.productPrice*S.quantity}),f("addServices",D.value),L.notify({message:u("create_success"),position:"top",type:"positive",actions:[{color:"white"}]}),setTimeout(()=>{f("changeSuccess")},600)},je=w=>{var h;(h=s.value)==null||h.validate().then(p=>{if(p)$.isRoomView===!0?we(w):te();else return!1})},qe=()=>{const w={service:[...D.value]};w.service.forEach(h=>{h.productSn=Number(h.sn),h.quantity=Number(h.quantity)}),w.service.length>0?k.mutate(w,{onSuccess:h=>{V.totalPrice=h.data.totalPrice?h.data.totalPrice:0,D.value=h.data.serviceList}}):D.value.importStock.totalPrice=0},ie=w=>{!w||qe()};return r({setupAddServiceDialog:W}),(w,h)=>(q(),j(xe,{modelValue:e(N),"onUpdate:modelValue":h[3]||(h[3]=p=>oe(N)?N.value=p:null),"full-width":"",onHide:ke},{default:l(()=>[o(be,{style:{padding:"0 32px 24px 32px",width:"486px"}},{default:l(()=>[o(Le,{class:"bg-white q-my-md q-mr-sm q-pa-none"},{default:l(()=>[t("div",ma,[E(a(e(u)("add_services"))+" ",1),$.isRoomView?(q(),U("span",pa,"- "+a(m.value),1)):(q(),U("span",_a,"- "+a($.roomName),1))]),o(Ue),z(o(Q,{dense:"",flat:"",icon:"close"},null,512),[[ee]])]),_:1}),o(Se,{ref_key:"addServicesRef",ref:s},{default:l(()=>[o(ne,{class:"q-pa-none q-py-md"},{default:l(()=>[t("div",va,[t("div",fa,[o(he,{modelValue:e(M).keyword,"onUpdate:modelValue":h[0]||(h[0]=p=>e(M).keyword=p),outlined:"",dense:"",class:"col-5 rounded-borders q-ma-xs",debounce:"300",placeholder:e(u)("search_by_products_name")},{prepend:l(()=>[o(ve,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),t("div",ha,[o(_e,{ref:"country",modelValue:e(M).categorySn,"onUpdate:modelValue":h[1]||(h[1]=p=>e(M).categorySn=p),dense:"","emit-value":"",class:"q-pl-sm custom-select-category",options:i.value,filled:"","map-options":"","option-value":"sn","option-label":"name"},null,8,["modelValue","options"])])]),t("div",ga,[t("div",ya,[t("div",ba,[t("div",xa,[t("div",Sa,a(e(u)("product")),1)])]),ka,t("div",wa,[e(R)?(q(),U("div",qa,[o(jt,{showing:e(R)},{default:l(()=>[t("div",Va,[o(it,{color:"negative",thickness:2,size:"2em"})])]),_:1},8,["showing"])])):(q(),j(Ht,{key:1,bordered:"",padding:"",class:"style-scroll-product"},{default:l(()=>[(q(!0),U(Ae,null,Fe(e(X),(p,T)=>(q(),j(zt,{key:T,clickable:p.lastInventory>0,active:x.value===p.sn,class:"custom-list-section",onClick:S=>(x.value=p.sn,O(p))},{default:l(()=>[o(st,null,{default:l(()=>[t("div",Da,[t("div",{class:Ke(["limit-text text-bold",p.lastInventory>0?"":"custom-disable"])},[E(a(p.productName)+" ",1),o(Qe,{anchor:"bottom middle",self:"top middle"},{default:l(()=>[t("div",Ca,[E(a(p.productName)+" ",1),Ra,E(" "+a(e(u)("quantity"))+" : "+a(p.lastInventory),1)])]),_:2},1024)],2),t("div",null,[z(o(ve,{name:"warning",color:"deep-orange-10",size:"1rem"},{default:l(()=>[o(Qe,{anchor:"bottom middle",self:"top middle"},{default:l(()=>[t("div",$a,[t("b",null,a(e(u)("out_of_stock")),1)])]),_:1})]),_:2},1536),[[Me,!(p.lastInventory>0)]])])])]),_:2},1024),o(st,null,{default:l(()=>[t("div",{class:Ke(["q-card__section text-bold text-right",p.lastInventory>0?"":"custom-disable"])},a(e(K)(p.productPrice))+" VND ",3)]),_:2},1024)]),_:2},1032,["clickable","active","onClick"]))),128))]),_:1}))])]),t("div",Pa,[t("div",Ia,[t("div",Na,[t("div",Oa,a(e(u)("selected_products")),1)]),t("div",Ta,[t("div",Qa,[(q(!0),U(Ae,null,Fe(D.value,(p,T)=>(q(),U("div",{key:T,class:"row justify-between"},[t("div",Ma,[t("div",Fa,[t("div",Aa,[t("div",Ua,[E(a(p.productName)+" ",1),o(Qe,null,{default:l(()=>[E(a(p.productName)+" ",1),La,E(" "+a(e(u)("quantity"))+" : "+a(p.lastInventory),1)]),_:2},1024)])])])]),t("div",Ea,[o(he,{ref_for:!0,ref:"quantity",modelValue:p.quantity,"onUpdate:modelValue":[S=>p.quantity=S,S=>ie(p.quantity)],modelModifiers:{number:!0},class:"custom-input-readonly col-md-6 col-sm-12 col-xs-12",rules:[S=>S>0||e(u)("min_0"),S=>S<=p.lastInventory||"max <= "+p.lastInventory],type:"number"},null,8,["modelValue","onUpdate:modelValue","rules"]),t("div",Ba,a(e(K)(p.total))+" VND ",1),o(Q,{dense:"",round:"",flat:"",color:"grey",class:"q-mb-md",icon:"delete",onClick:S=>de(p)},{default:l(()=>[o(Qe,null,{default:l(()=>[E(a(e(u)("delete")),1)]),_:1})]),_:2},1032,["onClick"])])]))),128))])])])])])]),_:1}),o($e,{align:"right",class:"bg-white text-teal text-right"},{default:l(()=>[ja,t("div",za,[t("div",Ha,[t("div",Ya,[t("p",Ja,a(e(u)("total_amount")),1)]),t("div",Ka,[t("p",null,a(e(K)(e(V).totalPrice))+" VND",1)])]),o(Q,{style:{width:"100%","border-radius":"12px"},class:"float-right",color:"negative",label:e(u)("add_to_the_booking"),rounded:"",icon:"add_circle",onClick:h[2]||(h[2]=p=>je(e(V).sn))},null,8,["label"])])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}});var Rs=Ce(Xa,[["__scopeId","data-v-21d09486"],["__file","D:/project_learn/goPMS/src/modules/booking/room-view/components/ChangeAddServiceDialog.vue"]]);function $s(){const n=g(null),r=g(null),f=g(null),$=g(null),C=g(null),V=g(null),L=g(null),x=le({reservationDialogVisible:!1,changeStayDateVisible:!1,checkOutDialogVisible:!1,reservationListDialogVisible:!1,cancelReservationVisible:!1,changeRoomVisible:!1,changeAddServiceVisible:!1});return{ui:x,reservationDialogRef:n,reservationListDialogRef:r,cancelReservationDialogRef:f,changeStayDateDialogRef:$,changeAddServiceDialogRef:C,changeRoomDialogRef:V,checkOutDialogRef:L,openChangeStayDate:(m,u,N,W,D,O)=>{var y;x.changeStayDateVisible=!0,(y=$.value)==null||y.setupChangeStayDateDialog(m,u,N,W,D,O)},openChangeAddService:(m,u)=>{var N;x.changeAddServiceVisible=!0,(N=C.value)==null||N.setupAddServiceDialog(m,u)},openReservationListDialog:(m,u)=>{var N;x.reservationListDialogVisible=!0,(N=r.value)==null||N.setupReservationListDialog(m,u)},openCancelReservationDialog:m=>{var u;x.cancelReservationVisible=!0,(u=f.value)==null||u.setupCancelReservationDialog(m)},openChangeRoomDialog:(m,u,N,W,D)=>{var O;x.changeRoomVisible=!0,(O=V.value)==null||O.setupChangeRoomDialog(m,u,N,W,D)},openReservationDialog:(m,u)=>{var N;x.reservationDialogVisible=!0,(N=n.value)==null||N.setupReservationDialog(m,u)},openCheckOutDialog:m=>{var u;x.checkOutDialogVisible=!0,(u=L.value)==null||u.setupCheckOutDialog(m)}}}function Ps(){const n=nt(),r=g(""),f=g(null);r.value=n.params.sn||"";const $=g(!1),C=g({bookingNo:"",bookingSourceSn:null,bookingStatusSn:null,bookingTypeSn:null,checkIn:"",checkInActual:"",checkOut:"",checkOutActual:"",note:"",pricingPlanName:"",roomTypeSn:null,pricingPlanSn:null,roomName:"",roomPrice:null,roomSn:null,roomTypeCode:"",sn:null,guest:[],roomStatusSn:null}),V=g({amountRoomPrice:0,amountDeposit:0,balance:0,discount:0,earlyCheckIn:"",servicesPrice:0,extraFee:0,lateCheckOut:"",paid:0,roomPrice:"",total:0,amountEarlyCheckIn:0,amountLateCheckOut:0,depositMethodSn:0,paymentMethodSn:0}),L=g([]),{data:x,isFetching:s,refetch:M}=pt(r,f,{enabled:!!n.params.sn});return Qt(()=>{var A,k,X,R;x!=null&&x.value&&($.value=(A=x.value)==null?void 0:A.isDisplayEarlyCheckIn,V.value=(k=x.value)==null?void 0:k.payment,C.value=(X=x==null?void 0:x.value)==null?void 0:X.roomInformation,L.value=(R=x==null?void 0:x.value)==null?void 0:R.service)}),{bookingDetailsFetching:s,refetchBookingDetails:M,formRoomInfo:C,formPayment:V,serviceInfo:L,isDisplayEarlyCheckIn:$}}const Ga=async n=>{if(!n.bookingSn)return!1;const{data:r}=await G.post("reservation/checkInReservation",n);return r},Is=()=>ge(Ga);export{Ds as C,Ps as a,$s as b,Cs as c,Vs as d,qs as e,Rs as f,Is as u};
