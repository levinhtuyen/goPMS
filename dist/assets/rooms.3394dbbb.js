var _e=Object.defineProperty,ye=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var H=(e,s,o)=>s in e?_e(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,R=(e,s)=>{for(var o in s||(s={}))ve.call(s,o)&&H(e,o,s[o]);if(z)for(var o of z(s))he.call(s,o)&&H(e,o,s[o]);return e},g=(e,s)=>ye(e,Se(s));import{aF as W,bj as X,_ as Z,J as ee,i as Re,bJ as oe,bz as te,a as ne,r as F,bA as ge,F as Q,L as se,M as C,P as u,G as D,W as Te,V as we,N as S,I as v,aO as b,R as q,aI as Ce,aH as M,q as Le,Q as J,O as Fe,aS as Qe,aT as Oe,p as be,U as G,aP as qe,aR as xe}from"./index.4bd8ab7e.js";import{u as re}from"./useI18n.96209f4d.js";import{Q as Ie}from"./QSkeleton.6540a6ab.js";import{Q as K}from"./QSelect.2521a28c.js";import{Q as Ve}from"./QForm.8a0c543d.js";import{C as De}from"./ClosePopup.34597da2.js";import{u as Me}from"./useNotify.6f32b3a1.js";import{b as ae,u as Ne}from"./axiosClient.ad61c203.js";import{Q as w}from"./queryKeys.832af9fa.js";import{u as N}from"./useRoomTypeListQuery.6ae8a4aa.js";import{u as ke}from"./useRoomTypeFloorInfoQuery.36bc7af8.js";import"./QMenu.d60d439b.js";import"./position-engine.e365a736.js";import"./selection.cdf30163.js";import"./QItemLabel.0748896a.js";import"./rtl.4b414a6d.js";import"./use-quasar.fa06306f.js";const Ue=async e=>{const{data:s}=await ae.post("/configuration/room/createRoom",e);return s},Be=()=>{const e=X(),{findRoomTypeBySn:s}=N(),o=(t,n)=>{const a=e.getQueryData(w.FLOORS),r=s(n.roomTypeSn);!a||!r||e.setQueryData(w.FLOORS,()=>a.map(m=>m.sn!==n.floorSn?m:g(R({},m),{roomList:[...m.roomList,{sn:t.sn,name:n.name,roomTypeCode:r.name}]})))},h=t=>{const n=e.getQueryData(w.ROOM_TYPES);!n||e.setQueryData(w.ROOM_TYPES,()=>n.map(a=>a.sn!==t.roomTypeSn?a:g(R({},a),{numOfRoom:a.numOfRoom+1})))};return W(Ue,{onSuccess:(t,n)=>{h(n),o(t,n)}})},Ee=async e=>{const{data:s}=await ae.post("/configuration/room/updateRoom",e);return s},Pe=()=>{const e=X(),{findRoomTypeBySn:s}=N(),o=t=>{const n=e.getQueryData(w.FLOORS);if(!n)return;const a=n.flatMap(({roomList:m,sn:i,name:T})=>m.map(L=>g(R({},L),{floorSn:i,floorName:T}))).find(m=>m.sn===t.sn);if(!a)return;const r=s(t.roomTypeSn);if(!!r)return e.setQueryData(w.FLOORS,()=>{switch(a.floorSn!==t.floorSn){case!0:return n.map(i=>i.sn!==t.floorSn?g(R({},i),{roomList:i.roomList.filter(T=>T.sn!==t.sn)}):g(R({},i),{roomList:[...i.roomList,{sn:t.sn,name:t.name,roomTypeCode:r.code,roomTypeSn:t.roomTypeSn}]}));case!1:return n.map(i=>i.sn!==t.floorSn?i:g(R({},i),{roomList:i.roomList.map(T=>T.sn!==t.sn?T:{sn:t.sn,name:t.name,roomTypeCode:r.code,roomTypeSn:t.roomTypeSn})}))}}),a.roomTypeCode},h=(t,n)=>{const a=e.getQueryData(w.ROOM_TYPES);!a||!n||e.setQueryData(w.ROOM_TYPES,()=>a.map(r=>r.sn===t.roomTypeSn?g(R({},r),{numOfRoom:r.numOfRoom+1}):r.code===n?g(R({},r),{numOfRoom:r.numOfRoom-1}):r))};return W(Ee,{onSuccess:(t,n)=>{const a=o(n);h(n,a)}})};const k=e=>(Qe("data-v-7fc45f50"),e=e(),Oe(),e),Ae={key:0,class:"wrapper"},Ye={key:1,class:"wrapper"},je={class:"col-12 col-md-12"},$e={class:"q-ma-none text-weight-bold"},ze=k(()=>v("span",null,"*",-1)),He={class:"col-6 col-md-6 col-sm-12 col-xs-12 q-pr-sm"},Je={class:"q-ma-none text-weight-bold"},Ge=k(()=>v("span",null,"*",-1)),Ke={class:"col-6 col-md-6 col-sm-12 col-xs-12"},We={class:"q-ma-none text-weight-bold"},Xe=k(()=>v("span",null,"*",-1)),Ze={class:"row justify-end q-gutter-md"},eo=ee({props:{roomSn:{type:[String,Number],required:!0}},emits:["onRequestSuccess"],setup(e,{emit:s}){var Y,j,$;const o=e,h=Re("emitter"),{hasPermission:t}=Ne(),{notifySaveSuccess:n,notifySaveFailed:a}=Me(),r=oe(),m=te(),{data:i,isLoading:T,findRoomTypeByCode:L}=N(),{data:U,isLoading:le,findRoomByRoomSn:ue,findFloorByRoomSn:me}=ke(),B=Be(),E=Pe(),P=ne(()=>le.value||T.value),A=Array.isArray(m.query.code)||(Y=m.query.code)==null?void 0:Y.replaceAll("_"," "),ie=(j=L(A))!=null&&j.sn?($=L(A))==null?void 0:$.sn:{name:"Choose Room Type",sn:0},c=F({name:""});ge(()=>{var l,p,_;if(o.roomSn==="new")c.value={roomTypeSn:ie,floorSn:r.options.history.state.floorId,name:""};else{const f=ue(o.roomSn);c.value={roomTypeSn:(l=L(f==null?void 0:f.roomTypeCode))==null?void 0:l.sn,floorSn:(p=me(o.roomSn))==null?void 0:p.sn,name:(_=f==null?void 0:f.name)!=null?_:""}}});const x=F(null),ce=[l=>!!l||d("this_field_is_required"),l=>Number.isInteger(l)||d("this_is_invalid_value")],I=F(null),de=[l=>!!l||d("this_field_is_required"),l=>Number.isInteger(l)||d("this_is_invalid_value")],V=F(null),pe=[l=>!!l.trim()||d("this_field_is_required"),l=>l.trim().length<=50||d("the_length_is_from_1_to_50_characters"),l=>{var p;return!((p=U.value)!=null&&p.some(({roomList:_})=>_.some(({name:y,sn:O})=>o.roomSn==="new"?y.toLowerCase()===l.trim().toLowerCase():y.toLowerCase()===l.trim().toLowerCase()&&O!==o.roomSn)))||d("already_exists",{name:d("room_name").toLowerCase()})}],{t:d}=re(),fe=()=>{var l,p,_,f,y,O;if((l=V.value)==null||l.validate(),(p=I.value)==null||p.validate(),(_=x.value)==null||_.validate(),!(((f=V.value)==null?void 0:f.error)||((y=I.value)==null?void 0:y.error)||((O=x.value)==null?void 0:O.error))&&!(!c.value.floorSn||!c.value.roomTypeSn)){if(o.roomSn==="new"){B.mutate({roomTypeSn:c.value.roomTypeSn,floorSn:c.value.floorSn,name:c.value.name.trim()},{onSuccess:()=>{n(),s("onRequestSuccess"),h.emit("refetchListRoomSetting")},onError:()=>{a()}});return}E.mutate({sn:o.roomSn,roomTypeSn:c.value.roomTypeSn,floorSn:c.value.floorSn,name:c.value.name.trim()},{onSuccess:()=>{setTimeout(()=>{n(),s("onRequestSuccess"),h.emit("refetchListRoomSetting")},600)},onError:()=>{a()}})}};return(l,p)=>(Q(),se(Ve,{onSubmit:fe},{default:C(()=>[u(P)?(Q(),D("div",Ae,[(Q(),D(Te,null,we(3,_=>S(Ie,{key:_,type:"QInput"})),64))])):(Q(),D("div",Ye,[S(M,{class:"row q-py-none"},{default:C(()=>{var _,f;return[v("div",je,[v("p",$e,[b(q(u(d)("room_name")),1),ze]),S(Ce,{ref_key:"nameField",ref:V,modelValue:c.value.name,"onUpdate:modelValue":p[0]||(p[0]=y=>c.value.name=y),filled:"",dense:"",placeholder:u(d)("input_room_name"),"lazy-rules":"",rules:pe},null,8,["modelValue","placeholder"])]),v("div",He,[v("p",Je,[b(q(u(d)("room_type")),1),Ge]),S(K,{ref_key:"roomTypeField",ref:I,modelValue:c.value.roomTypeSn,"onUpdate:modelValue":p[1]||(p[1]=y=>c.value.roomTypeSn=y),filled:"",rules:de,options:(_=u(i))!=null?_:void 0,"map-options":"",dense:"","option-label":"name",label:u(d)("select_room_type"),clearable:"","option-value":"sn","bg-color":o.roomSn!=="new"?"grey-5":"",class:"custom-limit-select","emit-value":"",disable:o.roomSn!=="new"},null,8,["modelValue","options","label","bg-color","disable"])]),v("div",Ke,[v("p",We,[b(q(u(d)("floor")),1),Xe]),S(K,{ref_key:"floorSnField",ref:x,modelValue:c.value.floorSn,"onUpdate:modelValue":p[2]||(p[2]=y=>c.value.floorSn=y),filled:"",rules:ce,options:(f=u(U))!=null?f:void 0,"map-options":"",dense:"",label:u(d)("select_floor"),clearable:"",class:"custom-limit-select","option-label":"name","option-value":"sn","bg-color":o.roomSn!=="new"?"grey-5":"","emit-value":"",disable:o.roomSn!=="new"},null,8,["modelValue","options","label","bg-color","disable"])])]}),_:1})])),v("div",Ze,[Le(S(J,{label:u(d)("cancel"),dense:"",outline:"","no-caps":"",color:"grey-8",style:{padding:"8px 20px"}},null,8,["label"]),[[De]]),S(J,{"no-caps":"",label:u(d)("save"),color:"negative",type:"submit",disable:u(P),class:Fe(u(t)("add-edit-room")===!1?"hidden":""),loading:u(B).isLoading.value||u(E).isLoading.value,"data-testId":"submit-btn"},null,8,["label","disable","class","loading"])])]),_:1}))}});var oo=Z(eo,[["__scopeId","data-v-7fc45f50"],["__file","D:/project_learn/goPMS/src/modules/room-settings/components/room-form.vue"]]);const to={class:"text-h6 q-pl-md text-weight-bold"},no=ee({setup(e){const s=oe(),o=te(),{t:h}=re(),t=F(!1),n=ne(()=>{const{roomSn:r}=o.params;return Array.isArray(r)?null:r==="new"?"new":typeof+r=="number"?+r:null});be(()=>t.value=!0);const a=()=>{s.replace({path:"/settings/room-settings",query:o.query})};return(r,m)=>u(n)?(Q(),se(xe,{key:0,modelValue:t.value,"onUpdate:modelValue":m[1]||(m[1]=i=>t.value=i),onHide:a},{default:C(()=>[S(qe,{style:{width:"550px","max-width":"80vw"}},{default:C(()=>[S(M,{class:"row"},{default:C(()=>[v("div",to,[b(q(u(n)==="new"?u(h)("new_room"):u(h)("edit_room")),1),G(" {{ router.options.history.state.roomName }} ")])]),_:1}),S(M,{class:"q-pt-none"},{default:C(()=>[S(oo,{"room-sn":u(n),onOnRequestSuccess:m[0]||(m[0]=i=>t.value=!1)},null,8,["room-sn"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):G("v-if",!0)}});var wo=Z(no,[["__file","D:/project_learn/goPMS/src/modules/room-settings/views/rooms.vue"]]);export{wo as default};
